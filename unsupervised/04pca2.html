
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>13. 主成分分析 (2) &#8212; 機械学習帳</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://chokkan.github.io/mlnote/unsupervised/04pca2.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="表記" href="../notation.html" />
    <link rel="prev" title="12. 主成分分析 (1)" href="03pca.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="ja">
    

    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@chokkanorg">
    <meta name="twitter:title" content="機械学習帳">
    <meta name="twitter:description" content="機械学習帳は、機械学習を学ぶためのノート（帳）を、デジタル（機械）による新しいカタチの学習帳として実現することを目指しています。">
    <meta name="twitter:image" content="https://chokkan.github.io/mlnote/_static/mlnote.png">

    <!-- Google Analytics -->

    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5R9M0GR7MW"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-5R9M0GR7MW');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">機械学習帳</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="この本を検索..." aria-label="この本を検索..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  回帰
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../regression/01sra.html">
   1. 単回帰
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../regression/02mra.html">
   2. 重回帰
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../regression/03regularization.html">
   3. モデル選択と正則化
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../regression/04sgd.html">
   4. 勾配法によるパラメータ推定
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  分類
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/01binary.html">
   5. 線形二値分類
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/02multi.html">
   6. 線形多クラス分類
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/03nn.html">
   7. ニューラルネットワーク (1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/04nntrain.html">
   8. ニューラルネットワーク (2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/05svm.html">
   9. サポートベクトルマシン
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  教師無し学習
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01kmeans.html">
   10. 非階層的クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02hac.html">
   11. 階層的クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03pca.html">
   12. 主成分分析 (1)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   13. 主成分分析 (2)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  付録
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notation.html">
   表記
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../reference.html">
   参考文献・謝辞
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">ナビゲーションを切り替え</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="このページをダウンロード"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/unsupervised/04pca2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="ソースファイルをダウンロード" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="PDFに印刷"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/chokkan/mlnote"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="ソースリポジトリ"><i
                    class="fab fa-github"></i>リポジトリ</button></a>
        <a class="issues-button"
            href="https://github.com/chokkan/mlnote/issues/new?title=Issue%20on%20page%20%2Funsupervised/04pca2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="問題を開く"><i class="fas fa-lightbulb"></i>未解決の問題</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="全画面モード"
        title="全画面モード"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/chokkan/mlnote/main?urlpath=lab/tree/unsupervised/04pca2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="起動 Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/chokkan/mlnote/blob/main/unsupervised/04pca2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="起動 Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    
                    alt="Interact on Colab">Colab</button></a>

        <a class="colab-button" href="https://studiolab.sagemaker.aws/import/github/chokkan/mlnote/blob/main/unsupervised/04pca2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
            title="起動 SageMaker Studio Lab" data-toggle="tooltip" data-placement="left"><i
                class="fab fa-aws"></i> SageMaker</button></a>

        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="起動 Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> 目次
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   13.1. データの表現
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     13.1.1. 射影したデータの分散
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sec-eigen-and-pca">
   13.2. 固有値問題と主成分分析
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     13.2.1. 第1主成分
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     13.2.2. 第2主成分以降
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   13.3. スペクトル分解と主成分分析
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     13.3.1. スペクトル分解
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sec-pca-by-spectral-decomposition">
     13.3.2. 主成分分析の導出
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   13.4. 主成分分析と次元圧縮
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   13.5. 応用例 (1): 麺類の支出額
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id13">
   13.6. 応用例 (2): 手書き文字
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id14">
   13.7. 応用例 (3): 固有顔
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>主成分分析 (2)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> 目次 </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   13.1. データの表現
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     13.1.1. 射影したデータの分散
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sec-eigen-and-pca">
   13.2. 固有値問題と主成分分析
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     13.2.1. 第1主成分
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id6">
     13.2.2. 第2主成分以降
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   13.3. スペクトル分解と主成分分析
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id8">
     13.3.1. スペクトル分解
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sec-pca-by-spectral-decomposition">
     13.3.2. 主成分分析の導出
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   13.4. 主成分分析と次元圧縮
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id12">
   13.5. 応用例 (1): 麺類の支出額
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id13">
   13.6. 応用例 (2): 手書き文字
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id14">
   13.7. 応用例 (3): 固有顔
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1><span class="section-number">13. </span>主成分分析 (2)<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install japanize-matplotlib
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: japanize-matplotlib in /usr/local/lib/python3.8/dist-packages (1.1.3)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from japanize-matplotlib) (3.4.2)
Requirement already satisfied: pyparsing&gt;=2.2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (2.4.7)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (0.10.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (1.3.1)
Requirement already satisfied: numpy&gt;=1.16 in /home/okazaki/.local/lib/python3.8/site-packages (from matplotlib-&gt;japanize-matplotlib) (1.19.5)
Requirement already satisfied: pillow&gt;=6.2.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (8.3.1)
Requirement already satisfied: python-dateutil&gt;=2.7 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (2.8.1)
Requirement already satisfied: six in /home/okazaki/.local/lib/python3.8/site-packages (from cycler&gt;=0.10-&gt;matplotlib-&gt;japanize-matplotlib) (1.15.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">japanize_matplotlib</span>
</pre></div>
</div>
</div>
</div>
<p>2次元のデータの例で主成分分析の基本的な考え方を掴んだところで、多次元のデータに対する主成分分析を考えよう。</p>
<div class="section" id="id2">
<h2><span class="section-number">13.1. </span>データの表現<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><span class="math notranslate nohighlight">\(d\)</span>次元のベクトル<span class="math notranslate nohighlight">\(\pmb{x} \in \mathbb{R}^d\)</span>からなる事例を<span class="math notranslate nohighlight">\(N\)</span>件集めたデータを行列<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{N \times d}\)</span>で表す。</p>
<div class="amsmath math notranslate nohighlight" id="equation-7c23f4d6-8879-4919-b020-1c6da430bbfb">
<span class="eqno">(13.1)<a class="headerlink" href="#equation-7c23f4d6-8879-4919-b020-1c6da430bbfb" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{X} = \begin{pmatrix}\pmb{x}_1^\top \\ \pmb{x}_2^\top \\ \dots \\ \pmb{x}_N^\top \end{pmatrix}
\end{align}\]</div>
<p>また、データの平均ベクトル<span class="math notranslate nohighlight">\(\pmb{\bar{x}} \in \mathbb{R}^d\)</span>を次式で定義する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-523e9bb3-87d3-42f2-95fa-5015c2f34f09">
<span class="eqno">(13.2)<a class="headerlink" href="#equation-523e9bb3-87d3-42f2-95fa-5015c2f34f09" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{\bar{x}} = \frac{1}{N} \sum_{i=1}^N \pmb{x}_i
\end{align}\]</div>
<div class="section" id="id3">
<h3><span class="section-number">13.1.1. </span>射影したデータの分散<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>あるベクトル<span class="math notranslate nohighlight">\(\pmb{u} \in \mathbb{R}^d\)</span>でデータ点を射影したとき、<span class="math notranslate nohighlight">\(\pmb{u}\)</span>上に射影された点の分散<span class="math notranslate nohighlight">\(J\)</span>は、</p>
<div class="margin sidebar">
<p class="sidebar-title">データの中心化</p>
<p>主成分分析の説明の中には、データ点が中心化されている（データ点の平均が原点にある）ことを仮定するものがある。前章の例で用いたデータ点も中心化されていた。しかし、式<a class="reference internal" href="#equation-eq-pca-ptojected-variance-derivation">(13.3)</a>の定式化では、射影後の分散を求めるときに分散共分散行列を経由する（各データ点から平均を引く）ことになるため、事前にデータ点を中心化しておかなくてもよい。</p>
</div>
<div class="math notranslate nohighlight" id="equation-eq-pca-ptojected-variance-derivation">
<span class="eqno">(13.3)<a class="headerlink" href="#equation-eq-pca-ptojected-variance-derivation" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
J &amp;= \frac{1}{N} \sum_{i=1}^N \left(\pmb{u}^\top \pmb{x}_i - \pmb{u}^\top \pmb{\bar{x}}\right)^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x}})\right\}^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x}})\right\} \cdot \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x}})\right\} \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x}})\right\} \cdot \left\{(\pmb{x}_i - \pmb{\bar{x}})^\top \pmb{u}\right\} \\
&amp;= \pmb{u}^\top \left[\frac{1}{N} \sum_{i=1}^N (\pmb{x}_i - \pmb{\bar{x}})(\pmb{x}_i - \pmb{\bar{x}})^\top\right] \pmb{u} \\
&amp;= \pmb{u}^\top \pmb{S} \pmb{u}
\end{align}
\end{split}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">二次形式</p>
<p>式<a class="reference internal" href="#equation-eq-pca-projected-variance">(13.4)</a>は二次形式と呼ばれる。二次形式とは、二次の項のみで構成される多項式である。</p>
<p>例えば、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{S} = \begin{pmatrix}
1 &amp; 1 \\
1 &amp; 3
\end{pmatrix}
\end{align*}\]</div>
<p>を考えると、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{u}^\top\pmb{S}\pmb{u}
&amp;=
\begin{pmatrix}
u_1 &amp; u_2
\end{pmatrix}
\begin{pmatrix}
1 &amp; 1 \\
1 &amp; 3
\end{pmatrix}
\begin{pmatrix}
u_1 \\
u_2
\end{pmatrix} \\
&amp;= \begin{pmatrix}
u_1 + u_2 &amp; u_1 + 3u_2
\end{pmatrix}
\begin{pmatrix}
u_1 \\
u_2
\end{pmatrix} \\
&amp;= u_1^2 + 2 u_1 u_2 + 3u_2^2
\end{align*}\]</div>
<p>となる。これは、<span class="math notranslate nohighlight">\(u_1\)</span>と<span class="math notranslate nohighlight">\(u_2\)</span>の二次の項のみを含む多項式であることが確認できる。</p>
</div>
<div class="important admonition">
<p class="admonition-title">射影後の点の分散</p>
<p><span class="math notranslate nohighlight">\(N\)</span>個のデータ点<span class="math notranslate nohighlight">\(\pmb{x}_1, \dots, \pmb{x}_N \in \mathbb{R}^d\)</span>をベクトル<span class="math notranslate nohighlight">\(\pmb{u} \in \mathbb{R}^d\)</span>で射影したとき、<span class="math notranslate nohighlight">\(\pmb{u}\)</span>上に射影された点の分散は、</p>
<div class="math notranslate nohighlight" id="equation-eq-pca-projected-variance">
<span class="eqno">(13.4)<a class="headerlink" href="#equation-eq-pca-projected-variance" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\pmb{u}^\top \pmb{S} \pmb{u}
\end{align}
\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>はデータの分散共分散行列である。</p>
<div class="math notranslate nohighlight" id="equation-eq-variance-covariance-matrix">
<span class="eqno">(13.5)<a class="headerlink" href="#equation-eq-variance-covariance-matrix" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
\pmb{S} &amp;= \frac{1}{N} \sum_{i=1}^N (\pmb{x}_i - \pmb{\bar{x}}) (\pmb{x}_i - \pmb{\bar{x}})^\top \\
\end{align}
\end{split}\]</div>
</div>
<p>なお、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の各要素<span class="math notranslate nohighlight">\(S_{a,b}\)</span>は、行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>を用いると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-d756926e-e573-4113-aeff-81459f575a39">
<span class="eqno">(13.6)<a class="headerlink" href="#equation-d756926e-e573-4113-aeff-81459f575a39" title="この数式へのパーマリンク">¶</a></span>\[\begin{gather}
S_{a,b} = \frac{1}{N} \sum_{i=1}^N (X_{i,a} - \bar{x}_a) (X_{i,b} - \bar{x}_b) \\
\bar{x}_a = \frac{1}{N} \sum_{i=1}^N X_{i,a}, \; \bar{x}_b = \frac{1}{N} \sum_{i=1}^N X_{i,b}
\end{gather}\]</div>
<p>と表される。<span class="math notranslate nohighlight">\(a\)</span>と<span class="math notranslate nohighlight">\(b\)</span>を入れ替えても同じ値が求まるので、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>は<span class="math notranslate nohighlight">\(d \times d\)</span>の実対称行列である。</p>
</div>
</div>
<div class="section" id="sec-eigen-and-pca">
<span id="id4"></span><h2><span class="section-number">13.2. </span>固有値問題と主成分分析<a class="headerlink" href="#sec-eigen-and-pca" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="id5">
<h3><span class="section-number">13.2.1. </span>第1主成分<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>主成分分析では、ある単位ベクトル<span class="math notranslate nohighlight">\(\pmb{u} \in \mathbb{R}^d\)</span>でデータ点を射影したとき、射影された点の分散を最大化したい。前章で説明した通り、第1主成分<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>は、<span class="math notranslate nohighlight">\(\|\pmb{u}_1\|=1\)</span>の制約のもとで次式の目的関数を最大化する問題の解である。</p>
<div class="amsmath math notranslate nohighlight" id="equation-6657ee2d-af34-4fbf-8347-655d4d24acc4">
<span class="eqno">(13.7)<a class="headerlink" href="#equation-6657ee2d-af34-4fbf-8347-655d4d24acc4" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
J = \pmb{u}_1^\top \pmb{S} \pmb{u}_1
\end{align}\]</div>
<p>これを制約なしの最大化問題に書き換えるため、ラグランジュの未定乗数法を用いる。ラグランジュ関数<span class="math notranslate nohighlight">\(\mathcal{L}\)</span>は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-e684db42-9b63-4b39-8f40-f681b5e0f575">
<span class="eqno">(13.8)<a class="headerlink" href="#equation-e684db42-9b63-4b39-8f40-f681b5e0f575" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\mathcal{L} = \pmb{u}_1^\top \pmb{S} \pmb{u}_1 - \lambda_1 (\pmb{u}_1^\top\pmb{u}_1 - 1)
\end{align}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\lambda_1\)</span>はラグランジュ乗数である。ラグランジュ関数<span class="math notranslate nohighlight">\(\mathcal{L}\)</span>を最大化するため、<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>に関する偏微分を<span class="math notranslate nohighlight">\(0\)</span>とおくと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-352c7264-9520-4772-917d-a8bb47524fab">
<span class="eqno">(13.9)<a class="headerlink" href="#equation-352c7264-9520-4772-917d-a8bb47524fab" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\frac{\partial \mathcal{L}}{\partial \pmb{u}_1} = 2\pmb{S} \pmb{u}_1 - 2\lambda_1 \pmb{u}_1 &amp;= 0 \\
\pmb{S} \pmb{u}_1 = \lambda_1 \pmb{u}_1
\end{align}\]</div>
<p>ゆえに、第1主成分を求める問題は分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値問題に帰着する。なお、上式の両辺に左から<span class="math notranslate nohighlight">\(\pmb{u}_1^\top\)</span>をかけると、左辺は最大化したい目的関数<span class="math notranslate nohighlight">\(J\)</span>となり、右辺は<span class="math notranslate nohighlight">\(\lambda_1\)</span>となる。</p>
<div class="math notranslate nohighlight" id="equation-eq-j-principal-component">
<span class="eqno">(13.10)<a class="headerlink" href="#equation-eq-j-principal-component" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
J = \pmb{u}_1^\top \pmb{S} \pmb{u}_1 = \pmb{u}_1^\top (\pmb{S} \pmb{u}_1) = \pmb{u}_1^\top (\lambda_1 \pmb{u}_1) = \lambda_1 \pmb{u}_1^\top \pmb{u}_1 = \lambda_1
\end{align}
\]</div>
<p>したがって、射影後の分散<span class="math notranslate nohighlight">\(J\)</span>を最大にする第1主成分ベクトル<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>は、<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値の中で最大のものを<span class="math notranslate nohighlight">\(\lambda_1\)</span>として、それに対応する固有ベクトルを長さ<span class="math notranslate nohighlight">\(1\)</span>になるように正規化したものである。また、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>を第1主成分ベクトル<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>に射影したとき、その軸における分散は<span class="math notranslate nohighlight">\(\lambda_1\)</span>である。</p>
<p>これまでの議論をまとめる。</p>
<div class="important admonition">
<p class="admonition-title">主成分分析の第1主成分</p>
<p><span class="math notranslate nohighlight">\(N\)</span>個の事例からなるデータ<span class="math notranslate nohighlight">\(\pmb{X} = \begin{pmatrix}\pmb{x}_1 &amp; \pmb{x}_2 &amp; \dots &amp; \pmb{x}_N \end{pmatrix}^\top\)</span>が与えられ、その分散共分散行列を<span class="math notranslate nohighlight">\(\pmb{S}\)</span>とする。主成分分析の第1主成分ベクトル<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>は以下の固有値問題の解である。</p>
<div class="math notranslate nohighlight" id="equation-eq-pca1-eigenvalue">
<span class="eqno">(13.11)<a class="headerlink" href="#equation-eq-pca1-eigenvalue" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\pmb{S} \pmb{u}_1 = \lambda_1 \pmb{u}_1
\end{align}
\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\lambda_1\)</span>は<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の最大の固有値で、<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>は<span class="math notranslate nohighlight">\(\lambda_1\)</span>に対応する固有ベクトルを正規化したものである。データの平均ベクトルを<span class="math notranslate nohighlight">\(\bar{\pmb{x}}\)</span>と書くことにすると、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>に含まれるある事例<span class="math notranslate nohighlight">\(\pmb{x}\)</span>の第1主成分得点は、</p>
<div class="math notranslate nohighlight" id="equation-eq-pca1-score">
<span class="eqno">(13.12)<a class="headerlink" href="#equation-eq-pca1-score" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\pmb{u}_1^\top (\pmb{x} - \pmb{\bar{x}})
\end{align}
\]</div>
<p>データ点を第1主成分ベクトル<span class="math notranslate nohighlight">\(\pmb{u}_1\)</span>に射影したとき、その軸におけるデータの分散は<span class="math notranslate nohighlight">\(\lambda_1\)</span>である。</p>
</div>
</div>
<div class="section" id="id6">
<h3><span class="section-number">13.2.2. </span>第2主成分以降<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>第2主成分以降を一般的に求めるため、第<span class="math notranslate nohighlight">\(k\)</span>主成分ベクトル<span class="math notranslate nohighlight">\(\pmb{u}_1, \dots, \pmb{u}_k\)</span>までを求めてあると仮定し、第<span class="math notranslate nohighlight">\(k+1\)</span>主成分ベクトルを求める（<span class="math notranslate nohighlight">\(1 \leq k &lt; d\)</span>）。各主成分ベクトルの長さは<span class="math notranslate nohighlight">\(1\)</span>で、互いに直交するように選ぶので、主成分ベクトルは以下の制約を満たす（つまり、<span class="math notranslate nohighlight">\(\pmb{u}_1, \dots, \pmb{u}_k\)</span>は正規直交系である）。</p>
<div class="math notranslate nohighlight" id="equation-eq-orthonormal">
<span class="eqno">(13.13)<a class="headerlink" href="#equation-eq-orthonormal" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
\pmb{u}^\top_i \pmb{u}_j = \begin{cases}
1 &amp; (i = j) \\
0 &amp; (i \neq j)
\end{cases}
\end{align}
\end{split}\]</div>
<p>第<span class="math notranslate nohighlight">\(k+1\)</span>主成分ベクトル<span class="math notranslate nohighlight">\(\pmb{u}_{k+1}\)</span>は、<span class="math notranslate nohighlight">\(\|\pmb{u}_{k+1}\|=1, \pmb{u}_1^\top \pmb{u}_{k+1} = \dots = \pmb{u}_k^\top \pmb{u}_{k+1} = 0\)</span>の制約のもとで次の目的関数を最大化する問題の解である。</p>
<div class="amsmath math notranslate nohighlight" id="equation-e078907f-359e-4f46-92be-5344d1f38401">
<span class="eqno">(13.14)<a class="headerlink" href="#equation-e078907f-359e-4f46-92be-5344d1f38401" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
J = \pmb{u}_{k+1}^\top \pmb{S} \pmb{u}_{k+1}
\end{align}\]</div>
<p>これを制約なしの最大化問題に書き換えるため、ラグランジュの未定乗数法を用いる。ラグランジュ関数<span class="math notranslate nohighlight">\(\mathcal{L}\)</span>は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-8419357b-003b-4118-b8fb-bdee694c619e">
<span class="eqno">(13.15)<a class="headerlink" href="#equation-8419357b-003b-4118-b8fb-bdee694c619e" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\mathcal{L} = \pmb{u}_{k+1}^\top \pmb{S} \pmb{u}_{k+1} - \lambda_{k+1} (\pmb{u}_{k+1}^\top\pmb{u}_{k+1} - 1) - \sum_{i=1}^k \alpha_i \pmb{u}_i^\top \pmb{u}_{k+1}
\end{align}\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(\alpha_1, \dots, \alpha_k, \lambda_{k+1}\)</span>はラグランジュ乗数である。ラグランジュ関数<span class="math notranslate nohighlight">\(\mathcal{L}\)</span>を最大化するため、<span class="math notranslate nohighlight">\(\pmb{u}_{k+1}\)</span>に関する偏微分を<span class="math notranslate nohighlight">\(0\)</span>とおくと、</p>
<div class="math notranslate nohighlight" id="equation-eq-pca-lagrange">
<span class="eqno">(13.16)<a class="headerlink" href="#equation-eq-pca-lagrange" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\frac{\partial \mathcal{L}}{\partial \pmb{u}_{k+1}} = 2\pmb{S} \pmb{u}_{k+1} - 2\lambda_{k+1} \pmb{u}_{k+1} - \sum_{i=1}^k \alpha_i \pmb{u}_i &amp;= 0
\end{align}
\]</div>
<p>ここで、上の等式において<span class="math notranslate nohighlight">\(\pmb{u}_1^\top\)</span>を左からかけ、式<a class="reference internal" href="#equation-eq-orthonormal">(13.13)</a>に注意しながら展開すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-6d57c3a2-b4d5-4162-be9a-e259a1930035">
<span class="eqno">(13.17)<a class="headerlink" href="#equation-6d57c3a2-b4d5-4162-be9a-e259a1930035" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
2\pmb{u}_1^\top \pmb{S} \pmb{u}_{k+1} - 2\lambda_{k+1} \pmb{u}_1^\top \pmb{u}_{k+1} - \sum_{i=1}^k \alpha_i \pmb{u}_1^\top \pmb{u}_i &amp;= 0 \\
2\pmb{u}_1^\top \pmb{S} \pmb{u}_{k+1} - \alpha_1 &amp;= 0 \\
\alpha_1 &amp;= 2\pmb{u}_1^\top \pmb{S} \pmb{u}_{k+1} = 2\pmb{u}_{k+1}^\top \pmb{S} \pmb{u}_1 = 2\pmb{u}_{k+1}^\top \lambda_1 \pmb{u}_1 = 0
\end{align}\]</div>
<p>同様に、全ての<span class="math notranslate nohighlight">\(j \in \{1, \dots, k\}\)</span>に対して、<span class="math notranslate nohighlight">\(\pmb{u}_j^\top\)</span>を左からかけることで、<span class="math notranslate nohighlight">\(\alpha_j = 0\)</span>が示される。ゆえに、式<a class="reference internal" href="#equation-eq-pca-lagrange">(13.16)</a>は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-b63347b4-17a3-4d30-94a6-40b00e420f40">
<span class="eqno">(13.18)<a class="headerlink" href="#equation-b63347b4-17a3-4d30-94a6-40b00e420f40" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{S} \pmb{u}_{k+1} = \lambda_{k+1} \pmb{u}_{k+1}
\end{align}\]</div>
<p>と整理される。したがって、第<span class="math notranslate nohighlight">\(k+1\)</span>主成分以降を求める問題も分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値問題に帰着する。これを<span class="math notranslate nohighlight">\(k=1\)</span>から<span class="math notranslate nohighlight">\(k=d-1\)</span>まで繰り返すことで、すべての主成分ベクトルを求めることができる。</p>
<p>固有値問題による主成分分析をまとめる。</p>
<div class="important admonition">
<p class="admonition-title">主成分分析と固有値問題</p>
<p><span class="math notranslate nohighlight">\(N\)</span>個の事例からなるデータ<span class="math notranslate nohighlight">\(\pmb{X} = \begin{pmatrix}\pmb{x}_1 &amp; \pmb{x}_2 &amp; \dots &amp; \pmb{x}_N \end{pmatrix}^\top\)</span>が与えられ、その分散共分散行列を<span class="math notranslate nohighlight">\(\pmb{S}\)</span>とする。<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の<span class="math notranslate nohighlight">\(d\)</span>個の固有値を大きい順に並べ、</p>
<div class="math notranslate nohighlight" id="equation-eq-pca-lambdas">
<span class="eqno">(13.19)<a class="headerlink" href="#equation-eq-pca-lambdas" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\lambda_1 \geq \lambda_2 \geq \dots \geq \lambda_d \geq 0
\end{align}
\]</div>
<p>とする。また、<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, \dots, \lambda_d\)</span>に対応する固有ベクトルを<span class="math notranslate nohighlight">\(\pmb{u}_1, \pmb{u}_1, \dots, \pmb{u}_d\)</span>とする。ただし、固有ベクトルは、</p>
<div class="amsmath math notranslate nohighlight" id="equation-a2957fa4-eb70-455a-bb90-7b3ee40ae944">
<span class="eqno">(13.20)<a class="headerlink" href="#equation-a2957fa4-eb70-455a-bb90-7b3ee40ae944" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{u}^\top_i \pmb{u}_j = \begin{cases}
1 &amp; (i = j) \\
0 &amp; (i \neq j)
\end{cases}
\end{align}\]</div>
<p>を満たすように求める。すると、<span class="math notranslate nohighlight">\(\pmb{u}_1, \pmb{u}_1, \dots, \pmb{u}_d\)</span>はそれぞれ、第1主成分、第2主成分、……、第<span class="math notranslate nohighlight">\(d\)</span>主成分に対応する。データの平均ベクトルを<span class="math notranslate nohighlight">\(\bar{\pmb{x}}\)</span>と書くことにすると、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>に含まれるある事例<span class="math notranslate nohighlight">\(\pmb{x}\)</span>の第<span class="math notranslate nohighlight">\(i\)</span>主成分得点は（<span class="math notranslate nohighlight">\(i \in \{1, \dots, d\}\)</span>）、</p>
<div class="math notranslate nohighlight" id="equation-eq-pcak-score">
<span class="eqno">(13.21)<a class="headerlink" href="#equation-eq-pcak-score" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\pmb{u}_i^\top (\pmb{x} - \pmb{\bar{x}})
\end{align}
\]</div>
<p>データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>を各主成分に射影したとき、各軸におけるデータの分散はそれぞれ、<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, \dots, \lambda_d\)</span>である。</p>
</div>
<p>なお、式<a class="reference internal" href="#equation-eq-pca-lambdas">(13.19)</a>において、<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値が実数で、かつ全て非負であることは後ほど説明する。</p>
</div>
</div>
<div class="section" id="id7">
<h2><span class="section-number">13.3. </span>スペクトル分解と主成分分析<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>主成分分析への理解を深めるため、スペクトル分解との関連を説明する。</p>
<div class="section" id="id8">
<h3><span class="section-number">13.3.1. </span>スペクトル分解<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>まず、スペクトル分解を復習する。一般に、実対象行列は以下の性質を持つ。</p>
<div class="note dropdown admonition">
<p class="admonition-title">実対称行列のすべての固有値は実数である</p>
<p>実対称行列<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>のある固有値を<span class="math notranslate nohighlight">\(\lambda \in \mathbb{C}\)</span>とする（この時点では複素数の可能性を排除していない）。また、この固有値に対応する固有ベクトルを<span class="math notranslate nohighlight">\(\pmb{q} \in \mathbb{C}^d\)</span>と書く。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{S} \pmb{q} = \lambda \pmb{q}
\end{align*}\]</div>
<p>両辺の複素共役をとると（<span class="math notranslate nohighlight">\(\pmb{S}\)</span>は実行列なので<span class="math notranslate nohighlight">\(\pmb{\bar{S}} = \pmb{S}\)</span>）、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{S} \pmb{\bar{q}} = \bar{\lambda} \pmb{\bar{q}}
\end{align*}\]</div>
<p>上の2つの等式、および<span class="math notranslate nohighlight">\(\pmb{S}^\top = \pmb{S}\)</span>に注意しながら<span class="math notranslate nohighlight">\(\pmb{q}^\top \pmb{S} \pmb{\bar{q}}\)</span>を二通りの方法で変形する。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{q}^\top \pmb{S} \pmb{\bar{q}} &amp;= \pmb{q}^\top \pmb{S}^\top \pmb{\bar{q}} = (\pmb{S} \pmb{q})^\top \pmb{\bar{q}} = (\lambda \pmb{q})^\top \pmb{\bar{q}} = \lambda (\pmb{q}^\top \pmb{\bar{q}}) \\
\pmb{q}^\top \pmb{S} \pmb{\bar{q}} &amp;= \pmb{q}^\top (\pmb{S} \pmb{\bar{q}}) = \pmb{q}^\top (\bar{\lambda} \pmb{\bar{q}}) = \bar{\lambda} (\pmb{q}^\top \pmb{\bar{q}})
\end{align*}\]</div>
<p>上の二つの等式の右辺は等しいので、次の等式が成り立つ。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lambda (\pmb{q}^\top \pmb{\bar{q}}) - \bar{\lambda} (\pmb{q}^\top \pmb{\bar{q}}) = (\lambda - \bar{\lambda}) \pmb{q}^\top \pmb{\bar{q}} = 0 \qquad \dots \mbox{ (a)}
\end{align*}\]</div>
<p>一般に、複素数<span class="math notranslate nohighlight">\((a + ib)\)</span>とその複素共役<span class="math notranslate nohighlight">\((a - ib)\)</span>の積は<span class="math notranslate nohighlight">\((a + ib)(a - ib) = a^2 + b^2 = |a + ib|^2\)</span>であるので、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{q}^\top \pmb{\bar{q}} = \sum_{i=1}^d q_i \bar{q_i} = \sum_{i=1}^d |q_i|^2 &gt; 0
\end{align*}\]</div>
<p>したがって、式(a)が成り立つことから<span class="math notranslate nohighlight">\(\lambda = \bar{\lambda}\)</span>。すなわち、<span class="math notranslate nohighlight">\(\lambda\)</span>は実数である。</p>
</div>
<div class="note dropdown admonition">
<p class="admonition-title">実対称行列の固有ベクトルは正規直交系を構成する</p>
<p>実対称行列<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>の異なる二つの固有値を<span class="math notranslate nohighlight">\(\lambda, \mu\)</span>、これらに対応する固有ベクトル<span class="math notranslate nohighlight">\(\pmb{u}, \pmb{v}\)</span>とする。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{S} \pmb{u} = \lambda \pmb{u}, \; \pmb{S} \pmb{v} = \mu \pmb{v}
\end{align*}\]</div>
<p><span class="math notranslate nohighlight">\(\pmb{u}\)</span>と<span class="math notranslate nohighlight">\(\pmb{v}\)</span>を定数倍しても上の等式は成り立つので、<span class="math notranslate nohighlight">\(\|\pmb{u}\|=\|\pmb{v}\|=1\)</span>となるように正規化しておく。上の2つの等式、および<span class="math notranslate nohighlight">\(\pmb{S}^\top = \pmb{S}\)</span>に注意しながら<span class="math notranslate nohighlight">\(\pmb{u}^\top \pmb{S} \pmb{v}\)</span>を二通りの方法で変形する。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{u}^\top \pmb{S} \pmb{v} &amp;= \pmb{u}^\top \pmb{S}^\top \pmb{v} = (\pmb{S} \pmb{u})^\top \pmb{v} =  (\lambda \pmb{u})^\top \pmb{v} = \lambda(\pmb{u}^\top \pmb{v}) \\
\pmb{u}^\top \pmb{S} \pmb{v} &amp;= \pmb{u}^\top (\pmb{S} \pmb{v}) = \pmb{u}^\top \mu \pmb{v} = \mu (\pmb{u}^\top \pmb{v})
\end{align*}\]</div>
<p>上の二つの等式の右辺は等しいので、次の等式が成り立つ。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lambda(\pmb{u}^\top \pmb{v}) - \mu (\pmb{u}^\top \pmb{v}) = (\lambda - \mu) (\pmb{u}^\top \pmb{v}) = 0
\end{align*}\]</div>
<p>もし、二つの固有値<span class="math notranslate nohighlight">\(\lambda\)</span>と<span class="math notranslate nohighlight">\(\mu\)</span>が異なるとき、<span class="math notranslate nohighlight">\(\lambda - \mu \neq 0\)</span>であるから、<span class="math notranslate nohighlight">\(\pmb{u}^\top \pmb{v} = 0\)</span>である。</p>
<p>もし、二つの固有値<span class="math notranslate nohighlight">\(\lambda\)</span>と<span class="math notranslate nohighlight">\(\mu\)</span>が等しいとき、すなわち実対称行列が重複する固有値を持つ場合は、対応する固有ベクトルをグラム・シュミットの直交化法により直交化すればよい。</p>
</div>
<p>ある実対称行列<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>の固有値を<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, \dots, \lambda_d\)</span>とし、対応する固有ベクトルを<span class="math notranslate nohighlight">\(\pmb{q}_1, \pmb{q}_2, \dots, \pmb{q}_d \in \mathbb{R}^d\)</span>とする。</p>
<div class="math notranslate nohighlight" id="equation-eq-eigen-equations">
<span class="eqno">(13.22)<a class="headerlink" href="#equation-eq-eigen-equations" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\pmb{S} \pmb{q}_1 = \lambda_1 \pmb{q}_1, \;
\pmb{S} \pmb{q}_2 = \lambda_2 \pmb{q}_2, \;
\dots, \;
\pmb{S} \pmb{q}_d = \lambda_d \pmb{q}_d
\end{align}
\]</div>
<p>なお、固有ベクトルを正規直交系を構成するように選ぶことができるので、<span class="math notranslate nohighlight">\(i, j \in \{1, \dots, d\}\)</span>に関して、</p>
<div class="math notranslate nohighlight" id="equation-eq-q-is-orthogonal">
<span class="eqno">(13.23)<a class="headerlink" href="#equation-eq-q-is-orthogonal" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
 \pmb{q}_i^\top\pmb{q}_j = \begin{cases}
1 &amp; (i = j) \\
0 &amp; (i \neq j)
\end{cases}
\end{align}
\end{split}\]</div>
<p>等式<a class="reference internal" href="#equation-eq-eigen-equations">(13.22)</a>をベクトルとして横に並べると、次のように整理できる。</p>
<div class="math notranslate nohighlight" id="equation-eq-eigen-equation">
<span class="eqno">(13.24)<a class="headerlink" href="#equation-eq-eigen-equation" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
\begin{pmatrix}
\pmb{S} \pmb{q}_1 &amp;
\pmb{S} \pmb{q}_2 &amp;
\dots &amp;
\pmb{S} \pmb{q}_d
\end{pmatrix} &amp;= 
\begin{pmatrix}
\lambda_1 \pmb{q}_1 &amp;
\lambda_2 \pmb{q}_2 &amp;
\dots &amp;
\lambda_d \pmb{q}_d
\end{pmatrix} \\
\pmb{S} \begin{pmatrix}
\pmb{q}_1 &amp; \pmb{q}_2 &amp; \dots &amp; \pmb{q}_d
\end{pmatrix} &amp;= \begin{pmatrix}
\pmb{q}_1 &amp; \pmb{q}_2 &amp; \dots &amp; \pmb{q}_d
\end{pmatrix}
\begin{pmatrix}
\lambda_1 &amp; 0 &amp; \dots &amp; 0 \\
0 &amp; \lambda_2 &amp; \dots &amp; 0 \\
0 &amp; 0 &amp; \dots &amp; 0 \\
0 &amp; 0 &amp; \dots &amp; \lambda_d \\
\end{pmatrix} \\
\pmb{S} \pmb{Q} &amp;= \pmb{Q} \pmb{\Lambda}
\end{align}
\end{split}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\pmb{\Lambda} \in \mathbb{R}^{d \times d}\)</span>は固有値を要素とする対角行列である。</p>
<div class="amsmath math notranslate nohighlight" id="equation-5dc638cb-ac86-486b-8e64-31a54f2e9fbe">
<span class="eqno">(13.25)<a class="headerlink" href="#equation-5dc638cb-ac86-486b-8e64-31a54f2e9fbe" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{\Lambda} = {\rm diag}(\lambda_1, \lambda_2, \dots, \lambda_d) = \begin{pmatrix}
\lambda_1 &amp; 0 &amp; \ldots &amp; 0 \\
0 &amp; \lambda_2 &amp; \ldots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \ldots &amp; \lambda_d \\
\end{pmatrix}
\end{align}\]</div>
<p>また、行列<span class="math notranslate nohighlight">\(\pmb{Q} \in \mathbb{R}^{d \times d}\)</span>は列ベクトルである固有ベクトルを横方向に配置したものである。</p>
<div class="amsmath math notranslate nohighlight" id="equation-4cfbde6a-662a-4f5b-aded-3cccda9c8b46">
<span class="eqno">(13.26)<a class="headerlink" href="#equation-4cfbde6a-662a-4f5b-aded-3cccda9c8b46" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{Q} = \begin{pmatrix}
\pmb{q}_1 &amp; \pmb{q}_2 &amp; \dots &amp; \pmb{q}_d
\end{pmatrix}
\end{align}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">直交行列</p>
<p>ある行列<span class="math notranslate nohighlight">\(\pmb{A}\)</span>が直交行列であるとは、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{A}^\top \pmb{A} = \pmb{A}\pmb{A}^\top = \pmb{I}
\end{align*}\]</div>
</div>
<p>以下に示すように、<span class="math notranslate nohighlight">\(\pmb{Q}^\top \pmb{Q} = \pmb{I}\)</span>であるから、<span class="math notranslate nohighlight">\(\pmb{Q}\)</span>は直交行列である。</p>
<div class="math notranslate nohighlight" id="equation-eq-q-is-orthogonal-matrix">
<span class="eqno">(13.27)<a class="headerlink" href="#equation-eq-q-is-orthogonal-matrix" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
\pmb{Q}^\top \pmb{Q} = \begin{pmatrix}
\pmb{q}_1^\top \\ \pmb{q}_2^\top \\ \dots \\ \pmb{q}_d^\top
\end{pmatrix} \begin{pmatrix}
\pmb{q}_1 &amp; \pmb{q}_2 &amp; \dots &amp; \pmb{q}_d
\end{pmatrix}
= \begin{pmatrix}
\pmb{q}_1^\top\pmb{q}_1 &amp; \pmb{q}_1^\top\pmb{q}_2 &amp; \ldots &amp; \pmb{q}_1^\top\pmb{q}_d \\
\pmb{q}_2^\top\pmb{q}_1 &amp; \pmb{q}_2^\top\pmb{q}_2 &amp; \ldots &amp; \pmb{q}_2^\top\pmb{q}_d \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\pmb{q}_d^\top\pmb{q}_1 &amp; \pmb{q}_d^\top\pmb{q}_2 &amp; \ldots &amp; \pmb{q}_d^\top\pmb{q}_d \\
\end{pmatrix}
= \begin{pmatrix}
1 &amp; 0 &amp; \ldots &amp; 0 \\
0 &amp; 1 &amp; \ldots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \ldots &amp; 1 \\
\end{pmatrix} = \pmb{I}
\end{align}
\end{split}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">実対称行列の対角化</p>
<p>式<a class="reference internal" href="#equation-eq-eigen-equation">(13.24)</a>の左から<span class="math notranslate nohighlight">\(\pmb{Q}^\top\)</span>をかけると、<span class="math notranslate nohighlight">\(\pmb{S}\)</span>は<span class="math notranslate nohighlight">\(\pmb{Q}\)</span>によって対角化可能であることを示すことができる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{Q}^\top \pmb{S} \pmb{Q} = \pmb{\Lambda}
\end{align*}\]</div>
</div>
<p>式<a class="reference internal" href="#equation-eq-eigen-equation">(13.24)</a>の右から<span class="math notranslate nohighlight">\(\pmb{Q}^\top\)</span>をかけ、左辺において<span class="math notranslate nohighlight">\(\pmb{Q}\pmb{Q}^\top = \pmb{I}\)</span>であることに注意すると、<strong>スペクトル分解</strong>（spectral decomposition）が得られる。</p>
<div class="important admonition">
<p class="admonition-title">スペクトル分解</p>
<p>実対称行列<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>は、直交行列<span class="math notranslate nohighlight">\(\pmb{Q} \in \mathbb{R}^{d \times d}\)</span>、対角行列<span class="math notranslate nohighlight">\(\pmb{\Lambda} \in \mathbb{R}^{d \times d}\)</span>、直交行列<span class="math notranslate nohighlight">\(\pmb{Q}^\top\)</span>の積に分解できる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-9cb5b038-c4f5-4976-8f24-39d64356aa90">
<span class="eqno">(13.28)<a class="headerlink" href="#equation-9cb5b038-c4f5-4976-8f24-39d64356aa90" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{S} &amp;= \pmb{Q} \pmb{\Lambda} \pmb{Q}^\top \\
&amp;= \begin{pmatrix}
\vert &amp; \vert &amp; \ldots &amp; \vert \\
\pmb{q}_1 &amp; \pmb{q}_2 &amp; \ldots &amp; \pmb{q}_d \\
\vert &amp; \vert &amp; \ldots &amp; \vert \\
\end{pmatrix}
\begin{pmatrix}
\lambda_1 &amp; 0 &amp; \ldots &amp; 0 \\
0 &amp; \lambda_2 &amp; \ldots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \ldots &amp; \lambda_d \\
\end{pmatrix}
\begin{pmatrix}
\text{―} &amp; \pmb{q}_1^\top &amp; \text{―} \\
\text{―} &amp; \pmb{q}_2^\top &amp; \text{―} \\
\vdots &amp; \vdots &amp; \vdots \\
\text{―} &amp; \pmb{q}_d^\top &amp; \text{―}
\end{pmatrix} \\
&amp;= \lambda_1 \begin{pmatrix}
\vert \\
\pmb{q}_1 \\
\vert \\
\end{pmatrix}
\begin{pmatrix}
\text{―} \; \pmb{q}_1^\top \; \text{―}
\end{pmatrix} +
\lambda_2 \begin{pmatrix}
\vert \\
\pmb{q}_2 \\
\vert \\
\end{pmatrix}
\begin{pmatrix}
\text{―} \; \pmb{q}_2^\top \; \text{―}
\end{pmatrix} +
\dots +
\lambda_d \begin{pmatrix}
\vert \\
\pmb{q}_d \\
\vert \\
\end{pmatrix}
\begin{pmatrix}
\text{―} \; \pmb{q}_d^\top \; \text{―}
\end{pmatrix} \\
&amp;= \sum_{i = 1}^{d} \lambda_i \pmb{q}_i \pmb{q}_i^\top
\end{align}\]</div>
<p>なお、</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\pmb{\Lambda}\)</span>の対角要素<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, \dots, \lambda_d\)</span>は<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値を並べたものである。</p></li>
<li><p><span class="math notranslate nohighlight">\(\pmb{Q}\)</span>の列ベクトル<span class="math notranslate nohighlight">\(\pmb{q}_1, \dots, \pmb{q}_d \in \mathbb{R}^d\)</span>は<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, \dots, \lambda_d\)</span>に対応する固有ベクトルであり、正規直交系をなす。</p></li>
</ul>
</div>
</div>
<div class="section" id="sec-pca-by-spectral-decomposition">
<span id="id9"></span><h3><span class="section-number">13.3.2. </span>主成分分析の導出<a class="headerlink" href="#sec-pca-by-spectral-decomposition" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>スペクトル分解に基づいて主成分分析を導出してみよう。主成分分析では、データ行列<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{N \times d}\)</span>に対して式<a class="reference internal" href="#equation-eq-variance-covariance-matrix">(13.5)</a>で計算される分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>が出発点である。以下の二つの性質により、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値は非負である。</p>
<div class="note dropdown admonition">
<p class="admonition-title">分散共分散行列は半正定値対称行列である</p>
<p>行列<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{N \times d}\)</span>の分散共分散行列を<span class="math notranslate nohighlight">\(\pmb{S} \in \mathbb{R}^{d \times d}\)</span>とする。分散共分散行列は対称行列であるので、半正定値行列であることを示せばよい。任意のベクトル<span class="math notranslate nohighlight">\(\pmb{u}\)</span>に対して、</p>
<div class="amsmath math notranslate nohighlight" id="equation-ca677d16-9c54-4bbf-8c42-150965a46270">
<span class="eqno">(13.29)<a class="headerlink" href="#equation-ca677d16-9c54-4bbf-8c42-150965a46270" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{u}^\top \pmb{S} \pmb{u}
&amp;= \pmb{u}^\top \left[\frac{1}{N} \sum_{i=1}^N (\pmb{x}_i - \pmb{\bar{x})}(\pmb{x}_i - \pmb{\bar{x}})^\top\right] \pmb{u} \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x})}\right\} \cdot \left\{(\pmb{x}_i - \pmb{\bar{x}})^\top \pmb{u}\right\} \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x})}\right\} \cdot \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x}})\right\}^\top \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x})}\right\} \cdot \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x}})\right\} \\
&amp;= \frac{1}{N} \sum_{i=1}^N \left\{\pmb{u}^\top (\pmb{x}_i - \pmb{\bar{x})}\right\}^2 \\
&amp;\geq 0
\end{align}\]</div>
<p>が成り立つので、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>は半正定値行列である。なお、この証明は式<a class="reference internal" href="#equation-eq-pca-objective">(13.38)</a>を逆向きに辿っていると考えればよい。</p>
</div>
<div class="note dropdown admonition">
<p class="admonition-title">半正定値対称行列の固有値はすべて非負である</p>
<p>半正定値対称行列を<span class="math notranslate nohighlight">\(\pmb{S}\)</span>とする。その行列のある固有値を<span class="math notranslate nohighlight">\(\lambda\)</span>、対応する固有ベクトルを<span class="math notranslate nohighlight">\(\pmb{u}\)</span>とする。すなわち、</p>
<div class="amsmath math notranslate nohighlight" id="equation-47d9e3ed-70a1-4eb7-b45f-eb9e3a870e41">
<span class="eqno">(13.30)<a class="headerlink" href="#equation-47d9e3ed-70a1-4eb7-b45f-eb9e3a870e41" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{S} \pmb{u} = \lambda \pmb{u}
\end{align}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の二次形式を計算すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-ac7561e9-2e5f-4f28-8f23-247cbc3687f2">
<span class="eqno">(13.31)<a class="headerlink" href="#equation-ac7561e9-2e5f-4f28-8f23-247cbc3687f2" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{u}^\top \pmb{S} \pmb{u} = \pmb{u}^\top \lambda \pmb{u} = \lambda \pmb{u}^\top \pmb{u}
\end{align}\]</div>
<p>分散共分散行列は半正定値対称行列であるから、左辺は非負であることが分かっている。右辺が非負となるためには、<span class="math notranslate nohighlight">\(\lambda \geq 0\)</span>が成り立たなければならない。</p>
</div>
<p>分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>は実対称行列であるから、直交行列<span class="math notranslate nohighlight">\(\pmb{Q} \in \mathbb{R}^{d \times d}\)</span>と対角行列<span class="math notranslate nohighlight">\(\pmb{\Lambda} = {\rm diag}(\lambda_1, \dots, \lambda_d) \in \mathbb{R}^{d \times d}\)</span>によるスペクトル分解が存在する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-c8dd699d-3aa6-4ebe-86f9-07e0e673f859">
<span class="eqno">(13.32)<a class="headerlink" href="#equation-c8dd699d-3aa6-4ebe-86f9-07e0e673f859" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{S} = \pmb{Q} \pmb{\Lambda} \pmb{Q}^\top
\end{align}\]</div>
<p>さらに、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>は半正定値対称行列であり、その固有値はすべて非負である。そこで、<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値を大きい順に並べておく。</p>
<div class="math notranslate nohighlight" id="equation-eq-eigenvalue-order">
<span class="eqno">(13.33)<a class="headerlink" href="#equation-eq-eigenvalue-order" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\lambda_1 \geq \lambda_2 \geq \dots \geq \lambda_d \geq 0
\end{align}
\]</div>
<p>また、これらの固有値に対応するように固有ベクトル<span class="math notranslate nohighlight">\(\pmb{Q} = \begin{pmatrix}\pmb{q}_1 &amp; \pmb{q}_2 &amp; \dots &amp; \pmb{q}_d\end{pmatrix}\)</span>を並び替えておく。</p>
<p>さて、式<a class="reference internal" href="#equation-eq-pca-objective">(13.38)</a>で示したように、主成分分析における第1主成分<span class="math notranslate nohighlight">\(\pmb{u}_1 \in \mathbb{R}^d\)</span>は以下の最大化問題で求まる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-02e9d760-d1fb-461a-bcbd-0c30bd1d8a9b">
<span class="eqno">(13.34)<a class="headerlink" href="#equation-02e9d760-d1fb-461a-bcbd-0c30bd1d8a9b" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\pmb{u}_1 = \mathop{\rm argmax}\limits_{\|\pmb{u}\| = 1} \pmb{u}^\top \pmb{S} \pmb{u} = \mathop{\rm argmax}\limits_{\|\pmb{u}\| \neq 0} \frac{\pmb{u}^\top \pmb{S} \pmb{u}}{\pmb{u}^\top \pmb{u}}
\end{align}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\({\rm argmax}\)</span>の中身、</p>
<div class="amsmath math notranslate nohighlight" id="equation-80cecd3d-0786-496e-ae94-46b0124487e1">
<span class="eqno">(13.35)<a class="headerlink" href="#equation-80cecd3d-0786-496e-ae94-46b0124487e1" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\frac{\pmb{u}^\top \pmb{S} \pmb{u}}{\pmb{u}^\top \pmb{u}}
\end{align}\]</div>
<p>はレイリー商（Rayleigh quotient）と呼ばる。以下で示すように、このレイリー商は<span class="math notranslate nohighlight">\(\pmb{u} = \pm \pmb{q}_1\)</span>のとき最大値<span class="math notranslate nohighlight">\(\lambda_1\)</span>をとる。すなわち、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>を第1主成分ベクトルに射影するとき、その分散の最大値は<span class="math notranslate nohighlight">\(\lambda_1\)</span>であり、その最大値を与える第1主成分ベクトルは<span class="math notranslate nohighlight">\(\pmb{u}_1 = \pm \pmb{q}_1\)</span>である。</p>
<div class="margin sidebar">
<p class="sidebar-title">レイリー商の最小値</p>
<p>同様に、レイリー商の最小値は<span class="math notranslate nohighlight">\(\lambda_d\)</span>であることを示すことができる。</p>
</div>
<div class="note admonition">
<p class="admonition-title">レイリー商による最大値</p>
<div class="amsmath math notranslate nohighlight" id="equation-d55df0d0-a6db-4b85-8e8e-0d3150994616">
<span class="eqno">(13.36)<a class="headerlink" href="#equation-d55df0d0-a6db-4b85-8e8e-0d3150994616" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\frac{\pmb{u}^\top \pmb{S} \pmb{u}}{\pmb{u}^\top \pmb{u}}
&amp;= \frac{\pmb{u}^\top (\pmb{Q}\pmb{\Lambda}\pmb{Q}^\top) \pmb{u}}{\pmb{u}^\top \pmb{u}} &amp;&amp; (\because \pmb{S} = \pmb{Q}\pmb{\Lambda}\pmb{Q}^\top) \\
&amp;= \frac{\pmb{u}^\top \pmb{Q}\pmb{\Lambda}\pmb{Q}^\top \pmb{u}}{\pmb{u}^\top\pmb{Q} \pmb{Q}^\top\pmb{u}} &amp;&amp; (\because \pmb{Q} \pmb{Q}^\top = \pmb{I}) \\
&amp;= \frac{(\pmb{Q}^\top \pmb{u})^\top\pmb{\Lambda}\pmb{Q}^\top \pmb{u}}{(\pmb{Q}^\top \pmb{u})^\top \pmb{Q}^\top\pmb{u}} &amp;&amp; (\because \pmb{Q} \pmb{Q}^\top = \pmb{I}) \\
&amp;= \frac{\pmb{z}^\top \pmb{\Lambda}\pmb{z}}{\pmb{z}^\top\pmb{z}} &amp;&amp; (\pmb{z} := \pmb{Q}^\top \pmb{u}) \\
&amp;= \frac{\lambda_1 z_1^2 + \lambda_2 z_2^2 + \dots + \lambda_d z_d^2}{z_1^2 + z_2^2 + \dots + z_d^2} &amp;&amp; (\because \pmb{\Lambda} = {\rm diag}(\lambda_1, \lambda_2, \dots, \lambda_d))
\end{align}\]</div>
<p>上式は<span class="math notranslate nohighlight">\(\lambda_1, \lambda_2, \dots, \lambda_d\)</span>の<span class="math notranslate nohighlight">\(z_1^2, z_2^2, \dots, z_d^2\)</span>による重み付き平均である。したがって、その最大値は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-dd845123-54de-42ff-aa59-0f862aefaa5e">
<span class="eqno">(13.37)<a class="headerlink" href="#equation-dd845123-54de-42ff-aa59-0f862aefaa5e" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\max_{\|\pmb{u}\| \neq 0} \frac{\pmb{u}^\top \pmb{S} \pmb{u}}{\pmb{u}^\top \pmb{u}}
= \max_{\|\pmb{z}\| \neq 0} \frac{\lambda_1 z_1^2 + \lambda_2 z_2^2 + \dots + \lambda_d z_d^2}{z_1^2 + z_2^2 + \dots + z_d^2}
\leq \lambda_1 \\
\end{align}\]</div>
<p>等号が成立するのは、<span class="math notranslate nohighlight">\(z_1^2 = 1, z_2^2 = z_3^2 = \dots = z_d^2 = 0\)</span>、すなわち<span class="math notranslate nohighlight">\(\pmb{u} = \pm \pmb{q}_1\)</span>のときである。</p>
</div>
<p>続いて、主成分分析で第<span class="math notranslate nohighlight">\(k\)</span>主成分までデータ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>を射影する場合を考える（<span class="math notranslate nohighlight">\(1 \leq k \leq d\)</span>）。<span class="math notranslate nohighlight">\(k\)</span>個の直交基底ベクトルで射影した後のデータの分散の和の最大値は<span class="math notranslate nohighlight">\(\lambda_1 + \dots + \lambda_k\)</span>であること、その最大値は<span class="math notranslate nohighlight">\(\pmb{q}_1, \dots, \pmb{q}_k\)</span>で射影した場合であることを示す <span id="id10">[<a class="reference internal" href="../reference.html#id21">Dasgupta, 2008</a>]</span>。</p>
<p><span class="math notranslate nohighlight">\(k\)</span>個の直交基底ベクトルを<span class="math notranslate nohighlight">\(\pmb{u}_1, \dots, \pmb{u}_k\)</span>とおく。式<a class="reference internal" href="#equation-eq-pca-projected-variance">(13.4)</a>より、これらのベクトルでデータを射影した後の分散の和<span class="math notranslate nohighlight">\(J_k\)</span>は、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>のスペクトル分解<span class="math notranslate nohighlight">\(\pmb{Q}\pmb{\Lambda}\pmb{Q}^\top\)</span>を用いて、次のように展開できる。</p>
<div class="math notranslate nohighlight" id="equation-eq-pca-objective">
<span class="eqno">(13.38)<a class="headerlink" href="#equation-eq-pca-objective" title="この数式へのパーマリンク">¶</a></span>\[\begin{split}
\begin{align}
J_k &amp;= \sum_{i=1}^k \pmb{u}_i^\top \pmb{S} \pmb{u}_i \\
&amp;= \sum_{i=1}^k \pmb{u}_i^\top (\pmb{Q} \pmb{\Lambda} \pmb{Q}^\top) \pmb{u}_i &amp;&amp; (\because \pmb{S} = \pmb{Q}\pmb{\Lambda}\pmb{Q}^\top) \\
&amp;= \sum_{i=1}^k \pmb{u}_i^\top \left( \sum_{j = 1}^{d} \lambda_j \pmb{q}_j \pmb{q}_j^\top \right) \pmb{u}_i &amp;&amp; (\mbox{スペクトル分解の別の形}) \\
&amp;= \sum_{j = 1}^{d} \lambda_j \sum_{i=1}^k (\pmb{u}_i^\top\pmb{q}_j)^2 &amp;&amp; (\because \pmb{u}_i^\top\pmb{q}_j = \pmb{q}_j^\top\pmb{u}_i) \\
&amp;= \sum_{j = 1}^{d} \lambda_j z_j &amp;&amp; (z_j := \sum_{i=1}^k (\pmb{u}_i^\top\pmb{q}_j)^2) \\
\end{align}
\end{split}\]</div>
<p>ゆえに、分散の和<span class="math notranslate nohighlight">\(J_k\)</span>は<span class="math notranslate nohighlight">\(d\)</span>個の固有値<span class="math notranslate nohighlight">\(\lambda_1, \dots, \lambda_d\)</span>の<span class="math notranslate nohighlight">\(z_1, \dots, z_d\)</span>による重み付き和として表される。そこで、<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>に関して<span class="math notranslate nohighlight">\(z_j\)</span>の性質を調べる。まず、ベッセルの不等式より、</p>
<div class="amsmath math notranslate nohighlight" id="equation-ee59ac9f-5d35-43fc-9b8a-7fe81282aace">
<span class="eqno">(13.39)<a class="headerlink" href="#equation-ee59ac9f-5d35-43fc-9b8a-7fe81282aace" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
z_j = \sum_{i=1}^k (\pmb{u}_i^\top\pmb{q}_j)^2 \leq \|\pmb{q}_j\|^2 = 1
\end{align}\]</div>
<p>さらに、<span class="math notranslate nohighlight">\(z_j\)</span>の和は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-93e6268b-1ab0-41bf-8757-101db8c56845">
<span class="eqno">(13.40)<a class="headerlink" href="#equation-93e6268b-1ab0-41bf-8757-101db8c56845" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\sum_{j = 1}^{d} z_j = \sum_{j = 1}^{d} \sum_{i=1}^k (\pmb{u}_i^\top\pmb{q}_j)^2 = \sum_{i=1}^k \sum_{j = 1}^{d} \pmb{u}_i^\top\pmb{q}_j \pmb{q}_j^\top\pmb{u}_i = \sum_{i=1}^k \pmb{u}_i^\top\pmb{Q} \pmb{Q}^\top\pmb{u}_i = \sum_{i=1}^k \pmb{u}_i^\top\pmb{u}_i = k
\end{align}\]</div>
<p>したがって、式<a class="reference internal" href="#equation-eq-pca-objective">(13.38)</a>は<span class="math notranslate nohighlight">\(0 \leq z_j \leq 1\)</span>かつ、<span class="math notranslate nohighlight">\(\sum_{j = 1}^{d} z_j = k\)</span>による固有値<span class="math notranslate nohighlight">\(\lambda_1, \dots, \lambda_d\)</span>の重み付き和である。式<a class="reference internal" href="#equation-eq-eigenvalue-order">(13.33)</a>のように、分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値を大きい順に並べてある場合、式<a class="reference internal" href="#equation-eq-pca-objective">(13.38)</a>が最大となるのは、<span class="math notranslate nohighlight">\(z_1 = \dots = z_k = 1, z_{k+1} = \dots = z_d = 0\)</span>と選んだときである。<span class="math notranslate nohighlight">\(1 \leq j \leq k\)</span>に対して、<span class="math notranslate nohighlight">\(z_j = 1\)</span>を満たすには、<span class="math notranslate nohighlight">\(\pmb{u}_j = \pmb{q}_j\)</span>とすればよい。</p>
<p>まとめると、<span class="math notranslate nohighlight">\(k\)</span>個の直交基底ベクトルでデータ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>を射影した後の分散の和<span class="math notranslate nohighlight">\(J_k\)</span>の最大値は、</p>
<div class="math notranslate nohighlight" id="equation-eq-pca-maximum-variance">
<span class="eqno">(13.41)<a class="headerlink" href="#equation-eq-pca-maximum-variance" title="この数式へのパーマリンク">¶</a></span>\[
\begin{align}
\max J_k = \sum_{i=1}^k \lambda_i
\end{align}
\]</div>
<p>この最大値は、データを<span class="math notranslate nohighlight">\(\pmb{q}_1, \dots, \pmb{q}_k\)</span>で射影した時に得られる。</p>
<p><a class="reference internal" href="#sec-eigen-and-pca"><span class="std std-ref">固有値問題と主成分分析</span></a>では、データの分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値を大きい順に並べ、対応する固有ベクトルを主成分ベクトルとして一つずつ選んでいた。式<a class="reference internal" href="#equation-eq-pca-maximum-variance">(13.41)</a>は、<span class="math notranslate nohighlight">\(k\)</span>個の直交基底ベクトルでデータを射影するとき、<span class="math notranslate nohighlight">\(\pmb{q}_1, \pmb{q}_2, \dots, \pmb{q}_k\)</span>を射影ベクトルに選ぶことで、射影後のデータの分散の和が最大となること、その分散の和の最大値が<span class="math notranslate nohighlight">\(\lambda_1 + \lambda_2 + \dots + \lambda_k\)</span>であることを保証している。</p>
</div>
</div>
<div class="section" id="id11">
<h2><span class="section-number">13.4. </span>主成分分析と次元圧縮<a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="margin sidebar">
<p class="sidebar-title">行列のトレース</p>
<p>行列<span class="math notranslate nohighlight">\(\pmb{A}\)</span>の対角成分の和をトレースと呼び、<span class="math notranslate nohighlight">\(\mathrm{tr}(\pmb{A})\)</span>で表す。</p>
</div>
<p>データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の対角成分の和は、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の分散の和である。<span class="math notranslate nohighlight">\(\pmb{S} = \pmb{Q} \pmb{\Lambda} \pmb{Q}^\top\)</span>のスペクトル分解を用いると、<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の対角成分の和は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-df103b1a-1567-4d4b-aeee-bdcef69c02ef">
<span class="eqno">(13.42)<a class="headerlink" href="#equation-df103b1a-1567-4d4b-aeee-bdcef69c02ef" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\mathrm{tr}(\pmb{S}) &amp;= \mathrm{tr}(\pmb{Q} \pmb{\Lambda} \pmb{Q}^\top) \\
&amp;= \mathrm{tr}(\lambda_1 \pmb{q}_1 \pmb{q}_1^\top + \lambda_2 \pmb{q}_2 \pmb{q}_2^\top + \dots + \lambda_d \pmb{q}_d \pmb{q}_d^\top) \\
&amp;= \lambda_1 \pmb{q}_1^\top \pmb{q}_1 + \lambda_2 \pmb{q}_2^\top \pmb{q}_2 + \dots + \lambda_d \pmb{q}_d^\top \pmb{q}_d \\
&amp;= \lambda_1 + \lambda_2 + \dots + \lambda_d \\
\end{align}\]</div>
<p>つまり、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の分散の和は分散共分散行列<span class="math notranslate nohighlight">\(\pmb{S}\)</span>の固有値の和に等しい</p>
<p>第<span class="math notranslate nohighlight">\(k\)</span>主成分に対応する固有値<span class="math notranslate nohighlight">\(\lambda_k\)</span>は、元のデータ<span class="math notranslate nohighlight">\(X\)</span>を第<span class="math notranslate nohighlight">\(k\)</span>主成分の軸に射影したときの分散を表す。全ての主成分における分散の総和に対し、第<span class="math notranslate nohighlight">\(k\)</span>主成分の分散が占める割合を第<span class="math notranslate nohighlight">\(k\)</span>主成分の<strong>寄与率</strong>と呼ぶ。</p>
<div class="important admonition">
<p class="admonition-title">寄与率</p>
<div class="amsmath math notranslate nohighlight" id="equation-fc5aa19c-ac92-42c4-8bec-977461ace859">
<span class="eqno">(13.43)<a class="headerlink" href="#equation-fc5aa19c-ac92-42c4-8bec-977461ace859" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\frac{\lambda_k}{\sum_{i=1}^d \lambda_i} = \frac{\lambda_k}{\lambda_1 + \lambda_2 + \dots + \lambda_d}
\end{align}\]</div>
</div>
<p>また、第<span class="math notranslate nohighlight">\(k\)</span>主成分までに表現された分散の総和が、データ全体の分散の総和に占める割合を第<span class="math notranslate nohighlight">\(k\)</span>主成分までの<strong>累積寄与率</strong>と呼ぶ。</p>
<div class="important admonition">
<p class="admonition-title">累積寄与率</p>
<div class="amsmath math notranslate nohighlight" id="equation-78c9a0a6-70b8-450e-b801-e198d096978e">
<span class="eqno">(13.44)<a class="headerlink" href="#equation-78c9a0a6-70b8-450e-b801-e198d096978e" title="この数式へのパーマリンク">¶</a></span>\[\begin{align}
\frac{\sum_{i=1}^k \lambda_i}{\sum_{i=1}^d \lambda_i} = \frac{\lambda_1 + \lambda_2 \dots + \lambda_k}{\lambda_1 + \lambda_2 + \dots + \lambda_d}
\end{align}\]</div>
</div>
<p>累積寄与率は、元々<span class="math notranslate nohighlight">\(d\)</span>次元のベクトルで表されていたデータ点を主成分分析で<span class="math notranslate nohighlight">\(k\)</span>次元に圧縮したとき、元データの分散をどの程度表現できているかを表す指標である。</p>
</div>
<div class="section" id="id12">
<h2><span class="section-number">13.5. </span>応用例 (1): 麺類の支出額<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>前章の冒頭で紹介した<a class="reference external" href="https://www.nstac.go.jp/SSDSE/">教育用標準データセット（SSDSE: Standardized Statistical Data Set for Education）</a>の「C. 都道府県庁所在市別、家計消費データ」から麺類だけを抜き出したデータを2次元平面上で可視化してみよう。まず、データを読み込んで表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;https://www.nstac.go.jp/SSDSE/data/2021/SSDSE-C-2021.xlsx&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;都道府県&#39;</span><span class="p">,</span> <span class="s1">&#39;生うどん・そば&#39;</span><span class="p">,</span> <span class="s2">&quot;乾うどん・そば&quot;</span><span class="p">,</span> <span class="s2">&quot;パスタ&quot;</span><span class="p">,</span> <span class="s2">&quot;中華麺&quot;</span><span class="p">,</span> <span class="s2">&quot;カップ麺&quot;</span><span class="p">,</span> <span class="s2">&quot;即席麺&quot;</span><span class="p">,</span> <span class="s2">&quot;他の麺類&quot;</span><span class="p">]]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>都道府県</th>
      <th>生うどん・そば</th>
      <th>乾うどん・そば</th>
      <th>パスタ</th>
      <th>中華麺</th>
      <th>カップ麺</th>
      <th>即席麺</th>
      <th>他の麺類</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>北海道</td>
      <td>3162</td>
      <td>2082</td>
      <td>1266</td>
      <td>4152</td>
      <td>5189</td>
      <td>1609</td>
      <td>726</td>
    </tr>
    <tr>
      <th>2</th>
      <td>青森県</td>
      <td>2964</td>
      <td>2224</td>
      <td>1114</td>
      <td>5271</td>
      <td>6088</td>
      <td>2039</td>
      <td>554</td>
    </tr>
    <tr>
      <th>3</th>
      <td>岩手県</td>
      <td>3349</td>
      <td>2475</td>
      <td>1305</td>
      <td>5991</td>
      <td>5985</td>
      <td>1889</td>
      <td>898</td>
    </tr>
    <tr>
      <th>4</th>
      <td>宮城県</td>
      <td>3068</td>
      <td>2407</td>
      <td>1339</td>
      <td>5017</td>
      <td>5295</td>
      <td>1709</td>
      <td>842</td>
    </tr>
    <tr>
      <th>5</th>
      <td>秋田県</td>
      <td>3231</td>
      <td>3409</td>
      <td>1019</td>
      <td>5172</td>
      <td>5013</td>
      <td>1680</td>
      <td>554</td>
    </tr>
    <tr>
      <th>6</th>
      <td>山形県</td>
      <td>4478</td>
      <td>3084</td>
      <td>1288</td>
      <td>5236</td>
      <td>5875</td>
      <td>1745</td>
      <td>754</td>
    </tr>
    <tr>
      <th>7</th>
      <td>福島県</td>
      <td>2963</td>
      <td>2705</td>
      <td>1064</td>
      <td>4397</td>
      <td>5862</td>
      <td>1687</td>
      <td>919</td>
    </tr>
    <tr>
      <th>8</th>
      <td>茨城県</td>
      <td>3353</td>
      <td>2477</td>
      <td>1248</td>
      <td>4034</td>
      <td>4562</td>
      <td>1440</td>
      <td>653</td>
    </tr>
    <tr>
      <th>9</th>
      <td>栃木県</td>
      <td>3908</td>
      <td>2218</td>
      <td>1391</td>
      <td>4534</td>
      <td>4945</td>
      <td>1860</td>
      <td>742</td>
    </tr>
    <tr>
      <th>10</th>
      <td>群馬県</td>
      <td>4563</td>
      <td>1948</td>
      <td>1203</td>
      <td>4153</td>
      <td>5049</td>
      <td>1544</td>
      <td>546</td>
    </tr>
    <tr>
      <th>11</th>
      <td>埼玉県</td>
      <td>4016</td>
      <td>2256</td>
      <td>1487</td>
      <td>4512</td>
      <td>4584</td>
      <td>1568</td>
      <td>949</td>
    </tr>
    <tr>
      <th>12</th>
      <td>千葉県</td>
      <td>3389</td>
      <td>2277</td>
      <td>1441</td>
      <td>4582</td>
      <td>4513</td>
      <td>1840</td>
      <td>835</td>
    </tr>
    <tr>
      <th>13</th>
      <td>東京都</td>
      <td>3088</td>
      <td>2385</td>
      <td>1595</td>
      <td>4592</td>
      <td>3953</td>
      <td>1734</td>
      <td>974</td>
    </tr>
    <tr>
      <th>14</th>
      <td>神奈川県</td>
      <td>3410</td>
      <td>2684</td>
      <td>1472</td>
      <td>4484</td>
      <td>4035</td>
      <td>1741</td>
      <td>1049</td>
    </tr>
    <tr>
      <th>15</th>
      <td>新潟県</td>
      <td>2697</td>
      <td>3409</td>
      <td>1308</td>
      <td>4192</td>
      <td>6095</td>
      <td>2201</td>
      <td>612</td>
    </tr>
    <tr>
      <th>16</th>
      <td>富山県</td>
      <td>3294</td>
      <td>2738</td>
      <td>1184</td>
      <td>4367</td>
      <td>5576</td>
      <td>1928</td>
      <td>491</td>
    </tr>
    <tr>
      <th>17</th>
      <td>石川県</td>
      <td>3597</td>
      <td>2233</td>
      <td>1339</td>
      <td>5159</td>
      <td>4408</td>
      <td>1880</td>
      <td>607</td>
    </tr>
    <tr>
      <th>18</th>
      <td>福井県</td>
      <td>4124</td>
      <td>2549</td>
      <td>1200</td>
      <td>4247</td>
      <td>3838</td>
      <td>1875</td>
      <td>387</td>
    </tr>
    <tr>
      <th>19</th>
      <td>山梨県</td>
      <td>3870</td>
      <td>1947</td>
      <td>1123</td>
      <td>4529</td>
      <td>4786</td>
      <td>1580</td>
      <td>660</td>
    </tr>
    <tr>
      <th>20</th>
      <td>長野県</td>
      <td>4075</td>
      <td>2705</td>
      <td>1267</td>
      <td>4333</td>
      <td>4346</td>
      <td>1620</td>
      <td>808</td>
    </tr>
    <tr>
      <th>21</th>
      <td>岐阜県</td>
      <td>3154</td>
      <td>2106</td>
      <td>1239</td>
      <td>3816</td>
      <td>4566</td>
      <td>1907</td>
      <td>650</td>
    </tr>
    <tr>
      <th>22</th>
      <td>静岡県</td>
      <td>3045</td>
      <td>2414</td>
      <td>1319</td>
      <td>5106</td>
      <td>4582</td>
      <td>1682</td>
      <td>935</td>
    </tr>
    <tr>
      <th>23</th>
      <td>愛知県</td>
      <td>3991</td>
      <td>2198</td>
      <td>1394</td>
      <td>4239</td>
      <td>4490</td>
      <td>1882</td>
      <td>731</td>
    </tr>
    <tr>
      <th>24</th>
      <td>三重県</td>
      <td>3720</td>
      <td>2190</td>
      <td>1251</td>
      <td>4176</td>
      <td>4222</td>
      <td>1922</td>
      <td>595</td>
    </tr>
    <tr>
      <th>25</th>
      <td>滋賀県</td>
      <td>3835</td>
      <td>2004</td>
      <td>1295</td>
      <td>4121</td>
      <td>4397</td>
      <td>1976</td>
      <td>659</td>
    </tr>
    <tr>
      <th>26</th>
      <td>京都府</td>
      <td>3816</td>
      <td>2160</td>
      <td>1345</td>
      <td>4136</td>
      <td>3216</td>
      <td>1959</td>
      <td>596</td>
    </tr>
    <tr>
      <th>27</th>
      <td>大阪府</td>
      <td>3999</td>
      <td>1599</td>
      <td>1013</td>
      <td>3567</td>
      <td>5564</td>
      <td>2246</td>
      <td>540</td>
    </tr>
    <tr>
      <th>28</th>
      <td>兵庫県</td>
      <td>3437</td>
      <td>1988</td>
      <td>1129</td>
      <td>3914</td>
      <td>4630</td>
      <td>1984</td>
      <td>795</td>
    </tr>
    <tr>
      <th>29</th>
      <td>奈良県</td>
      <td>3543</td>
      <td>2727</td>
      <td>1229</td>
      <td>3973</td>
      <td>4067</td>
      <td>2003</td>
      <td>617</td>
    </tr>
    <tr>
      <th>30</th>
      <td>和歌山県</td>
      <td>3024</td>
      <td>2363</td>
      <td>940</td>
      <td>3603</td>
      <td>3972</td>
      <td>1921</td>
      <td>502</td>
    </tr>
    <tr>
      <th>31</th>
      <td>鳥取県</td>
      <td>3455</td>
      <td>1684</td>
      <td>1251</td>
      <td>3700</td>
      <td>5687</td>
      <td>3007</td>
      <td>436</td>
    </tr>
    <tr>
      <th>32</th>
      <td>島根県</td>
      <td>3456</td>
      <td>2314</td>
      <td>1316</td>
      <td>4166</td>
      <td>4233</td>
      <td>2086</td>
      <td>421</td>
    </tr>
    <tr>
      <th>33</th>
      <td>岡山県</td>
      <td>3384</td>
      <td>2219</td>
      <td>1425</td>
      <td>3958</td>
      <td>4655</td>
      <td>2036</td>
      <td>522</td>
    </tr>
    <tr>
      <th>34</th>
      <td>広島県</td>
      <td>3285</td>
      <td>1851</td>
      <td>1404</td>
      <td>4036</td>
      <td>4047</td>
      <td>2077</td>
      <td>585</td>
    </tr>
    <tr>
      <th>35</th>
      <td>山口県</td>
      <td>3426</td>
      <td>1840</td>
      <td>1164</td>
      <td>3342</td>
      <td>4937</td>
      <td>2533</td>
      <td>535</td>
    </tr>
    <tr>
      <th>36</th>
      <td>徳島県</td>
      <td>3692</td>
      <td>2106</td>
      <td>1107</td>
      <td>3340</td>
      <td>4149</td>
      <td>2038</td>
      <td>409</td>
    </tr>
    <tr>
      <th>37</th>
      <td>香川県</td>
      <td>6558</td>
      <td>3940</td>
      <td>972</td>
      <td>3661</td>
      <td>4412</td>
      <td>2170</td>
      <td>411</td>
    </tr>
    <tr>
      <th>38</th>
      <td>愛媛県</td>
      <td>3744</td>
      <td>1939</td>
      <td>1197</td>
      <td>3624</td>
      <td>3728</td>
      <td>1825</td>
      <td>498</td>
    </tr>
    <tr>
      <th>39</th>
      <td>高知県</td>
      <td>3333</td>
      <td>1513</td>
      <td>1134</td>
      <td>3306</td>
      <td>5126</td>
      <td>2234</td>
      <td>478</td>
    </tr>
    <tr>
      <th>40</th>
      <td>福岡県</td>
      <td>2877</td>
      <td>1745</td>
      <td>1354</td>
      <td>3376</td>
      <td>4084</td>
      <td>2128</td>
      <td>640</td>
    </tr>
    <tr>
      <th>41</th>
      <td>佐賀県</td>
      <td>2428</td>
      <td>2032</td>
      <td>1132</td>
      <td>3251</td>
      <td>4329</td>
      <td>2330</td>
      <td>517</td>
    </tr>
    <tr>
      <th>42</th>
      <td>長崎県</td>
      <td>2556</td>
      <td>1882</td>
      <td>1066</td>
      <td>3720</td>
      <td>4054</td>
      <td>1893</td>
      <td>463</td>
    </tr>
    <tr>
      <th>43</th>
      <td>熊本県</td>
      <td>2307</td>
      <td>1647</td>
      <td>1303</td>
      <td>2840</td>
      <td>4631</td>
      <td>2864</td>
      <td>501</td>
    </tr>
    <tr>
      <th>44</th>
      <td>大分県</td>
      <td>2493</td>
      <td>1597</td>
      <td>1074</td>
      <td>3164</td>
      <td>4158</td>
      <td>2384</td>
      <td>552</td>
    </tr>
    <tr>
      <th>45</th>
      <td>宮崎県</td>
      <td>2668</td>
      <td>1573</td>
      <td>1185</td>
      <td>3290</td>
      <td>4098</td>
      <td>2232</td>
      <td>463</td>
    </tr>
    <tr>
      <th>46</th>
      <td>鹿児島県</td>
      <td>2868</td>
      <td>2391</td>
      <td>1289</td>
      <td>3524</td>
      <td>3994</td>
      <td>2054</td>
      <td>462</td>
    </tr>
    <tr>
      <th>47</th>
      <td>沖縄県</td>
      <td>1753</td>
      <td>1488</td>
      <td>1012</td>
      <td>4424</td>
      <td>3342</td>
      <td>1481</td>
      <td>229</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>7種類の麺類の品目に関して、47都道府県庁所在市別の年間支出金額が収録されたデータである。したがって、データ<span class="math notranslate nohighlight">\(\pmb{X}\)</span>は<span class="math notranslate nohighlight">\(47 \times 7\)</span>の行列で表される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[3162, 2082, 1266, 4152, 5189, 1609,  726],
       [2964, 2224, 1114, 5271, 6088, 2039,  554],
       [3349, 2475, 1305, 5991, 5985, 1889,  898],
       [3068, 2407, 1339, 5017, 5295, 1709,  842],
       [3231, 3409, 1019, 5172, 5013, 1680,  554],
       [4478, 3084, 1288, 5236, 5875, 1745,  754],
       [2963, 2705, 1064, 4397, 5862, 1687,  919],
       [3353, 2477, 1248, 4034, 4562, 1440,  653],
       [3908, 2218, 1391, 4534, 4945, 1860,  742],
       [4563, 1948, 1203, 4153, 5049, 1544,  546],
       [4016, 2256, 1487, 4512, 4584, 1568,  949],
       [3389, 2277, 1441, 4582, 4513, 1840,  835],
       [3088, 2385, 1595, 4592, 3953, 1734,  974],
       [3410, 2684, 1472, 4484, 4035, 1741, 1049],
       [2697, 3409, 1308, 4192, 6095, 2201,  612],
       [3294, 2738, 1184, 4367, 5576, 1928,  491],
       [3597, 2233, 1339, 5159, 4408, 1880,  607],
       [4124, 2549, 1200, 4247, 3838, 1875,  387],
       [3870, 1947, 1123, 4529, 4786, 1580,  660],
       [4075, 2705, 1267, 4333, 4346, 1620,  808],
       [3154, 2106, 1239, 3816, 4566, 1907,  650],
       [3045, 2414, 1319, 5106, 4582, 1682,  935],
       [3991, 2198, 1394, 4239, 4490, 1882,  731],
       [3720, 2190, 1251, 4176, 4222, 1922,  595],
       [3835, 2004, 1295, 4121, 4397, 1976,  659],
       [3816, 2160, 1345, 4136, 3216, 1959,  596],
       [3999, 1599, 1013, 3567, 5564, 2246,  540],
       [3437, 1988, 1129, 3914, 4630, 1984,  795],
       [3543, 2727, 1229, 3973, 4067, 2003,  617],
       [3024, 2363,  940, 3603, 3972, 1921,  502],
       [3455, 1684, 1251, 3700, 5687, 3007,  436],
       [3456, 2314, 1316, 4166, 4233, 2086,  421],
       [3384, 2219, 1425, 3958, 4655, 2036,  522],
       [3285, 1851, 1404, 4036, 4047, 2077,  585],
       [3426, 1840, 1164, 3342, 4937, 2533,  535],
       [3692, 2106, 1107, 3340, 4149, 2038,  409],
       [6558, 3940,  972, 3661, 4412, 2170,  411],
       [3744, 1939, 1197, 3624, 3728, 1825,  498],
       [3333, 1513, 1134, 3306, 5126, 2234,  478],
       [2877, 1745, 1354, 3376, 4084, 2128,  640],
       [2428, 2032, 1132, 3251, 4329, 2330,  517],
       [2556, 1882, 1066, 3720, 4054, 1893,  463],
       [2307, 1647, 1303, 2840, 4631, 2864,  501],
       [2493, 1597, 1074, 3164, 4158, 2384,  552],
       [2668, 1573, 1185, 3290, 4098, 2232,  463],
       [2868, 2391, 1289, 3524, 3994, 2054,  462],
       [1753, 1488, 1012, 4424, 3342, 1481,  229]])
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(\pmb{X}\)</span>の各事例に対応する都道府県名を変数<code class="docutils literal notranslate"><span class="pre">C</span></code>に保存しておく。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">C</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;北海道&#39;, &#39;青森県&#39;, &#39;岩手県&#39;, &#39;宮城県&#39;, &#39;秋田県&#39;, &#39;山形県&#39;, &#39;福島県&#39;, &#39;茨城県&#39;, &#39;栃木県&#39;,
       &#39;群馬県&#39;, &#39;埼玉県&#39;, &#39;千葉県&#39;, &#39;東京都&#39;, &#39;神奈川県&#39;, &#39;新潟県&#39;, &#39;富山県&#39;, &#39;石川県&#39;, &#39;福井県&#39;,
       &#39;山梨県&#39;, &#39;長野県&#39;, &#39;岐阜県&#39;, &#39;静岡県&#39;, &#39;愛知県&#39;, &#39;三重県&#39;, &#39;滋賀県&#39;, &#39;京都府&#39;, &#39;大阪府&#39;,
       &#39;兵庫県&#39;, &#39;奈良県&#39;, &#39;和歌山県&#39;, &#39;鳥取県&#39;, &#39;島根県&#39;, &#39;岡山県&#39;, &#39;広島県&#39;, &#39;山口県&#39;, &#39;徳島県&#39;,
       &#39;香川県&#39;, &#39;愛媛県&#39;, &#39;高知県&#39;, &#39;福岡県&#39;, &#39;佐賀県&#39;, &#39;長崎県&#39;, &#39;熊本県&#39;, &#39;大分県&#39;, &#39;宮崎県&#39;,
       &#39;鹿児島県&#39;, &#39;沖縄県&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(\pmb{X}\)</span>の品目名を変数<code class="docutils literal notranslate"><span class="pre">F</span></code>に保存しておく。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">F</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;生うどん・そば&#39;, &#39;乾うどん・そば&#39;, &#39;パスタ&#39;, &#39;中華麺&#39;, &#39;カップ麺&#39;, &#39;即席麺&#39;, &#39;他の麺類&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<p>データの傾向を掴むために、散布図行列を描画してみる。対角部分はヒストグラム、非対角部分は2つの変数間に着目した場合の散布図が示される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">plotting</span> 
<span class="n">plotting</span><span class="o">.</span><span class="n">scatter_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_21_0.png" src="../_images/04pca2_21_0.png" />
</div>
</div>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">sklearn.decomposition.PCA</a>を用いて主成分分析を実行する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>7個の主成分ベクトル（PC1からPC7）を表示する。第1主成分ベクトルの係数が概ね正であるので、第1主成分得点は麺類の消費の多さを反映すると考えられる。第2主成分ベクトルの係数は、「うどん・そば」では正、「中華麺」や「カップ麺」では負であるので、うどん・そばの消費の多さを反映すると考えられる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">F</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">n_components_</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>生うどん・そば</th>
      <th>乾うどん・そば</th>
      <th>パスタ</th>
      <th>中華麺</th>
      <th>カップ麺</th>
      <th>即席麺</th>
      <th>他の麺類</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PC1</th>
      <td>0.5050</td>
      <td>0.4089</td>
      <td>0.0169</td>
      <td>0.5472</td>
      <td>0.5031</td>
      <td>-0.1329</td>
      <td>0.0858</td>
    </tr>
    <tr>
      <th>PC2</th>
      <td>0.7567</td>
      <td>0.1505</td>
      <td>-0.0064</td>
      <td>-0.2922</td>
      <td>-0.5624</td>
      <td>-0.0256</td>
      <td>-0.0487</td>
    </tr>
    <tr>
      <th>PC3</th>
      <td>-0.2577</td>
      <td>0.1220</td>
      <td>0.0783</td>
      <td>0.6099</td>
      <td>-0.6228</td>
      <td>-0.3794</td>
      <td>0.0938</td>
    </tr>
    <tr>
      <th>PC4</th>
      <td>-0.3246</td>
      <td>0.8904</td>
      <td>-0.0693</td>
      <td>-0.2862</td>
      <td>-0.0487</td>
      <td>0.0988</td>
      <td>-0.0550</td>
    </tr>
    <tr>
      <th>PC5</th>
      <td>0.0214</td>
      <td>0.0239</td>
      <td>0.2031</td>
      <td>0.3552</td>
      <td>-0.1849</td>
      <td>0.8891</td>
      <td>-0.0829</td>
    </tr>
    <tr>
      <th>PC6</th>
      <td>0.0054</td>
      <td>-0.0359</td>
      <td>-0.6138</td>
      <td>0.1797</td>
      <td>-0.0219</td>
      <td>-0.0069</td>
      <td>-0.7675</td>
    </tr>
    <tr>
      <th>PC7</th>
      <td>-0.0093</td>
      <td>0.0255</td>
      <td>0.7555</td>
      <td>-0.0536</td>
      <td>0.0759</td>
      <td>-0.1934</td>
      <td>-0.6184</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>主成分分析により、各データ点を第1から第7主成分に射影したときの主成分得点を表形式で表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">n_components_</span><span class="p">)],</span> <span class="n">index</span><span class="o">=</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PC1</th>
      <th>PC2</th>
      <th>PC3</th>
      <th>PC4</th>
      <th>PC5</th>
      <th>PC6</th>
      <th>PC7</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>北海道</th>
      <td>153.4222</td>
      <td>-534.3034</td>
      <td>-152.1148</td>
      <td>-141.8253</td>
      <td>-420.6236</td>
      <td>-98.0002</td>
      <td>65.1171</td>
    </tr>
    <tr>
      <th>青森県</th>
      <td>1101.6032</td>
      <td>-1496.8960</td>
      <td>-152.2914</td>
      <td>-252.7109</td>
      <td>175.4282</td>
      <td>299.5492</td>
      <td>-12.7754</td>
    </tr>
    <tr>
      <th>岩手県</th>
      <td>1793.4762</td>
      <td>-1334.3605</td>
      <td>386.5550</td>
      <td>-402.2430</td>
      <td>341.3197</td>
      <td>43.9761</td>
      <td>-95.7998</td>
    </tr>
    <tr>
      <th>宮城県</th>
      <td>763.3783</td>
      <td>-877.5282</td>
      <td>352.0041</td>
      <td>-76.2460</td>
      <td>-33.1394</td>
      <td>-91.6132</td>
      <td>0.0315</td>
    </tr>
    <tr>
      <th>秋田県</th>
      <td>1172.0693</td>
      <td>-473.2078</td>
      <td>661.3547</td>
      <td>767.5094</td>
      <td>34.5863</td>
      <td>324.9647</td>
      <td>-63.6768</td>
    </tr>
    <tr>
      <th>山形県</th>
      <td>2150.6186</td>
      <td>-95.0627</td>
      <td>-182.2755</td>
      <td>-10.1633</td>
      <td>12.6520</td>
      <td>16.8480</td>
      <td>45.4275</td>
    </tr>
    <tr>
      <th>福島県</th>
      <td>783.0933</td>
      <td>-1051.2636</td>
      <td>-321.7877</td>
      <td>385.6438</td>
      <td>-435.1023</td>
      <td>-116.8548</td>
      <td>-166.2046</td>
    </tr>
    <tr>
      <th>茨城県</th>
      <td>47.2661</td>
      <td>64.7670</td>
      <td>221.2223</td>
      <td>200.7490</td>
      <td>-480.9328</td>
      <td>-50.3860</td>
      <td>96.3663</td>
    </tr>
    <tr>
      <th>栃木県</th>
      <td>642.1218</td>
      <td>68.3046</td>
      <td>-26.7517</td>
      <td>-345.0909</td>
      <td>26.5946</td>
      <td>-115.6424</td>
      <td>58.6243</td>
    </tr>
    <tr>
      <th>群馬県</th>
      <td>728.3322</td>
      <td>594.9992</td>
      <td>-438.8713</td>
      <td>-701.5308</td>
      <td>-423.2849</td>
      <td>94.8302</td>
      <td>114.2694</td>
    </tr>
    <tr>
      <th>埼玉県</th>
      <td>576.7350</td>
      <td>361.9543</td>
      <td>299.1710</td>
      <td>-369.3226</td>
      <td>-168.5329</td>
      <td>-328.2688</td>
      <td>33.3482</td>
    </tr>
    <tr>
      <th>千葉県</th>
      <td>224.5805</td>
      <td>-90.9914</td>
      <td>432.7337</td>
      <td>-127.3440</td>
      <td>98.5016</td>
      <td>-204.3793</td>
      <td>13.7063</td>
    </tr>
    <tr>
      <th>東京都</th>
      <td>-130.8999</td>
      <td>4.4330</td>
      <td>943.6409</td>
      <td>62.1463</td>
      <td>127.2547</td>
      <td>-396.2840</td>
      <td>27.0850</td>
    </tr>
    <tr>
      <th>神奈川県</th>
      <td>139.5407</td>
      <td>275.5104</td>
      <td>774.9649</td>
      <td>255.8418</td>
      <td>62.7917</td>
      <td>-408.6177</td>
      <td>-96.9218</td>
    </tr>
    <tr>
      <th>新潟県</th>
      <td>851.1234</td>
      <td>-1217.4607</td>
      <td>-642.1768</td>
      <td>1196.9064</td>
      <td>-7.8734</td>
      <td>-103.1752</td>
      <td>157.6930</td>
    </tr>
    <tr>
      <th>富山県</th>
      <td>736.6941</td>
      <td>-612.2866</td>
      <td>-365.4479</td>
      <td>369.1469</td>
      <td>-110.8816</td>
      <td>137.8001</td>
      <td>120.1706</td>
    </tr>
    <tr>
      <th>石川県</th>
      <td>547.9223</td>
      <td>-39.0012</td>
      <td>746.5229</td>
      <td>-370.5084</td>
      <td>359.9966</td>
      <td>141.6180</td>
      <td>27.9426</td>
    </tr>
    <tr>
      <th>福井県</th>
      <td>136.8892</td>
      <td>1006.1167</td>
      <td>418.3710</td>
      <td>49.8097</td>
      <td>145.8780</td>
      <td>235.9303</td>
      <td>68.7181</td>
    </tr>
    <tr>
      <th>山梨県</th>
      <td>455.0597</td>
      <td>102.5065</td>
      <td>123.4897</td>
      <td>-569.4544</td>
      <td>-249.6373</td>
      <td>125.8385</td>
      <td>-57.3433</td>
    </tr>
    <tr>
      <th>長野県</th>
      <td>549.7100</td>
      <td>667.2875</td>
      <td>327.6183</td>
      <td>102.2576</td>
      <td>-162.8597</td>
      <td>-128.1230</td>
      <td>-53.2867</td>
    </tr>
    <tr>
      <th>岐阜県</th>
      <td>-384.6726</td>
      <td>-91.9716</td>
      <td>-86.3750</td>
      <td>44.1388</td>
      <td>-158.5730</td>
      <td>-72.7617</td>
      <td>5.4615</td>
    </tr>
    <tr>
      <th>静岡県</th>
      <td>455.8524</td>
      <td>-522.6362</td>
      <td>874.5050</td>
      <td>-59.6981</td>
      <td>94.2201</td>
      <td>-119.2878</td>
      <td>-125.8976</td>
    </tr>
    <tr>
      <th>愛知県</th>
      <td>281.7116</td>
      <td>470.1198</td>
      <td>43.7052</td>
      <td>-280.6772</td>
      <td>28.3411</td>
      <td>-151.0600</td>
      <td>43.4152</td>
    </tr>
    <tr>
      <th>三重県</th>
      <td>-47.1050</td>
      <td>439.4803</td>
      <td>201.9089</td>
      <td>-147.4071</td>
      <td>67.3410</td>
      <td>34.2168</td>
      <td>-2.9096</td>
    </tr>
    <tr>
      <th>滋賀県</th>
      <td>-8.0834</td>
      <td>411.3792</td>
      <td>-3.9890</td>
      <td>-344.3619</td>
      <td>65.1042</td>
      <td>-48.7050</td>
      <td>-9.2709</td>
    </tr>
    <tr>
      <th>京都府</th>
      <td>-542.1400</td>
      <td>1083.4309</td>
      <td>769.0285</td>
      <td>-147.7499</td>
      <td>292.4058</td>
      <td>-8.0488</td>
      <td>-15.5865</td>
    </tr>
    <tr>
      <th>大阪府</th>
      <td>142.2460</td>
      <td>-19.1879</td>
      <td>-1296.0106</td>
      <td>-603.7145</td>
      <td>-160.9610</td>
      <td>104.1794</td>
      <td>-94.4841</td>
    </tr>
    <tr>
      <th>兵庫県</th>
      <td>-203.8417</td>
      <td>31.4682</td>
      <td>-178.0018</td>
      <td>-176.7118</td>
      <td>-98.2611</td>
      <td>-95.1057</td>
      <td>-188.2460</td>
    </tr>
    <tr>
      <th>奈良県</th>
      <td>-115.2237</td>
      <td>529.8485</td>
      <td>255.3790</td>
      <td>462.1403</td>
      <td>98.6741</td>
      <td>-23.0343</td>
      <td>-34.3392</td>
    </tr>
    <tr>
      <th>和歌山県</th>
      <td>-780.2281</td>
      <td>253.3868</td>
      <td>175.8894</td>
      <td>435.2915</td>
      <td>-157.0167</td>
      <td>189.0887</td>
      <td>-157.5332</td>
    </tr>
    <tr>
      <th>鳥取県</th>
      <td>-69.1043</td>
      <td>-542.0104</td>
      <td>-1420.7600</td>
      <td>-331.0915</td>
      <td>587.4943</td>
      <td>47.9239</td>
      <td>11.8743</td>
    </tr>
    <tr>
      <th>島根県</th>
      <td>-165.2852</td>
      <td>258.9724</td>
      <td>198.6653</td>
      <td>72.2967</td>
      <td>232.5081</td>
      <td>118.8384</td>
      <td>129.0717</td>
    </tr>
    <tr>
      <th>岡山県</th>
      <td>-124.8443</td>
      <td>9.2985</td>
      <td>-147.0644</td>
      <td>32.0185</td>
      <td>46.0927</td>
      <td>-68.8385</td>
      <td>200.0767</td>
    </tr>
    <tr>
      <th>広島県</th>
      <td>-588.9009</td>
      <td>194.1220</td>
      <td>248.4702</td>
      <td>-254.1786</td>
      <td>202.2912</td>
      <td>-64.5546</td>
      <td>78.4911</td>
    </tr>
    <tr>
      <th>山口県</th>
      <td>-523.1440</td>
      <td>-6.2518</td>
      <td>-963.2277</td>
      <td>-90.0340</td>
      <td>154.8302</td>
      <td>-25.0465</td>
      <td>-56.9032</td>
    </tr>
    <tr>
      <th>徳島県</th>
      <td>-623.5714</td>
      <td>697.9746</td>
      <td>-338.2960</td>
      <td>61.3932</td>
      <td>-129.3636</td>
      <td>118.8313</td>
      <td>18.2818</td>
    </tr>
    <tr>
      <th>香川県</th>
      <td>1861.8465</td>
      <td>2898.5926</td>
      <td>-881.5167</td>
      <td>681.5892</td>
      <td>130.8813</td>
      <td>200.6197</td>
      <td>-87.5708</td>
    </tr>
    <tr>
      <th>愛媛県</th>
      <td>-684.5301</td>
      <td>866.4939</td>
      <td>159.5305</td>
      <td>-197.1324</td>
      <td>-132.0062</td>
      <td>63.2729</td>
      <td>20.4916</td>
    </tr>
    <tr>
      <th>高知県</th>
      <td>-594.0772</td>
      <td>-211.0039</td>
      <td>-1013.0915</td>
      <td>-374.2155</td>
      <td>-169.9183</td>
      <td>39.8092</td>
      <td>22.3229</td>
    </tr>
    <tr>
      <th>福岡県</th>
      <td>-1183.6986</td>
      <td>37.7734</td>
      <td>-103.0164</td>
      <td>-23.5416</td>
      <td>-19.5804</td>
      <td>-194.1989</td>
      <td>36.1238</td>
    </tr>
    <tr>
      <th>佐賀県</th>
      <td>-1279.3688</td>
      <td>-357.8023</td>
      <td>-286.6590</td>
      <td>443.6874</td>
      <td>32.6912</td>
      <td>-5.4547</td>
      <td>-57.7901</td>
    </tr>
    <tr>
      <th>長崎県</th>
      <td>-1105.4465</td>
      <td>-251.6660</td>
      <td>274.9161</td>
      <td>112.1158</td>
      <td>-148.1998</td>
      <td>175.8729</td>
      <td>-40.7751</td>
    </tr>
    <tr>
      <th>熊本県</th>
      <td>-1640.3146</td>
      <td>-571.0515</td>
      <td>-931.9119</td>
      <td>284.8872</td>
      <td>329.9288</td>
      <td>-169.0873</td>
      <td>14.2677</td>
    </tr>
    <tr>
      <th>大分県</th>
      <td>-1563.1952</td>
      <td>-255.2315</td>
      <td>-324.8045</td>
      <td>75.9314</td>
      <td>57.7498</td>
      <td>7.0017</td>
      <td>-153.7285</td>
    </tr>
    <tr>
      <th>宮崎県</th>
      <td>-1431.4404</td>
      <td>-121.9727</td>
      <td>-200.6135</td>
      <td>-53.1888</td>
      <td>11.5342</td>
      <td>33.9756</td>
      <td>1.0191</td>
    </tr>
    <tr>
      <th>鹿児島県</th>
      <td>-894.9367</td>
      <td>146.5679</td>
      <td>130.7319</td>
      <td>523.5690</td>
      <td>0.6234</td>
      <td>-11.8609</td>
      <td>113.2129</td>
    </tr>
    <tr>
      <th>沖縄県</th>
      <td>-1611.2403</td>
      <td>-701.6404</td>
      <td>1436.6764</td>
      <td>-168.9272</td>
      <td>-150.9670</td>
      <td>543.4036</td>
      <td>48.4329</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>用いる主成分の数<span class="math notranslate nohighlight">\(k\)</span>を横軸、累積寄与率を縦軸としてグラフを描画する。第2主成分までで元データの分散の約70%、第3主成分までで元データの分散の約90%を説明できることが分かる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pca</span><span class="o">.</span><span class="n">n_components_</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components (PCs)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative explained variance&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_29_0.png" src="../_images/04pca2_29_0.png" />
</div>
</div>
<p>第1主成分得点を横軸、第2主成分得点を縦軸として、各都道府県庁所在地の麺類の支出金額を2次元平面上にプロットしてみる。これだけでも、地理的に近い都道府県庁所在地が近くにプロットされるのが興味深い。第1主成分得点が最も高いのは山形市（山形県）であり、周辺に他の都道府県庁所在地がプロットされていないことから、麺類の支出金額が特徴的であることが分かる。ただ、他の都道府県を全く寄せ付けない圧倒的な存在感を示すのは、第1主成分得点と第2主成分得点のいずれも高い高松市（香川県）である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;PC 1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PC 2&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_31_0.png" src="../_images/04pca2_31_0.png" />
</div>
</div>
<p>各都道府県庁所在地がどの品目に支出するのかを表すため、各品目を2,000円消費したときの点を原点からの矢印で表示した。高松市（香川県）は「生うどん・そば」に対する支出が特徴的であること、青森市（青森県）はカップ麺に対する支出が特徴的であること、山形市（山形県）は麺類全般に対して支出していることが示唆される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;PC 1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PC 2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">F</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="n">label</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">,</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_33_0.png" src="../_images/04pca2_33_0.png" />
</div>
</div>
</div>
<div class="section" id="id13">
<h2><span class="section-number">13.6. </span>応用例 (2): 手書き文字<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>scikit-learnの<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_digits.html">sklearn.datasets.load_digits</a>を使い、手書き文字認識のデータセットを読み込む。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_digits</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_digits</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>読み込まれたデータは<span class="math notranslate nohighlight">\(1797\)</span>事例からなり、各事例は<span class="math notranslate nohighlight">\(64\)</span>（<span class="math notranslate nohighlight">\(8 \times 8\)</span>ピクセル）次元。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1797, 64)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1797,)
</pre></div>
</div>
</div>
</div>
<p>データ中の先頭の事例の画像をプロットする。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> 
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_40_0.png" src="../_images/04pca2_40_0.png" />
</div>
</div>
<p>入力データは<span class="math notranslate nohighlight">\(64\)</span>次元の特徴空間で表現されていたが、主成分分析を用いて特徴空間を<span class="math notranslate nohighlight">\(2\)</span>次元に圧縮する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>各事例の特徴空間の次元が<span class="math notranslate nohighlight">\(2\)</span>次元になった。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1797, 2)
</pre></div>
</div>
</div>
</div>
<p>先ほどの画像の特徴ベクトルを<span class="math notranslate nohighlight">\(2\)</span>次元に圧縮したものを表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-1.25946627, 21.2748836 ])
</pre></div>
</div>
</div>
</div>
<p>各事例の特徴ベクトルが<span class="math notranslate nohighlight">\(2\)</span>次元に圧縮されたので、それらを<span class="math notranslate nohighlight">\(2\)</span>次元平面上にプロットする。そのとき、画像の数字の正解で色分けを行うと、同じ数字の画像が近くにまとまっていることが確認できる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;PC 1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PC 2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">P</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Set1&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_48_0.png" src="../_images/04pca2_48_0.png" />
</div>
</div>
<p>第１主成分ベクトルと第２主成分ベクトルを２次元画像として可視化する。入力画像とこれらの主成分ベクトルとの内積で主成分得点（射影後の値）が計算される。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PC </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_50_0.png" src="../_images/04pca2_50_0.png" />
</div>
</div>
<p>横軸を主成分の数、縦軸を累積寄与率としてグラフを書いてみると、おおよそ10数個の主成分ベクトルでデータ全体の分散の80%以上をカバーできることが分かる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components (PCs)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative explained variance&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_52_0.png" src="../_images/04pca2_52_0.png" />
</div>
</div>
</div>
<div class="section" id="id14">
<h2><span class="section-number">13.7. </span>応用例 (3): 固有顔<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference external" href="https://ja.wikipedia.org/wiki/%E5%9B%BA%E6%9C%89%E9%A1%94">固有顔</a>（Eigenface）と呼ばれる手法を体験してみよう。固有顔は顔画像のデータに対して主成分分析を行い、主成分ベクトルを求めたもので、顔認識の特徴量抽出（の次元圧縮）に用いられる。今回は、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.fetch_lfw_people.html">sklearn.datasets.fetch_lfw_people</a>を用いて、顔画像のデータを読み込む。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_lfw_people</span>
<span class="n">faces</span> <span class="o">=</span> <span class="n">fetch_lfw_people</span><span class="p">(</span><span class="n">min_faces_per_person</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>読み込まれたデータは<span class="math notranslate nohighlight">\(1348\)</span>件で、それぞれ、縦が<span class="math notranslate nohighlight">\(62\)</span>ピクセル、横が<span class="math notranslate nohighlight">\(47\)</span>ピクセルの画像になっている。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">faces</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1348, 62, 47)
</pre></div>
</div>
</div>
</div>
<p>読み込まれた画像を、その人物名と一緒に表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary_r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">target_names</span><span class="p">[</span><span class="n">faces</span><span class="o">.</span><span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_58_0.png" src="../_images/04pca2_58_0.png" />
</div>
</div>
<p>顔画像データに主成分分析をかけて、150個の主成分ベクトルを求める。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PCA(n_components=150)
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.decomposition.PCA.html">sklearn.decomposition.PCA</a>は、主成分分析を行う前に、データの事例ベクトルの平均を自動的に取り除く。その平均を２次元で可視化することで、先ほどのデータセットの顔画像の「平均」を見ることができる（彫りが深い…）。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">mean_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_62_0.png" src="../_images/04pca2_62_0.png" />
</div>
</div>
<p>第1主成分から順に、第16主成分まで可視化してみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;bone&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;PC </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_64_0.png" src="../_images/04pca2_64_0.png" />
</div>
</div>
<p>横軸を主成分の数、縦軸を累積寄与率としてグラフを書いてみると、だいたい30個弱の主成分ベクトルでデータ全体の分散の80%以上をカバーできることが分かる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number of principal components (PCs)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative explained variance&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_66_0.png" src="../_images/04pca2_66_0.png" />
</div>
</div>
<p>画像データを<span class="math notranslate nohighlight">\(150\)</span>次元の空間に射影してから、元の画像の空間に戻してみると、元画像を少ない情報量に圧縮した画像を得ることができる。以下の可視化では、上段が元画像、下段が圧縮後の画像である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">PB</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary_r&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">PB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">47</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary_r&#39;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/04pca2_68_0.png" src="../_images/04pca2_68_0.png" />
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "chokkan/mlnote",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./unsupervised"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="03pca.html" title="前へ ページ">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">前へ</p>
            <p class="prev-next-title"><span class="section-number">12. </span>主成分分析 (1)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../notation.html" title="次へ ページ">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">次へ</p>
        <p class="prev-next-title">表記</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      <div class="extra_footer">
        © Copyright 2020-2022 by 岡崎 直観 (Naoaki Okazaki). この作品は<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">クリエイティブ・コモンズ 表示 - 非営利 - 改変禁止 4.0 国際 ライセンス</a>の下に提供されています。 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>　ただし、作品中のコードセル部分は<a rel="license" href="https://opensource.org/licenses/MIT">MITライセンス</a>の下に提供されています。

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>