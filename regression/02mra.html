
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>2. 重回帰 &#8212; 機械学習帳</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <link rel="canonical" href="https://chokkan.github.io/mlnote/regression/02mra.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="3. モデル選択と正則化" href="03regularization.html" />
    <link rel="prev" title="1. 単回帰" href="01sra.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="ja">
    

    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@chokkanorg">
    <meta name="twitter:title" content="機械学習帳">
    <meta name="twitter:description" content="機械学習帳は、機械学習を学ぶためのノート（帳）を、デジタル（機械）による新しいカタチの学習帳として実現することを目指しています。">
    <meta name="twitter:image" content="https://chokkan.github.io/mlnote/_static/mlnote.png">

    <!-- Google Analytics -->

    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5R9M0GR7MW"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-5R9M0GR7MW');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">機械学習帳</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  回帰
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01sra.html">
   1. 単回帰
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. 重回帰
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03regularization.html">
   3. モデル選択と正則化
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04sgd.html">
   4. 勾配法によるパラメータ推定
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  分類
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/01binary.html">
   5. 線形二値分類
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/02multi.html">
   6. 線形多クラス分類
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/03nn.html">
   7. ニューラルネットワーク (1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/04nntrain.html">
   8. ニューラルネットワーク (2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/05svm.html">
   9. サポートベクトルマシン
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  教師無し学習
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/01kmeans.html">
   10. 非階層的クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/02hac.html">
   11. 階層的クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/03pca.html">
   12. 主成分分析 (1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/04pca2.html">
   13. 主成分分析 (2)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  付録
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notation.html">
   表記
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../reference.html">
   参考文献・謝辞
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/chokkan/mlnote/main?urlpath=lab/tree/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/chokkan/mlnote/blob/main/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>

<span class="headerbtn__text-container">Colab</span>
</a>

      </li>

      <li>
        <a href="https://studiolab.sagemaker.aws/import/github/chokkan/mlnote/blob/main/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on SageMaker Studio Lab"
>

<span class="headerbtn__icon-container">
  <i class="fab fa-aws"></i>
</span>
<span class="headerbtn__text-container">SageMaker</span>

</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/chokkan/mlnote"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/chokkan/mlnote/issues/new?title=Issue%20on%20page%20%2Fregression/02mra.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   2.1. 重回帰
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   2.2. 表記法の定義
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     2.2.1. 単回帰を表現する
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   2.3. 目的関数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mra-minimization">
   2.4. 目的関数の最小化
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   2.5. 目的関数の微分（別の導出）
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   2.6. 目的関数は凸関数
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     2.6.1. 凸関数であるための条件
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     2.6.2. 目的関数が凸関数であることの証明
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   2.7. 重回帰の性質
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     2.7.1. 残差の和および平均は
     <span class="math notranslate nohighlight">
      \(0\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hat-y-y">
     2.7.2. 目的変数の推定値
     <span class="math notranslate nohighlight">
      \(\hat{y}\)
     </span>
     の平均値は観測値
     <span class="math notranslate nohighlight">
      \(y\)
     </span>
     の平均に等しい
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     2.7.3. 観測データの重心は回帰平面上に存在する
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     2.7.4. 各説明変数と残差には相関がない
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     2.7.5. 目的変数の推定値と残差には相関がない
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   2.8. 決定係数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id18">
   2.9. 重回帰の実施例
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy-polynomial">
     2.9.1. numpy.polynomialを用いる例
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
     2.9.2. sklearn.linear_model.LinearRegressionを用いる例
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id19">
   2.10. 確認問題
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>重回帰</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   2.1. 重回帰
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   2.2. 表記法の定義
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     2.2.1. 単回帰を表現する
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   2.3. 目的関数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mra-minimization">
   2.4. 目的関数の最小化
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   2.5. 目的関数の微分（別の導出）
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   2.6. 目的関数は凸関数
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     2.6.1. 凸関数であるための条件
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     2.6.2. 目的関数が凸関数であることの証明
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   2.7. 重回帰の性質
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     2.7.1. 残差の和および平均は
     <span class="math notranslate nohighlight">
      \(0\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hat-y-y">
     2.7.2. 目的変数の推定値
     <span class="math notranslate nohighlight">
      \(\hat{y}\)
     </span>
     の平均値は観測値
     <span class="math notranslate nohighlight">
      \(y\)
     </span>
     の平均に等しい
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     2.7.3. 観測データの重心は回帰平面上に存在する
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id15">
     2.7.4. 各説明変数と残差には相関がない
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     2.7.5. 目的変数の推定値と残差には相関がない
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   2.8. 決定係数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id18">
   2.9. 重回帰の実施例
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy-polynomial">
     2.9.1. numpy.polynomialを用いる例
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
     2.9.2. sklearn.linear_model.LinearRegressionを用いる例
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id19">
   2.10. 確認問題
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1><span class="section-number">2. </span>重回帰<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">#</a></h1>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install japanize-matplotlib
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: japanize-matplotlib in /home/okazaki/.local/lib/python3.8/site-packages (1.1.3)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from japanize-matplotlib) (3.5.1)
Requirement already satisfied: numpy&gt;=1.17 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (1.22.2)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (1.3.2)
Requirement already satisfied: python-dateutil&gt;=2.7 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (2.8.2)
Requirement already satisfied: fonttools&gt;=4.22.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (4.29.1)
Requirement already satisfied: packaging&gt;=20.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (21.3)
Requirement already satisfied: pillow&gt;=6.2.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (9.0.1)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (0.11.0)
Requirement already satisfied: pyparsing&gt;=2.2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (3.0.7)
Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&gt;=2.7-&gt;matplotlib-&gt;japanize-matplotlib) (1.14.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">japanize_matplotlib</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h2><span class="section-number">2.1. </span>重回帰<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">#</a></h2>
<p><span class="math notranslate nohighlight">\(\def\bm{\boldsymbol}\)</span>これまで、以下のデータ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>を例として単回帰を説明した。</p>
<div class="amsmath math notranslate nohighlight" id="equation-a7a1af77-c896-4153-b837-38817dff9da5">
<span class="eqno">(2.1)<a class="headerlink" href="#equation-a7a1af77-c896-4153-b837-38817dff9da5" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathcal{D}_s = \left\{(x_i, y_i)\right\}_{i=1}^{4} = \left\{(1, 3), (3, 6), (6, 5), (8, 7)\right\}
\end{align}\]</div>
<p>また、求めた回帰直線をデータ点とともにプロットしたものを以下に示す。</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.431</span><span class="p">,</span> <span class="mf">3.310</span> 
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">D</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">D</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;tab:red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$y = </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">x + </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">row</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">),</span> <span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_4_0.png" src="../_images/02mra_4_0.png" />
</div>
</div>
<p>残差の平均二乗和が最小になるような直線を引いたはずであるが、残差を完全に無くすことはできなかった（決定係数を求めてみると<span class="math notranslate nohighlight">\(0.616\)</span>であり、あまり高くない）。プロットされている点を眺めると、３次関数を当てはめる方が向いているように思われる。そこで、１次関数よりも表現力が高いモデルとして、<span class="math notranslate nohighlight">\(d\)</span>次の多項式の一般形、</p>
<div class="amsmath math notranslate nohighlight" id="equation-55e31b94-e6fd-4c36-bb13-aafd04995f24">
<span class="eqno">(2.2)<a class="headerlink" href="#equation-55e31b94-e6fd-4c36-bb13-aafd04995f24" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = w_0 + w_1 x + w_2 x^2 + \dots + w_d x^d
\end{align}\]</div>
<p>にフィッティングすることを考えたい。ここで、<span class="math notranslate nohighlight">\(w_0, w_1, w_2, \dots, w_d \in \mathbb{R}\)</span>はモデルの<strong>パラメータ</strong>である。</p>
<p>なお、<span class="math notranslate nohighlight">\(\hat{y}\)</span>は重み<span class="math notranslate nohighlight">\(w_0, w_1, w_2, \dots, w_d\)</span>による説明変数<span class="math notranslate nohighlight">\(1, x, x^2, \dots x^d\)</span>の線形重み付き和と考えることができる。このモデルは多項式の一般形ではあるが、<span class="math notranslate nohighlight">\(\hat{y}\)</span>は<span class="math notranslate nohighlight">\(w_i\)</span>と<span class="math notranslate nohighlight">\(x^i\)</span>の線形結合で表されているため、<strong>線形モデル</strong>と見なすことができる。ただし、説明変数が２個以上であるので、単回帰を重回帰に拡張する必要がある。</p>
<p>一般的に、<span class="math notranslate nohighlight">\(d\)</span>個の説明変数<span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_d\)</span>に対して、線形モデル、すなわち<span class="math notranslate nohighlight">\(d\)</span>個の重み<span class="math notranslate nohighlight">\(w_1, w_2, \dots, w_d\)</span>の線形結合で目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}\)</span>を計算することを<strong>線形回帰</strong>と呼ぶ。</p>
<div class="amsmath math notranslate nohighlight" id="equation-087ecdac-4218-459f-b698-561bb3a02b63">
<span class="eqno">(2.3)<a class="headerlink" href="#equation-087ecdac-4218-459f-b698-561bb3a02b63" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = w_1 x_1 + w_2 x_2 + \dots + w_d x_d
\end{align}\]</div>
<p>ゆえに、<span class="math notranslate nohighlight">\((d-1)\)</span>次の多項式へのフィッティングは、<span class="math notranslate nohighlight">\(d\)</span>個の説明変数<span class="math notranslate nohighlight">\(x_1 = 1\)</span>, <span class="math notranslate nohighlight">\(x_2 = x\)</span>, <span class="math notranslate nohighlight">\(x_3 = x^2\)</span>, <span class="math notranslate nohighlight">\(\dots\)</span>, <span class="math notranslate nohighlight">\(x_d = x^{d-1}\)</span>による線形回帰と見なすことができる。下図は、重回帰でデータ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>に３次関数を当てはめた結果である。本章の内容をマスターすると、<span class="math notranslate nohighlight">\(4\)</span>個の説明変数<span class="math notranslate nohighlight">\(1, x, x^2, x^3\)</span>に対して、その重み（<span class="math notranslate nohighlight">\(-1.23, 5.41, -1.27, 0.09\)</span>）を求めることができる。</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.431</span><span class="p">,</span> <span class="mf">3.310</span> 
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">D</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">D</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.09</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="mf">1.27</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">5.41</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.23</span><span class="p">,</span> <span class="s1">&#39;tab:red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$y = 0.09 x^3 - 1.27 x^2 + 5.41 x - 1.23$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_6_0.png" src="../_images/02mra_6_0.png" />
</div>
</div>
<p>回帰分析において、説明変数を何個用意するか、それぞれの説明変数をどのように定義するかは任意である。たとえば、東京におけるアイスクリームへの支出額を予測するために、最高気温だけでなく、予測したい月の数字やアイスクリームの平均価格も有力な説明変数になり得るかもしれない。また、最高気温の平方根や、最高気温と月の積など、元の説明変数に非線形変換を適用した説明変数を導入してもよい。分析者が非線形変換の方法を明示的に設計する必要があるが、説明変数の組み合わせを考慮した非線形な回帰分析も、線形回帰の枠組みで行うことができる。</p>
<p><img alt="non-linear" src="../_images/non-linear.png" /></p>
</section>
<section id="id3">
<h2><span class="section-number">2.2. </span>表記法の定義<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title">ベクトル</p>
<p>この資料では、ベクトルを小文字の太字で表す。特に断りがない限り、ベクトルは要素を縦に並べた<strong>列ベクトル</strong>であるとする。例えば、<span class="math notranslate nohighlight">\(1, 0, -1\)</span>を要素とする<span class="math notranslate nohighlight">\(3\)</span>次元ベクトル<span class="math notranslate nohighlight">\(\bm{v} \in \mathbb{R}^3\)</span>を、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\bm{v} = \begin{pmatrix}1 \\ 0 \\ -1\end{pmatrix}
\end{split}\]</div>
<p>と書く。なお、横書きの文書で列ベクトルを書くとスペースを消費してしまうので、転置の演算子（<span class="math notranslate nohighlight">\(\top\)</span>）を用いて、</p>
<div class="math notranslate nohighlight">
\[
\bm{v} = \begin{pmatrix}1 &amp; 0 &amp; -1\end{pmatrix}^\top
\]</div>
<p>と書くことがある。</p>
</aside>
<p>重回帰の目的関数を一般的に記述するため、ベクトルによる表記を導入する。<span class="math notranslate nohighlight">\(d\)</span>個の説明変数<span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_d\)</span>をベクトル<span class="math notranslate nohighlight">\(\bm{x} \in \mathbb{R}^d\)</span>でまとめて表現する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-9c7c1a98-c2b2-44af-97ce-e169111f1ba5">
<span class="eqno">(2.4)<a class="headerlink" href="#equation-9c7c1a98-c2b2-44af-97ce-e169111f1ba5" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{x} = \begin{pmatrix}
x_1 \\ x_2 \\ \vdots \\ x_d
\end{pmatrix}
\end{align}\]</div>
<p>また、<span class="math notranslate nohighlight">\(d\)</span>個のパラメータ（重み）<span class="math notranslate nohighlight">\(w_1, w_2, \dots, w_d\)</span>をベクトル<span class="math notranslate nohighlight">\(\bm{w} \in \mathbb{R}^d\)</span>でまとめて表現する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-7b57a150-cb06-4ac4-ac2e-bc46aa3c7d17">
<span class="eqno">(2.5)<a class="headerlink" href="#equation-7b57a150-cb06-4ac4-ac2e-bc46aa3c7d17" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{w} = \begin{pmatrix}
w_1 \\ w_2 \\ \vdots \\ w_d
\end{pmatrix}
\end{align}\]</div>
<aside class="margin sidebar">
<p class="sidebar-title">ベクトルの内積</p>
<p><span class="math notranslate nohighlight">\(d\)</span>次元ベクトル、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{u} &amp;= \begin{pmatrix}u_1 &amp; u_2 &amp; \dots &amp; u_d\end{pmatrix}^\top \\
\bm{v} &amp;= \begin{pmatrix}v_1 &amp; v_2 &amp; \dots &amp; v_d\end{pmatrix}^\top
\end{align*}\]</div>
<p>があるとき、その内積は、</p>
<div class="math notranslate nohighlight">
\[
\bm{u} \cdot \bm{v} = u_1 v_1 + u_2 v_2 + \dots + u_d v_d
\]</div>
<p>である。これは、転置を使って、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{u} \cdot \bm{v} &amp;= \bm{u}^\top \bm{v} \\
&amp;= \begin{pmatrix}u_1 &amp; u_2 &amp; \dots &amp; u_d\end{pmatrix} \begin{pmatrix}v_1 \\ v_2 \\ \dots \\ v_d\end{pmatrix}
\end{align*}\]</div>
<p>と書ける。</p>
</aside>
<p>すると、重回帰モデルによる目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}\)</span>は、ベクトル<span class="math notranslate nohighlight">\(\bm{x}\)</span>と<span class="math notranslate nohighlight">\(\bm{w}\)</span>の内積として記述できる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-63da3f3c-8aa9-4931-b551-14d098b08b67">
<span class="eqno">(2.6)<a class="headerlink" href="#equation-63da3f3c-8aa9-4931-b551-14d098b08b67" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = \bm{x}^\top\bm{w} = w_1 x_1 + w_2 x_2 + \dots + w_d x_d
\end{align}\]</div>
<p>単回帰のときと同様に、説明変数と目的変数の組を<strong>事例</strong>として表現する。単回帰の場合と異なるのは、説明変数がスカラー<span class="math notranslate nohighlight">\(x\)</span>からベクトル<span class="math notranslate nohighlight">\(\bm{x}\)</span>に拡張されたことである。
<span class="math notranslate nohighlight">\(1\)</span>番目の事例を<span class="math notranslate nohighlight">\((\bm{x}_1, y_1)\)</span>、<span class="math notranslate nohighlight">\(2\)</span>番目の事例を<span class="math notranslate nohighlight">\((\bm{x}_2, y_2)\)</span>、<span class="math notranslate nohighlight">\(i\)</span>番目の事例を<span class="math notranslate nohighlight">\((\bm{x}_i, y_i)\)</span>と表すことにすると、<span class="math notranslate nohighlight">\(N\)</span>個の事例からなるデータ<span class="math notranslate nohighlight">\(\mathcal{D}\)</span>は次のように表される。</p>
<div class="amsmath math notranslate nohighlight" id="equation-065f93db-d1c5-4b61-89d9-b8ca72ea97ee">
<span class="eqno">(2.7)<a class="headerlink" href="#equation-065f93db-d1c5-4b61-89d9-b8ca72ea97ee" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathcal{D} = \left\{(\bm{x}_1, y_1), (\bm{x}_2, y_2), \dots, (\bm{x}_N, y_N)\right\} = \left\{(\bm{x}_i, y_i)\right\}_{i=1}^{N}
\end{align}\]</div>
<aside class="margin sidebar">
<p class="sidebar-title">行列</p>
<p>この資料では、行列を大文字の太字で表す。<span class="math notranslate nohighlight">\(\bm{X}\)</span>が実数値を要素とする<span class="math notranslate nohighlight">\(N\)</span>行<span class="math notranslate nohighlight">\(M\)</span>列の行列（<span class="math notranslate nohighlight">\(N \times M\)</span>の行列とも呼ばれる）であることを、<span class="math notranslate nohighlight">\(\bm{X} \in \mathbb{R}^{N \times M}\)</span>と書く。行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>の<span class="math notranslate nohighlight">\(i\)</span>行<span class="math notranslate nohighlight">\(j\)</span>列の要素を<span class="math notranslate nohighlight">\(X_{i,j}\)</span>と表現する。</p>
<p>例えば、<span class="math notranslate nohighlight">\(2 \times 3\)</span>の行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>に関して、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{X} = \begin{pmatrix}
1 &amp; 3 &amp; 5 \\
6 &amp; 4 &amp; 2 \\
\end{pmatrix}
\end{align*}\]</div>
<p><span class="math notranslate nohighlight">\(X_{1,2} = 3\)</span>、<span class="math notranslate nohighlight">\(X_{2,3} = 2\)</span>である。</p>
</aside>
<p>さらに、<span class="math notranslate nohighlight">\(N\)</span>個の事例や目的変数を行列やベクトルで記述する表記法も導入しておく。説明変数のベクトル<span class="math notranslate nohighlight">\(\bm{x}_i\)</span>を行ベクトルとして縦に<span class="math notranslate nohighlight">\(N\)</span>個並べた行列<span class="math notranslate nohighlight">\(\bm{X} \in \mathbb{R}^{N \times d}\)</span>を定義する。この行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>は<strong>計画行列</strong>（design matrix）と呼ばれ、それぞれの事例の<span class="math notranslate nohighlight">\(d\)</span>個の説明変数を水平方向に<span class="math notranslate nohighlight">\(d\)</span>個並べ、<span class="math notranslate nohighlight">\(N\)</span>個の事例を垂直方向に<span class="math notranslate nohighlight">\(N\)</span>個並べたものである。</p>
<div class="amsmath math notranslate nohighlight" id="equation-a8278fdb-3483-4fab-bc60-f473cbe09da8">
<span class="eqno">(2.8)<a class="headerlink" href="#equation-a8278fdb-3483-4fab-bc60-f473cbe09da8" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{X} = \begin{pmatrix}
\bm{x}_1^\top \\
\bm{x}_2^\top \\
\vdots \\
\bm{x}_N^\top \\
\end{pmatrix}
= \begin{pmatrix}
X_{1,1} &amp; X_{1,2} &amp; \dots &amp; X_{1,d} \\
X_{2,1} &amp; X_{2,2} &amp; \dots &amp; X_{2,d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{N,1} &amp; X_{N,2} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\end{align}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(X_{i,j}\)</span>は行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>の<span class="math notranslate nohighlight">\(i\)</span>行<span class="math notranslate nohighlight">\(j\)</span>列の要素を表す。</p>
<p>また、目的変数<span class="math notranslate nohighlight">\(y_i\)</span>を縦に<span class="math notranslate nohighlight">\(N\)</span>個並べたベクトル<span class="math notranslate nohighlight">\(\bm{y} \in \mathbb{R}^N\)</span>を定義する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-5bd4003f-2e04-4afa-b828-3cde82bbd9c1">
<span class="eqno">(2.9)<a class="headerlink" href="#equation-5bd4003f-2e04-4afa-b828-3cde82bbd9c1" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{y} = \begin{pmatrix}
y_1 \\ y_2 \\ \vdots \\ y_N
\end{pmatrix}
\end{align}\]</div>
<aside class="margin sidebar">
<p class="sidebar-title">行列・ベクトル積</p>
<p><span class="math notranslate nohighlight">\(N \times d\)</span>の行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>と<span class="math notranslate nohighlight">\(d\)</span>行のベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>の積を計算した結果は、<span class="math notranslate nohighlight">\(N\)</span>行のベクトルとなる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp; \bm{X}\bm{w} \\
&amp;= \begin{pmatrix}
X_{1,1} &amp; \dots &amp; X_{1,d} \\
\dots &amp; \dots &amp; \dots \\
X_{N,1} &amp; \dots &amp; X_{N,d} \\
\end{pmatrix}
\begin{pmatrix}
w_1 \\ \dots \\ w_d
\end{pmatrix} \\
&amp;= \begin{pmatrix}
X_{1,1} w_1 + \dots + X_{1,d} w_d \\
\dots \\
X_{N,1} w_1 + \dots + X_{N,d} w_d \\
\end{pmatrix}
\end{align*}\]</div>
<p>例えば、<span class="math notranslate nohighlight">\(2 \times 3\)</span>の行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>と<span class="math notranslate nohighlight">\(3\)</span>行のベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>があるとき、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{X} = \begin{pmatrix}
1 &amp; 3 &amp; 5 \\
6 &amp; 4 &amp; 2 \\
\end{pmatrix}, 
\bm{w} = \begin{pmatrix}
2 \\
-2 \\
3\\
\end{pmatrix}
\end{align*}\]</div>
<p>行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>とベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>の積は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{X}\bm{w}
&amp;= \begin{pmatrix}
1 &amp; 3 &amp; 5 \\
6 &amp; 4 &amp; 2 \\
\end{pmatrix} \begin{pmatrix}
2 \\
-2 \\
3\\
\end{pmatrix} \\
&amp;= \begin{pmatrix}
1 \times 2 + 3 \times (-2) + 5 \times 3 \\
6 \times 2 + 4 \times (-2) + 2 \times 3 \\
\end{pmatrix} \\
&amp;= \begin{pmatrix}
11 \\
10 \\
\end{pmatrix}
\end{align*}\]</div>
</aside>
<p>目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}_i\)</span>を縦に<span class="math notranslate nohighlight">\(N\)</span>個並べ、ベクトル<span class="math notranslate nohighlight">\(\hat{\bm{y}} \in \mathbb{R}^N\)</span>と書くことにすると、その予測値は計画行列とパラメータベクトルの積で求めることができる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-e3e112b7-09c4-471f-8878-b1d4c3530757">
<span class="eqno">(2.10)<a class="headerlink" href="#equation-e3e112b7-09c4-471f-8878-b1d4c3530757" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{\bm{y}} = \begin{pmatrix}
\hat{y}_1 \\ \hat{y}_2 \\ \vdots \\ \hat{y}_N
\end{pmatrix} = \begin{pmatrix}
\bm{x}_1^\top \bm{w} \\ \bm{x}_2^\top \bm{w} \\ \vdots \\ \bm{x}_N^\top \bm{w}
\end{pmatrix}
= \bm{X} \bm{w}
\end{align}\]</div>
<section id="id4">
<h3><span class="section-number">2.2.1. </span>単回帰を表現する<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">#</a></h3>
<p>これまでに定義した表記法で単回帰を記述できることを確認しておこう。<span class="math notranslate nohighlight">\(d=2\)</span>として説明変数とパラメータベクトルを以下のように定義する。</p>
<div class="math notranslate nohighlight" id="equation-eq-simple-linear-regression">
<span class="eqno">(2.11)<a class="headerlink" href="#equation-eq-simple-linear-regression" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\bm{x} = \begin{pmatrix}
1 \\ x
\end{pmatrix},
\bm{w} = \begin{pmatrix}
b \\ a
\end{pmatrix}
\end{align}
\end{split}\]</div>
<p>目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}\)</span>を計算する式を展開すると、単回帰モデルが得られる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-086994de-dcea-43f0-82b5-7ece996af962">
<span class="eqno">(2.12)<a class="headerlink" href="#equation-086994de-dcea-43f0-82b5-7ece996af962" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = \bm{x}^\top\bm{w} = b + xa = ax + b
\end{align}\]</div>
<p>したがって、この章で説明する性質（例えば目的関数が凸関数であること等）は単回帰にも当てはまる。なお、冒頭のグラフの例（<span class="math notranslate nohighlight">\(N=4\)</span>）の学習データは次のように表現される。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\mathcal{D}_s = \left\{(\bm{x}_i, y_i)\right\}_{i=1}^{4} = \left\{\left(\begin{pmatrix}1 &amp; 1\end{pmatrix}^\top, 3\right), \left(\begin{pmatrix}1 &amp; 3\end{pmatrix}^\top, 6\right), \left(\begin{pmatrix}1 &amp; 6\end{pmatrix}^\top, 5\right), \left(\begin{pmatrix}1 &amp; 8\end{pmatrix}^\top, 7\right)\right\}
\end{align*}\]</div>
<p>計画行列<span class="math notranslate nohighlight">\(\bm{X} \in \mathbb{R}^{4 \times 2}\)</span>と目的変数ベクトル<span class="math notranslate nohighlight">\(\bm{y} \in \mathbb{R}^4\)</span>は、それぞれ、</p>
<div class="amsmath math notranslate nohighlight" id="equation-a1ab6928-2e9b-4887-99de-ffabdaf807b5">
<span class="eqno">(2.13)<a class="headerlink" href="#equation-a1ab6928-2e9b-4887-99de-ffabdaf807b5" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{X} = \begin{pmatrix}
1 &amp; 1 \\
1 &amp; 3 \\
1 &amp; 6 \\
1 &amp; 8
\end{pmatrix},
\bm{y} = \begin{pmatrix}
3 \\ 6 \\ 5 \\ 7
\end{pmatrix}
\end{align}\]</div>
<p>目的変数の予測ベクトル<span class="math notranslate nohighlight">\(\hat{\bm{y}}\)</span>は行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>とベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>の積で求めることができる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-08099348-7223-4950-af64-6be556f8c5ed">
<span class="eqno">(2.14)<a class="headerlink" href="#equation-08099348-7223-4950-af64-6be556f8c5ed" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{\bm{y}}
= \bm{X} \bm{w}
= \begin{pmatrix}
1 &amp; 1 \\
1 &amp; 3 \\
1 &amp; 6 \\
1 &amp; 8
\end{pmatrix}
\begin{pmatrix}
b \\ a
\end{pmatrix}
= \begin{pmatrix}
a + b \\
3a + b \\
6a + b \\
8a + b 
\end{pmatrix}
\end{align}\]</div>
</section>
</section>
<section id="id5">
<h2><span class="section-number">2.3. </span>目的関数<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">#</a></h2>
<p>単回帰のときと同様に、ある事例の目的変数の真の値<span class="math notranslate nohighlight">\(y_i\)</span>と推定値<span class="math notranslate nohighlight">\(\hat{y}_i\)</span>の差を残差<span class="math notranslate nohighlight">\(\epsilon_i\)</span>とする。</p>
<div class="amsmath math notranslate nohighlight" id="equation-d3761fa8-f4c2-44c5-981c-91fa08564586">
<span class="eqno">(2.15)<a class="headerlink" href="#equation-d3761fa8-f4c2-44c5-981c-91fa08564586" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\epsilon_i = y_i - \hat{y}_i = y_i - \bm{x}_i^\top\bm{w}
\end{align}\]</div>
<p>学習データにおける平均二乗残差は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-07111d2f-116c-49c8-a95b-5524b06fe14f">
<span class="eqno">(2.16)<a class="headerlink" href="#equation-07111d2f-116c-49c8-a95b-5524b06fe14f" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{L} = \frac{1}{N} \sum_{i=1}^{N} \epsilon_i^2 = \frac{1}{N} \sum_{i=1}^{N} (y_i - \hat{y}_i)^2 = \frac{1}{N} \sum_{i=1}^{N} (y_i - \bm{x}_i^\top\bm{w})^2
\end{align}\]</div>
<p>重回帰モデルの学習において平均二乗残差を最小化するときは、学習データ<span class="math notranslate nohighlight">\(\mathcal{D}\)</span>や学習事例数<span class="math notranslate nohighlight">\(N\)</span>は事前に与えられる定数であり、パラメータ<span class="math notranslate nohighlight">\(\bm{w}\)</span>は変数である。したがって、<span class="math notranslate nohighlight">\(N\)</span>は最小化の解に影響を与えないので（二乗残差の平均を最小化することと二乗残差の和を最小化することは等価なので）、今後は目的関数に含めないことにする。すると、重回帰で最小化したい目的関数は、</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\hat{L}_{\mathcal{D}}(\bm{w}) = \sum_{i=1}^{N} (y_i - \bm{x}_i^\top\bm{w})^2
\end{align}
\]</div>
<p>なお、全事例に関する残差をベクトル、</p>
<div class="amsmath math notranslate nohighlight" id="equation-e8bdfbfe-5123-49c7-ab78-5cb79244e067">
<span class="eqno">(2.17)<a class="headerlink" href="#equation-e8bdfbfe-5123-49c7-ab78-5cb79244e067" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{\epsilon} = \begin{pmatrix}
\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_N
\end{pmatrix}
\end{align}\]</div>
<p>で表すことにすると、</p>
<div class="math notranslate nohighlight" id="equation-eq-mra-epsilon">
<span class="eqno">(2.18)<a class="headerlink" href="#equation-eq-mra-epsilon" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\bm{\epsilon} = \bm{y} - \hat{\bm{y}} = \bm{y} - \bm{X}\bm{w}
\end{align}
\]</div>
<p>である。</p>
<aside class="margin sidebar">
<p class="sidebar-title">ベクトルの<span class="math notranslate nohighlight">\(L_2\)</span>ノルム</p>
<p><span class="math notranslate nohighlight">\(d\)</span>次元ベクトル、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{v} &amp;= \begin{pmatrix}v_1 &amp; v_2 &amp; \dots &amp; v_d\end{pmatrix}^\top
\end{align*}\]</div>
<p>があるとき、その<span class="math notranslate nohighlight">\(L_2\)</span>ノルム<span class="math notranslate nohighlight">\(\lVert \bm{v} \rVert\)</span>は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lVert \bm{v} \rVert &amp;= \sqrt{\bm{v}^\top \bm{v}} \\
&amp;= \sqrt{v_1^2 + v_2^2 + \dots + v_d^2}
\end{align*}\]</div>
<p>と計算される。</p>
</aside>
<p>以上まとめると、重回帰で最小化したい目的関数は、</p>
<div class="important admonition">
<p class="admonition-title">重回帰の目的関数（二乗残差和）</p>
<div class="math notranslate nohighlight" id="equation-eq-objective-function">
<span class="eqno">(2.19)<a class="headerlink" href="#equation-eq-objective-function" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\hat{L}_{\mathcal{D}}(\bm{w}) = \lVert \bm{\epsilon} \rVert^2 = \lVert \bm{y} - \bm{X}\bm{w} \rVert^2 = \sum_{i=1}^{N} (y_i - \bm{x}_i^\top\bm{w})^2
\end{align}
\]</div>
</div>
<p>と表現できる。</p>
</section>
<section id="mra-minimization">
<span id="id6"></span><h2><span class="section-number">2.4. </span>目的関数の最小化<a class="headerlink" href="#mra-minimization" title="この見出しへのパーマリンク">#</a></h2>
<p>目的関数<span class="math notranslate nohighlight">\(\hat{L}_{\mathcal{D}}(\bm{w})\)</span>を最小にするパラメータのベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>を求めるため、式<a class="reference internal" href="#equation-eq-objective-function">(2.19)</a>をあるパラメータ<span class="math notranslate nohighlight">\(w_j\)</span>で偏微分する（<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>はパラメータのインデックスである）。</p>
<aside class="margin sidebar">
<p class="sidebar-title">行列の行ベクトル</p>
<p>行列<span class="math notranslate nohighlight">\(\bm{X} \in \mathbb{R}^{N \times d}\)</span>に対して、その<span class="math notranslate nohighlight">\(j\)</span>行目の要素を横に並べたベクトルを<strong>行ベクトル</strong>と呼び、<span class="math notranslate nohighlight">\(\bm{X}_j\)</span>で表す。<span class="math notranslate nohighlight">\(\bm{X}_j \in \mathbb{R}^{1 \times d}\)</span>である。</p>
</aside>
<div class="math notranslate nohighlight" id="equation-eq-mra-grad-wj">
<span class="eqno">(2.20)<a class="headerlink" href="#equation-eq-mra-grad-wj" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\frac{\partial \hat{L}_{\mathcal{D}}(\bm{w})}{\partial w_j}
&amp;= \sum_{i=1}^N 2 \cdot \underbrace{(y_i - \bm{x}_i^\top\bm{w})}_{=\epsilon_i} \cdot \{-\underbrace{(\bm{x}_i)_j}_{=X_{i,j}}\} \\
&amp;= -2 \sum_{i=1}^N  X_{i,j} \epsilon_i \\
&amp;= -2 \begin{pmatrix}
X_{1,j} &amp;
X_{2,j} &amp;
\dots &amp;
X_{N,j} 
\end{pmatrix} \begin{pmatrix}
\epsilon_1 \\
\epsilon_2 \\
\vdots \\
\epsilon_N
\end{pmatrix} \\
&amp;= -2 (\bm{X}^\top)_j \bm{\epsilon} \\
&amp;= -2 (\bm{X}^\top \bm{\epsilon})_j
\end{align}
\end{split}\]</div>
<aside class="margin sidebar">
<p class="sidebar-title">ベクトルの微分</p>
<p>本資料ではベクトルの微分に分母レイアウト表記（<a class="reference external" href="https://en.wikipedia.org/wiki/Matrix_calculus#Denominator-layout_notation">Denominator-layout notation</a>）を採用する。二つのベクトル<span class="math notranslate nohighlight">\(\bm{x} \in \mathbb{R}^m, \bm{y} \in \mathbb{R}^n\)</span>があるとき、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{\partial \bm{y}}{\partial \bm{x}} = \begin{pmatrix}
\frac{\partial y_1}{\partial x_1} &amp; \frac{\partial y_2}{\partial x_1} &amp; \ldots &amp; \frac{\partial y_n}{\partial x_1} \\
\frac{\partial y_1}{\partial x_2} &amp; \frac{\partial y_2}{\partial x_2} &amp; \ldots &amp; \frac{\partial y_n}{\partial x_2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\frac{\partial y_1}{\partial x_m} &amp; \frac{\partial y_2}{\partial x_m} &amp; \ldots &amp; \frac{\partial y_n}{\partial x_m} \\
\end{pmatrix}
\end{split}\]</div>
<p>もし、<span class="math notranslate nohighlight">\(y\)</span>がスカラーであるならば、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{\partial y}{\partial \bm{x}} = \begin{pmatrix}
\frac{\partial y}{\partial x_1} \\
\frac{\partial y}{\partial x_2} \\
\vdots \\
\frac{\partial y}{\partial x_m} \\
\end{pmatrix}
\end{split}\]</div>
<p>もし、<span class="math notranslate nohighlight">\(x\)</span>がスカラーであるならば、</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \bm{y}}{\partial x} = \begin{pmatrix}
\frac{\partial y_1}{\partial x} &amp; \frac{\partial y_2}{\partial x} &amp; \ldots &amp; \frac{\partial y_n}{\partial x}
\end{pmatrix}
\]</div>
<p>したがって、分母側のベクトルのレイアウトはそのまま、分子側のベクトルのレイアウトは転置が適用される。</p>
</aside>
<p>なお、最後から２番目の式変形は、計画行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>の転置<span class="math notranslate nohighlight">\(\bm{X}^\top\)</span>、</p>
<div class="amsmath math notranslate nohighlight" id="equation-e4ea108b-1f33-4ffc-ae2e-330742626b6e">
<span class="eqno">(2.21)<a class="headerlink" href="#equation-e4ea108b-1f33-4ffc-ae2e-330742626b6e" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{X}^\top = \begin{pmatrix}
X_{1,1} &amp; X_{2,1} &amp; \dots &amp; X_{N,1} \\
X_{1,2} &amp; X_{2,2} &amp; \dots &amp; X_{N,2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,j} &amp; X_{2,j} &amp; \dots &amp; X_{N,j} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,d} &amp; X_{2,d} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\end{align}\]</div>
<p>の<span class="math notranslate nohighlight">\(j\)</span>行目の行ベクトルが<span class="math notranslate nohighlight">\(\begin{pmatrix} X_{1,j} &amp; X_{2,j} &amp; \dots &amp; X_{N,j}\end{pmatrix}\)</span>であることを利用した。最終行の式変形では、以下の行列ベクトル積の<span class="math notranslate nohighlight">\(j\)</span>行目の計算結果に基づく。</p>
<div class="amsmath math notranslate nohighlight" id="equation-e8a59469-cf7c-451b-9fc0-3c8ba133620c">
<span class="eqno">(2.22)<a class="headerlink" href="#equation-e8a59469-cf7c-451b-9fc0-3c8ba133620c" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{X}^\top \bm{\epsilon} = \begin{pmatrix}
(\bm{X}^\top)_{1} \bm{\epsilon} \\
(\bm{X}^\top)_{2} \bm{\epsilon} \\
\vdots \\
(\bm{X}^\top)_{j} \bm{\epsilon} \\
\vdots \\
(\bm{X}^\top)_{d} \bm{\epsilon} \\
\end{pmatrix}
\end{align}\]</div>
<p>式<a class="reference internal" href="#equation-eq-mra-grad-wj">(2.20)</a>より、<span class="math notranslate nohighlight">\(\frac{\partial \hat{L}_{\mathcal{D}}(\bm{w})}{\partial w_j}\)</span>は<span class="math notranslate nohighlight">\(-2 (\bm{X}^\top \bm{\epsilon})\)</span>の<span class="math notranslate nohighlight">\(j\)</span>行目の要素に対応する。全ての<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>について偏微分したものを<span class="math notranslate nohighlight">\(d\)</span>次元ベクトルとしてまとめ、<span class="math notranslate nohighlight">\(\nabla \hat{L}_{\mathcal{D}}(\bm{w})\)</span>と書くことにすると、</p>
<aside class="margin sidebar">
<p class="sidebar-title"><span class="math notranslate nohighlight">\(\nabla\)</span>（ナブラ）と勾配</p>
<p>多変数実関数の勾配を表すために<span class="math notranslate nohighlight">\(\nabla\)</span>を用いる。例えば、<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>から実数への関数<span class="math notranslate nohighlight">\(f: \mathbb{R}^3 \longmapsto \mathbb{R}\)</span>があるとき、その<span class="math notranslate nohighlight">\(x, y, z\)</span>に関する偏微分を<span class="math notranslate nohighlight">\(3\)</span>次元ベクトルとしてまとめたものを、<span class="math notranslate nohighlight">\(\nabla f(x, y, z)\)</span>と書く。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla f(x, y, z) &amp;= \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} f(x, y, z) \\
&amp;= \begin{pmatrix}
\frac{\partial f(x, y, z)}{\partial x} \\
\frac{\partial f(x, y, z)}{\partial y} \\
\frac{\partial f(x, y, z)}{\partial z} \\
\end{pmatrix}
\end{align*}\]</div>
<p><span class="math notranslate nohighlight">\(\nabla f(x, y, z)\)</span>は<span class="math notranslate nohighlight">\(f(x, y, z)\)</span>の増加が最大となる方向（<span class="math notranslate nohighlight">\(f\)</span>の<strong>勾配</strong>）を表す。</p>
<p>なお、<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>において、演算子<span class="math notranslate nohighlight">\(\nabla\)</span>の元々の定義は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla = \bm{e}_x \frac{\partial}{\partial x} + \bm{e}_y \frac{\partial}{\partial y} + \bm{e}_z \frac{\partial}{\partial z}
\end{align*}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\bm{e}_x, \bm{e}_y, \bm{e}_z\)</span>はそれぞれ、<span class="math notranslate nohighlight">\(x, y, z\)</span>方向の単位ベクトルである。したがって、先ほどの説明の通り<span class="math notranslate nohighlight">\(\nabla f(x, y, z)\)</span>は<span class="math notranslate nohighlight">\(f(x, y, z)\)</span>を<span class="math notranslate nohighlight">\(x, y, z\)</span>に関して偏微分したベクトルとなる。</p>
</aside>
<div class="math notranslate nohighlight">
\[\begin{split}
\nabla \hat{L}_{\mathcal{D}}(\bm{w}) = \begin{pmatrix}
\frac{\partial }{\partial w_1} \\
\frac{\partial }{\partial w_2} \\
\vdots \\
\frac{\partial }{\partial w_d} \\
\end{pmatrix} \hat{L}_{\mathcal{D}}(\bm{w})
= -2 \bm{X}^\top \bm{\epsilon}
\end{split}\]</div>
<p>さらに、式<a class="reference internal" href="#equation-eq-mra-epsilon">(2.18)</a>より<span class="math notranslate nohighlight">\(\bm{\epsilon} = \bm{y} - \bm{X}\bm{w}\)</span>であるから、</p>
<div class="math notranslate nohighlight" id="equation-eq-gradient">
<span class="eqno">(2.23)<a class="headerlink" href="#equation-eq-gradient" title="この数式へのパーマリンク">#</a></span>\[
\nabla \hat{L}_{\mathcal{D}}(\bm{w}) = -2 \bm{X}^\top \bm{\epsilon} = 2 \bm{X}^\top (\hat{\bm{y}} - \bm{y}) = 2 \bm{X}^\top (\bm{X}\bm{w} - \bm{y})
\]</div>
<p>目的関数を最小化するパラメータベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>を求めるため、これを<span class="math notranslate nohighlight">\(\bm{0}\)</span>とおき、<span class="math notranslate nohighlight">\(\bm{w}\)</span>について解くと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-c2dbdc6b-a265-4933-8d21-1baef10d2664">
<span class="eqno">(2.24)<a class="headerlink" href="#equation-c2dbdc6b-a265-4933-8d21-1baef10d2664" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
2\bm{X}^\top (\bm{X}\bm{w} - \bm{y}) &amp;= \bm{0} \\
\bm{X}^\top \bm{X}\bm{w} - \bm{X}^\top \bm{y} &amp;= \bm{0} \\
\bm{X}^\top \bm{X}\bm{w} &amp;= \bm{X}^\top \bm{y} \\
\bm{w} &amp;= (\bm{X}^\top \bm{X})^{-1}\bm{X}^\top \bm{y}
\end{align}\]</div>
<p>したがって、学習データに対応する計画行列<span class="math notranslate nohighlight">\(\bm{X}\)</span>と目的変数ベクトル<span class="math notranslate nohighlight">\(\bm{y}\)</span>が与えられると、平均二乗残差を最小にするパラメータベクトル<span class="math notranslate nohighlight">\(\bm{w}\)</span>は行列演算で解析的に（閉じた式で）求めることができる。なお、<span class="math notranslate nohighlight">\((\bm{X}^\top \bm{X})^{-1}\bm{X}^\top\)</span>を求める部分は、<a class="reference external" href="https://ja.wikipedia.org/wiki/%E6%93%AC%E4%BC%BC%E9%80%86%E8%A1%8C%E5%88%97">ムーア・ペンローズの擬似逆行列（一般化逆行列）</a>でも十分であるが、ここでは詳しく説明しない。</p>
<p>まとめとして、<span class="math notranslate nohighlight">\(\bm{w}\)</span>を求める式を再掲する。</p>
<div class="important admonition">
<p class="admonition-title">重回帰のパラメータを求める式</p>
<div class="math notranslate nohighlight" id="equation-eq-closed-form-solution">
<span class="eqno">(2.25)<a class="headerlink" href="#equation-eq-closed-form-solution" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\bm{w} &amp;= (\bm{X}^\top \bm{X})^{-1}\bm{X}^\top \bm{y}
\end{align}
\]</div>
</div>
<p>なお、導出の途中で出てきた以下の等式は<strong>正規方程式</strong>（normal equation）と呼ばれる。</p>
<div class="important admonition">
<p class="admonition-title">正規方程式</p>
<div class="math notranslate nohighlight" id="equation-eq-normal-equation">
<span class="eqno">(2.26)<a class="headerlink" href="#equation-eq-normal-equation" title="この数式へのパーマリンク">#</a></span>\[
\bm{X}^\top \bm{X}\bm{w} = \bm{X}^\top \bm{y}
\]</div>
</div>
</section>
<section id="id7">
<h2><span class="section-number">2.5. </span>目的関数の微分（別の導出）<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title">行列の転置</p>
<p><span class="math notranslate nohighlight">\((\bm{A}^\top)^\top = \bm{A}\)</span></p>
<p><span class="math notranslate nohighlight">\((\bm{A}\bm{B})^\top = \bm{B}^\top \bm{A}^\top\)</span></p>
</aside>
<p>式<a class="reference internal" href="#equation-eq-objective-function">(2.19)</a>の目的関数をベクトルで記述したまま、<span class="math notranslate nohighlight">\(\bm{w}\)</span>で微分する導出も紹介しておく。まず、目的関数を展開する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-8a55ff8c-d147-4d3d-93b9-238e02ff1f45">
<span class="eqno">(2.27)<a class="headerlink" href="#equation-8a55ff8c-d147-4d3d-93b9-238e02ff1f45" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{L}_{\mathcal{D}}(\bm{w}) &amp;= \lVert \bm{y} - \bm{X}\bm{w} \rVert^2 \\
&amp;= (\bm{y} - \bm{X}\bm{w})^\top(\bm{y} - \bm{X}\bm{w}) \\
&amp;= (\bm{y}^\top - \bm{w}^\top \bm{X}^\top)(\bm{y} - \bm{X}\bm{w}) \\
&amp;= \bm{y}^\top \bm{y} - \bm{y}^\top \bm{X}\bm{w} - \bm{w}^\top \bm{X}^\top \bm{y} + \bm{w}^\top \bm{X}^\top \bm{X}\bm{w} \\
&amp;= \bm{y}^\top \bm{y} - (\bm{X}^\top\bm{y})^\top \bm{w} - \bm{w}^\top (\bm{X}^\top \bm{y}) + \bm{w}^\top \bm{X}^\top \bm{X}\bm{w} &amp;&amp; (\because (\bm{X}^\top\bm{y})^\top = \bm{y}^\top (\bm{X}^\top)^\top)\\
&amp;= \bm{y}^\top \bm{y} - 2(\bm{X}^\top\bm{y})^\top \bm{w} + \bm{w}^\top \bm{X}^\top \bm{X}\bm{w} &amp;&amp; (\because \bm{u}^\top \bm{v} = \bm{v}^\top \bm{u})
\end{align}\]</div>
<aside class="margin sidebar">
<p class="sidebar-title">ベクトルの内積の微分</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial}{\partial \bm{x}} \bm{x}^\top\bm{a} = \frac{\partial}{\partial \bm{x}} \bm{a}^\top\bm{x} = \bm{a}
\end{align*}\]</div>
<p>（証明）ベクトル<span class="math notranslate nohighlight">\(\bm{a}, \bm{x} \in \mathbb{R}^d\)</span>に対して、<span class="math notranslate nohighlight">\(\bm{x}^\top\bm{a} = \bm{a}^\top\bm{x}\)</span>であるので、どちらか一方の偏微分を計算すればよい。ある整数<span class="math notranslate nohighlight">\(i \in \{1, \dots, d\}\)</span>に対して、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp;\left(\frac{\partial}{\partial \bm{x}} \bm{x}^\top\bm{a}\right)_i 
= \frac{\partial}{\partial x_i}\left(\bm{x}^\top\bm{a}\right) \\
=&amp; \frac{\partial}{\partial x_i}\left(a_1 x_1 + \dots a_d x_d \right) 
= a_i
\end{align*}\]</div>
</aside>
<aside class="margin sidebar">
<p class="sidebar-title">二次形式の微分</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp;\frac{\partial}{\partial \bm{x}} \bm{x}^\top \bm{A}\bm{x} = (\bm{A} + \bm{A}^\top)\bm{x}
\end{align*}\]</div>
<p>（証明）行列<span class="math notranslate nohighlight">\(\bm{A} \in \mathbb{R}^{d \times d}\)</span>とベクトル<span class="math notranslate nohighlight">\(\bm{x} \in \mathbb{R}^d\)</span>に対して、<span class="math notranslate nohighlight">\(\bm{x}\)</span>の二次形式は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\bm{x}^\top \bm{A}\bm{x} 
=&amp; \bm{x}^\top \begin{pmatrix}
\sum_{j=1}^d A_{1,j} x_j \\
\vdots \\
\sum_{j=1}^d A_{d,j} x_j
\end{pmatrix} \\
=&amp; \sum_{i=1}^d \sum_{j=1}^d A_{i,j} x_i x_j
\end{align*}\]</div>
<p>ゆえに、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial \bm{x}^\top \bm{A}\bm{x}}{\partial x_k} &amp;= \sum_{i=1}^d A_{i,k} x_i + \sum_{j=1}^d A_{k,j} x_j \\
&amp;= (\bm{A}^\top \bm{x})_k + (\bm{A} \bm{x})_k \\
&amp;= \left((\bm{A} + \bm{A}^\top) \bm{x}\right)_k
\end{align*}\]</div>
</aside>
<p>続いて、目的関数<span class="math notranslate nohighlight">\(\hat{L}_{\mathcal{D}}(\bm{w})\)</span>を最小化する<span class="math notranslate nohighlight">\(\bm{w}\)</span>を求めるために、<span class="math notranslate nohighlight">\(\hat{L}_{\mathcal{D}}(\bm{w})\)</span>を<span class="math notranslate nohighlight">\(\bm{w}\)</span>で偏微分する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-0aae9a3b-c2c0-4c8b-88c7-bd4cef169753">
<span class="eqno">(2.28)<a class="headerlink" href="#equation-0aae9a3b-c2c0-4c8b-88c7-bd4cef169753" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\bm{w}) &amp;= \frac{\partial}{\partial \bm{w}} \left(\bm{y}^\top \bm{y} - 2(\bm{X}^\top\bm{y})^\top \bm{w} + \bm{w}^\top \bm{X}^\top \bm{X}\bm{w}\right) \\
  &amp;= 0 - \frac{\partial}{\partial \bm{w}}\left(2(\bm{X}^\top\bm{y})^\top \bm{w}\right) + \frac{\partial}{\partial \bm{w}}\left(\bm{w}^\top \bm{X}^\top \bm{X}\bm{w}\right)
\end{align}\]</div>
<p>上式の第2項は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-fb58e263-228d-49a3-ad63-02bae31b4699">
<span class="eqno">(2.29)<a class="headerlink" href="#equation-fb58e263-228d-49a3-ad63-02bae31b4699" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\frac{\partial}{\partial \bm{w}}\left(2(\bm{X}^\top\bm{y})^\top \bm{w}\right)
= 2\bm{X}^\top \bm{y}
\end{align}\]</div>
<p>第3項は、<span class="math notranslate nohighlight">\(\bm{X}^\top \bm{X}\)</span>が正方行列（<span class="math notranslate nohighlight">\(d \times d\)</span>行列）であり、<span class="math notranslate nohighlight">\((\bm{X}^\top \bm{X})^\top=\bm{X}^\top (\bm{X}^\top)^\top = \bm{X}^\top \bm{X}\)</span>、すなわち<span class="math notranslate nohighlight">\(\bm{X}^\top \bm{X}\)</span>は対称行列であることに注意すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-2e9dfe1f-be45-472c-9016-8749eb1860da">
<span class="eqno">(2.30)<a class="headerlink" href="#equation-2e9dfe1f-be45-472c-9016-8749eb1860da" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\frac{\partial}{\partial \bm{w}}\left(\bm{w}^\top \bm{X}^\top \bm{X}\bm{w}\right)
= \frac{\partial}{\partial \bm{w}}\left(\bm{w}^\top (\bm{X}^\top \bm{X}) \bm{w}\right)
= \left((\bm{X}^\top \bm{X}) + (\bm{X}^\top \bm{X})^\top \right) \bm{w}
= 2\bm{X}^\top \bm{X}\bm{w}
\end{align}\]</div>
<p>ゆえに、</p>
<div class="amsmath math notranslate nohighlight" id="equation-b5448e06-20cc-442e-9241-0b03c251fbb5">
<span class="eqno">(2.31)<a class="headerlink" href="#equation-b5448e06-20cc-442e-9241-0b03c251fbb5" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\bm{w}) &amp;= - \frac{\partial}{\partial \bm{w}}\left(2(\bm{X}^\top\bm{y})^\top \bm{w}\right) + \frac{\partial}{\partial \bm{w}}\left(\bm{w}^\top \bm{X}^\top \bm{X}\bm{w}\right) \\
  &amp;= - 2\bm{X}^\top \bm{y} + 2\bm{X}^\top \bm{X}\bm{w} \\
  &amp;= 2\bm{X}^\top (\bm{X}\bm{w} - \bm{y})
\end{align}\]</div>
<p>したがって、式<a class="reference internal" href="#equation-eq-gradient">(2.23)</a>で求めた勾配と一致する。</p>
</section>
<section id="id8">
<h2><span class="section-number">2.6. </span>目的関数は凸関数<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">#</a></h2>
<p>ここで、重回帰の目的関数は凸関数であることを示しておく。証明の方針は、目的関数の二階微分（ヘッセ行列）が半正定値行列であることを示すことであるが、その方針で証明ができる背景を簡単に説明する。</p>
<section id="id9">
<h3><span class="section-number">2.6.1. </span>凸関数であるための条件<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">#</a></h3>
<p>まずは重回帰の問題設定を忘れ、凸関数に関する一般的な説明を行う。</p>
<div class="note admonition">
<p class="admonition-title">凸関数の定義</p>
<p><span class="math notranslate nohighlight">\(d\)</span>次元ベクトル<span class="math notranslate nohighlight">\(\bm{x} \in \mathbb{R}^{d}\)</span>を引数にとり、スカラーを返す関数<span class="math notranslate nohighlight">\(f: \mathbb{R}^{d} \longmapsto \mathbb{R}\)</span>がある。任意の<span class="math notranslate nohighlight">\(\bm{u}, \bm{v} \in \mathbb{R}^{d}\)</span>と<span class="math notranslate nohighlight">\(0 \leq \lambda \leq 1\)</span>を満たす任意の<span class="math notranslate nohighlight">\(\lambda\)</span>に対して、</p>
<div class="math notranslate nohighlight" id="equation-eq-convex-definition">
<span class="eqno">(2.32)<a class="headerlink" href="#equation-eq-convex-definition" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
f(\lambda\bm{u} + (1 - \lambda)\bm{v}) \leq \lambda f(\bm{u}) + (1 - \lambda) f(\bm{v})
\end{align}
\]</div>
<p>が成り立つとき、<span class="math notranslate nohighlight">\(f\)</span>を凸関数と呼ぶ。</p>
</div>
<p>この定義は「関数<span class="math notranslate nohighlight">\(f\)</span>上の任意の2点間の曲線は、その2点を結ぶ直線（弦）よりも下にある」ことを表現している（厳密には曲線が弦が同じでも凸関数と呼べる）。<span class="math notranslate nohighlight">\(f\)</span>を1変数関数として、この凸関数の定義を可視化したのが下のグラフである。点<span class="math notranslate nohighlight">\((u, f(u)), (v, f(v))\)</span>を結ぶ弦は、関数<span class="math notranslate nohighlight">\(f\)</span>の曲線よりも上に位置している。</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">u</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">v</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">l</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">lx</span> <span class="o">=</span> <span class="n">l</span><span class="o">*</span><span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">v</span>
<span class="n">ly</span> <span class="o">=</span> <span class="n">l</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Plot the curve of f(x).</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f</span><span class="p">((</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.3</span><span class="p">,</span> <span class="s1">&#39;曲線&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

<span class="c1"># Plot the points of u and v.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">/</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">u</span> <span class="o">/</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">v</span> <span class="o">/</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>

<span class="c1"># Draw a line between u and v.</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">.2</span><span class="p">,</span> <span class="s1">&#39;弦&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lx</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ly</span> <span class="o">/</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">lx</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">lx</span> <span class="o">/</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">lx</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">lx</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:purple&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">lx</span><span class="p">)),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ly</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">lx</span> <span class="o">/</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">lx</span><span class="p">],</span> <span class="p">[</span><span class="n">ly</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">u</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$u$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda u + (1 - \lambda)v$&#39;</span><span class="p">,</span> <span class="s1">&#39;$v$&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">lx</span><span class="p">),</span> <span class="n">ly</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">)],</span> <span class="p">[</span><span class="s1">&#39;$f(u)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$f(\lambda u + (1 - \lambda)v)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\lambda f(u) + (1 - \lambda)f(v)$&#39;</span><span class="p">,</span> <span class="s1">&#39;$f(v)$&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_35_0.png" src="../_images/02mra_35_0.png" />
</div>
</div>
<div class="note admonition">
<p class="admonition-title">一階微分と凸関数に関する定理</p>
<p>関数<span class="math notranslate nohighlight">\(f: \mathbb{R}^{d} \longmapsto \mathbb{R}\)</span>が一階微分可能であるとする。任意の<span class="math notranslate nohighlight">\(\bm{x}, \bm{z} \in \mathbb{R}^{d}\)</span>に対して、</p>
<div class="math notranslate nohighlight" id="equation-eq-first-derivative-convex">
<span class="eqno">(2.33)<a class="headerlink" href="#equation-eq-first-derivative-convex" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
f(\bm{z}) \geq f(\bm{x}) + \nabla f(\bm{x})^\top (\bm{z} - \bm{x})
\end{align}
\]</div>
<p>が成り立つとき、<span class="math notranslate nohighlight">\(f\)</span>は凸関数である。</p>
</div>
<p>【証明】任意の<span class="math notranslate nohighlight">\(\bm{u}, \bm{v} \in \mathbb{R}^d\)</span>と<span class="math notranslate nohighlight">\(0 \leq \lambda \leq 1\)</span>を満たす任意の<span class="math notranslate nohighlight">\(\lambda\)</span>を用いて、<span class="math notranslate nohighlight">\(\bm{x} = \lambda \bm{u} + (1-\lambda)\bm{v}\)</span>と表す。式<a class="reference internal" href="#equation-eq-first-derivative-convex">(2.33)</a>の不等式を<span class="math notranslate nohighlight">\(\bm{z} = \bm{u}, \bm{v}\)</span>として適用すると、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
f(\bm{u}) \geq&amp; f(\bm{x}) + \nabla f(\bm{x})^\top (\bm{u} - \bm{x}) = f(\bm{x}) + (1 - \lambda) \nabla f(\bm{x})^\top (\bm{u} - \bm{v}) \\
f(\bm{v}) \geq&amp; f(\bm{x}) + \nabla f(\bm{x})^\top (\bm{v} - \bm{x}) = f(\bm{x}) + \lambda \nabla f(\bm{x})^\top (\bm{v} - \bm{u})
\end{align*}\]</div>
<p>これらの不等式に基づいて<span class="math notranslate nohighlight">\(\lambda f(\bm{u}) + (1 - \lambda)f(\bm{v})\)</span>を計算すると、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lambda f(\bm{u}) + (1 - \lambda)f(\bm{v}) &amp;\geq \lambda \{f(\bm{x}) + (1 - \lambda) \nabla f(\bm{x})^\top (\bm{u} - \bm{v})\} + (1 - \lambda) \{f(\bm{x}) + \lambda \nabla f(\bm{x})^\top (\bm{v} - \bm{u})\} \\
&amp;= f(\bm{x}) + \lambda (1 - \lambda) \nabla f(\bm{x})^\top (\bm{u} - \bm{v}) + \lambda (1 - \lambda) \nabla f(\bm{x})^\top (\bm{v} - \bm{u}) \\
&amp;= f(\bm{x}) + \lambda (1 - \lambda) \nabla f(\bm{x})^\top (\bm{u} - \bm{v} + \bm{v} - \bm{u}) \\
&amp;= f(\bm{x}) \\
&amp;= f(\lambda \bm{u} + (1-\lambda)\bm{v})
\end{align*}\]</div>
<p>である（最終行の変形では<span class="math notranslate nohighlight">\(\bm{x}\)</span>の<span class="math notranslate nohighlight">\(\bm{u}\)</span>と<span class="math notranslate nohighlight">\(\bm{v}\)</span>による表示を代入した）。この不等式は凸関数の定義（式<a class="reference internal" href="#equation-eq-convex-definition">(2.32)</a>）そのものであり、<span class="math notranslate nohighlight">\(f\)</span>は凸関数であることが示された。なお、ここでは省略するが、この逆を証明して必要十分条件を示すことができる。</p>
<p>この定理は、「関数<span class="math notranslate nohighlight">\(f\)</span>上の任意の点の接線は<span class="math notranslate nohighlight">\(f\)</span>の曲線よりも下にある」ことを表現している（厳密には曲線が接線が同じ点で接することがある）。
<span class="math notranslate nohighlight">\(f\)</span>が1変数関数のとき、ある<span class="math notranslate nohighlight">\(\bm{x}, \bm{z}\)</span>に対してこの定理が成り立つ様子を図示した。</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">0.15</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">z</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fxz</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">x</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">x</span><span class="o">/</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fxz</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">fxz</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">z</span><span class="o">/</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;$(z-x)$&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">z</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="p">(</span><span class="n">fxz</span> <span class="o">+</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$\nabla f(x)(z-x)$&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">fxz</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="n">xm</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">.4</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="mf">0.6</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">xm</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;曲線&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">xm</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;接線&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="s1">&#39;$z$&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fxz</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">)],</span> <span class="p">[</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;$f(x) + \nabla f(x)(z-x)$&quot;</span><span class="p">,</span> <span class="s1">&#39;$f(z)$&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_37_0.png" src="../_images/02mra_37_0.png" />
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"><span class="math notranslate nohighlight">\(\nabla^2\)</span>と二階微分</p>
<p><span class="math notranslate nohighlight">\(\nabla^2\)</span>はラプラシアンかヘッセ行列を表す。<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>において、<span class="math notranslate nohighlight">\(\nabla^2\)</span>を内積<span class="math notranslate nohighlight">\(\nabla \cdot \nabla\)</span>とすると、ラプラシアンとなる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla \cdot \nabla &amp;= \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} \cdot \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} \\
&amp;=
\frac{\partial^2}{\partial^2 x} +
\frac{\partial^2}{\partial^2 y} +
\frac{\partial^2}{\partial^2 z}
\end{align*}\]</div>
<p>これに対し、<span class="math notranslate nohighlight">\(\nabla^2\)</span>を直積<span class="math notranslate nohighlight">\(\nabla \nabla^\top\)</span>と考えると、ヘッセ行列となる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla \nabla^\top &amp;= \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} \begin{pmatrix}
\frac{\partial}{\partial x} &amp;
\frac{\partial}{\partial y} &amp;
\frac{\partial}{\partial z}
\end{pmatrix} \\
&amp;= \begin{pmatrix}
\frac{\partial^2}{\partial^2 x} &amp; \frac{\partial^2}{\partial x \partial y} &amp; \frac{\partial^2}{\partial x \partial z} \\
\frac{\partial^2}{\partial y \partial x} &amp; \frac{\partial^2}{\partial^2 y} &amp; \frac{\partial^2}{\partial y \partial z} \\
\frac{\partial^2}{\partial z \partial x} &amp; \frac{\partial^2}{\partial z \partial y} &amp; \frac{\partial^2}{\partial^2 z} \\
\end{pmatrix}
\end{align*}\]</div>
<p>本資料では、<span class="math notranslate nohighlight">\(\nabla^2\)</span>でヘッセ行列を表すこととする。</p>
</aside>
<div class="note admonition">
<p class="admonition-title">二階微分と凸関数に関する定理</p>
<p>関数<span class="math notranslate nohighlight">\(f: \mathbb{R}^{d} \longmapsto \mathbb{R}\)</span>が二階微分可能であるとする。<span class="math notranslate nohighlight">\(f\)</span>の二階微分であるヘッセ行列、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla^2 f(\bm{x}) = 
\begin{pmatrix}
\frac{\partial^2 f}{\partial^2 x_1} &amp; \frac{\partial^2 f}{\partial x_1 \partial x_2} &amp; \dots &amp; \frac{\partial^2 f}{\partial x_1 \partial x_d} \\
\frac{\partial^2 f}{\partial x_2 x_1} &amp; \frac{\partial^2 f}{\partial^2 x_2} &amp; \dots &amp; \frac{\partial^2 f}{\partial x_2 \partial x_d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\frac{\partial^2 f}{\partial x_d x_1} &amp; \frac{\partial^2 f}{\partial x_d x_2} &amp; \dots &amp; \frac{\partial^2 f}{\partial^2 x_d} \\
\end{pmatrix} \in \mathbb{R}^{d \times d}
\end{align*}\]</div>
<p>が半正定値行列であるとき、すなわち、任意のベクトル<span class="math notranslate nohighlight">\(\bm{u}\)</span>に対して、</p>
<div class="math notranslate nohighlight" id="equation-eq-second-derivative-convex">
<span class="eqno">(2.34)<a class="headerlink" href="#equation-eq-second-derivative-convex" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\bm{u}^\top \nabla^2 f(\bm{x}) \bm{u} \geq 0
\end{align}
\]</div>
<p>が成り立つとき、<span class="math notranslate nohighlight">\(f\)</span>は凸関数である。</p>
</div>
<aside class="margin sidebar">
<p class="sidebar-title">テイラーの定理</p>
<p>関数<span class="math notranslate nohighlight">\(f: \mathbb{R} \longmapsto \mathbb{R}\)</span>に関するテイラーの定理を紹介する。関数<span class="math notranslate nohighlight">\(f\)</span>が閉区間<span class="math notranslate nohighlight">\([x, z]\)</span>上で<span class="math notranslate nohighlight">\(n\)</span>回微分可能であるとき、次式が成り立つ。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
f(z) =&amp; f(x) + f'(x)(z-x) \\
&amp;+ \frac{f''(x)}{2!}(z-x)^2 + \dots \\
&amp;+ \frac{f^{(n-1)}(x)}{(n-1)!}(z-x)^{(n-1)}\\
&amp;+ R_n
\end{align*}\]</div>
<p>ただし、<span class="math notranslate nohighlight">\(R_n\)</span>はラグランジュの剰余項で、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
R_n = \frac{(z-x)^{n}}{n!}f^{(n)}(x + \lambda(z-x))
\end{align*}\]</div>
<p>を満たす<span class="math notranslate nohighlight">\(\lambda\; (0 &lt; \lambda &lt; 1)\)</span>が存在する。本資料では、<span class="math notranslate nohighlight">\(f\)</span>を<span class="math notranslate nohighlight">\(\mathbb{R}^d\)</span>の値をとる関数に拡張したうえで、<span class="math notranslate nohighlight">\(n=2\)</span>としてテイラーの定理を適用している。</p>
</aside>
<p>【証明】テイラーの定理より、任意の<span class="math notranslate nohighlight">\(\bm{x}, \bm{z} \in \mathbb{R}^{d}\)</span>に対して、<span class="math notranslate nohighlight">\(0 &lt; \lambda &lt; 1\)</span>を満たす<span class="math notranslate nohighlight">\(\lambda\)</span>が存在し、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
f(\bm{z}) = f(\bm{x}) + \nabla f(\bm{x})^\top (\bm{z} - \bm{x}) + \frac{1}{2} (\bm{z} - \bm{x})^\top \nabla^2 f(\bm{x} + \lambda (\bm{z} - \bm{x})) (\bm{z} - \bm{x})
\end{align*}\]</div>
<p>を満たす。仮定より、<span class="math notranslate nohighlight">\(f\)</span>のヘッセ行列は半正定値行列であることから、上式の第3項は常に非負である（<span class="math notranslate nohighlight">\(\bm{u} = \bm{z} - \bm{x}\)</span>とおけばよい）。ゆえに、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
f(\bm{z}) \geq f(\bm{x}) + \nabla f(\bm{x})^\top (\bm{z} - \bm{x})
\end{align*}\]</div>
<p>であり、一階微分と凸関数に関する定理（式<a class="reference internal" href="#equation-eq-first-derivative-convex">(2.33)</a>）から、<span class="math notranslate nohighlight">\(f\)</span>は凸関数であることが示された。なお、ここでは省略するが、この逆を証明して必要十分条件を示すことができる。</p>
<p><span class="math notranslate nohighlight">\(f\)</span>が1変数関数のとき、式<a class="reference internal" href="#equation-eq-second-derivative-convex">(2.34)</a>の条件は<span class="math notranslate nohighlight">\(f''(x) \geq 0\)</span>となる。これは、<span class="math notranslate nohighlight">\(f\)</span>の傾きが単調増加する（厳密には減少しない）ことを表している。</p>
</section>
<section id="id10">
<h3><span class="section-number">2.6.2. </span>目的関数が凸関数であることの証明<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">#</a></h3>
<p>さて、ヘッセ行列の半正定値性から凸関数であることを示せることが分かったので、変数を<span class="math notranslate nohighlight">\(\bm{x} \to \bm{w}\)</span>に、目的関数を<span class="math notranslate nohighlight">\(f(\bm{x}) \to \hat{L}_{\mathcal{D}}(\bm{w})\)</span>に置換して考察する。式<a class="reference internal" href="#equation-eq-gradient">(2.23)</a>より、目的関数の一階微分は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-ab3f3aa3-245d-4b4c-8af1-c8beaf734824">
<span class="eqno">(2.35)<a class="headerlink" href="#equation-ab3f3aa3-245d-4b4c-8af1-c8beaf734824" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\bm{w})
= \begin{pmatrix}
\frac{\partial}{\partial w_1} \\
\frac{\partial}{\partial w_2} \\
\vdots \\
\frac{\partial}{\partial w_d} \\
\end{pmatrix} \hat{L}_{\mathcal{D}}(\bm{w})
= \frac{\partial \hat{L}_{\mathcal{D}}(\bm{w})}{\partial \bm{w}}
= 2 \bm{X}^\top (\bm{X}\bm{w} - \bm{y})
= 2 \bm{X}^\top\bm{X}\bm{w} - 2 \bm{X}^\top\bm{y}
\end{align}\]</div>
<p>さらに、目的関数の二階微分（ヘッセ行列）は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-ca6b52a7-8702-4a41-94bf-bb57b41658ad">
<span class="eqno">(2.36)<a class="headerlink" href="#equation-ca6b52a7-8702-4a41-94bf-bb57b41658ad" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla^2 \hat{L}_{\mathcal{D}}(\bm{w})
&amp;= \begin{pmatrix}
\frac{\partial^2}{\partial^2 w_1} &amp; \frac{\partial^2}{\partial w_1 \partial w_2} &amp; \dots &amp; \frac{\partial^2}{\partial w_1 \partial w_d} \\
\frac{\partial^2}{\partial w_2 \partial w_1} &amp; \frac{\partial^2}{\partial^2 w_2} &amp; \dots &amp; \frac{\partial^2}{\partial w_2 \partial w_d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\frac{\partial^2}{\partial w_d \partial w_1} &amp; \frac{\partial^2}{\partial w_d \partial w_2} &amp; \dots &amp; \frac{\partial^2}{\partial^2 w_d}
\end{pmatrix} \hat{L}_{\mathcal{D}}(\bm{w}) \\
&amp;= \frac{\partial}{\partial \bm{w}} (2 \bm{X}^\top \bm{X}\bm{w} - 2 \bm{X}^\top \bm{y}) \\
&amp;= 2 (\bm{X}^\top \bm{X})^\top \\
&amp;= 2 \bm{X}^\top \bm{X} &amp;&amp; (\because (\bm{X}^\top \bm{X})\text{は対称行列})
\end{align}\]</div>
<p>ここで、任意のベクトル<span class="math notranslate nohighlight">\(\bm{u} \in \mathbb{R}^d\)</span>に対して、</p>
<div class="amsmath math notranslate nohighlight" id="equation-af6ecdc5-52af-427e-a6a7-4fa3b2e1c0a0">
<span class="eqno">(2.37)<a class="headerlink" href="#equation-af6ecdc5-52af-427e-a6a7-4fa3b2e1c0a0" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{u}^\top (2 \bm{X}^\top \bm{X}) \bm{u} = 2 \bm{u}^\top \bm{X}^\top \bm{X} \bm{u} = 2(\bm{X}\bm{u})^\top (\bm{X} \bm{u}) = 2 \|\bm{X} \bm{u}\|^2 \geq 0
\end{align}\]</div>
<p>であるから、目的関数の二階微分<span class="math notranslate nohighlight">\(2 \bm{X}^\top \bm{X}\)</span>は半正定値行列である。ゆえに、重回帰の目的関数は凸関数である。</p>
<p>なお、凸関数の定義を用いて重回帰の目的関数が凸であることを証明する方法もあるが、ここでは省略する。</p>
</section>
</section>
<section id="id11">
<h2><span class="section-number">2.7. </span>重回帰の性質<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">#</a></h2>
<p>重回帰に関する様々な性質を導出してみよう <span id="id12">[<a class="reference internal" href="../reference.html#id5" title="Nathaniel Beck. Ols in matrix form. 2009. URL: https://web.stanford.edu/~mrosenfe/soc_meth_proj3/matrix_OLS_NYU_notes.pdf.">Beck, 2009</a>]</span>。重回帰で推定されたパラメータ<span class="math notranslate nohighlight">\(\bm{w}\)</span>は、式<a class="reference internal" href="#equation-eq-gradient">(2.23)</a>を<span class="math notranslate nohighlight">\(\bm{0}\)</span>とおいたものであるので、</p>
<div class="math notranslate nohighlight" id="equation-eq-x-top-epsilon">
<span class="eqno">(2.38)<a class="headerlink" href="#equation-eq-x-top-epsilon" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\bm{w}) = -2 \bm{X}^\top \bm{\epsilon} &amp;= \bm{0} \\
\bm{X}^\top \bm{\epsilon} &amp;= \bm{0}
\end{align}
\end{split}\]</div>
<p>この行列・ベクトルの成分を明示すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-5548b448-2e53-4634-9000-d1102e77e5db">
<span class="eqno">(2.39)<a class="headerlink" href="#equation-5548b448-2e53-4634-9000-d1102e77e5db" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\begin{pmatrix}
X_{1,1} &amp; X_{2,1} &amp; \dots &amp; X_{N,1} \\
X_{1,2} &amp; X_{2,2} &amp; \dots &amp; X_{N,2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,d} &amp; X_{2,d} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\begin{pmatrix}
\epsilon_1 \\
\epsilon_2 \\
\vdots \\
\epsilon_N
\end{pmatrix}
=
\begin{pmatrix}
\sum_{i=1}^N X_{i,1} \epsilon_i \\
\sum_{i=1}^N X_{i,2} \epsilon_i \\
\vdots \\
\sum_{i=1}^N X_{i,d} \epsilon_i
\end{pmatrix}
=
\begin{pmatrix}
0 \\ 0 \\ \vdots \\ 0
\end{pmatrix}
\end{align}\]</div>
<p>ゆえに、任意の整数<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>に関して、</p>
<div class="math notranslate nohighlight" id="equation-eq-epsilon-property">
<span class="eqno">(2.40)<a class="headerlink" href="#equation-eq-epsilon-property" title="この数式へのパーマリンク">#</a></span>\[
\sum_{i=1}^N X_{i,j} \epsilon_i = 0
\]</div>
<p>これは、<span class="math notranslate nohighlight">\(\bm{w}\)</span>を求めるときに、式<a class="reference internal" href="#equation-eq-mra-grad-wj">(2.20)</a>の2行目を全ての<span class="math notranslate nohighlight">\(j\)</span>に対して<span class="math notranslate nohighlight">\(0\)</span>としたことからも、明らかである。</p>
<p>ここで、バイアス項（切片）に対応するパラメータを持たせるため、<span class="math notranslate nohighlight">\(\bm{X}\)</span>の先頭列の要素はすべて<span class="math notranslate nohighlight">\(1\)</span>と仮定する。</p>
<div class="math notranslate nohighlight" id="equation-eq-first-column-one">
<span class="eqno">(2.41)<a class="headerlink" href="#equation-eq-first-column-one" title="この数式へのパーマリンク">#</a></span>\[
\begin{array}{cc}
X_{i,1} = 1 &amp; (i \in \{1, 2, \dots, N\})
\end{array}
\]</div>
<p>念のため、<span class="math notranslate nohighlight">\(\bm{X}\)</span>と<span class="math notranslate nohighlight">\(\bm{X}^\top\)</span>を明示的に書くと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-e3433ad7-ff51-421f-845f-30d409d4c519">
<span class="eqno">(2.42)<a class="headerlink" href="#equation-e3433ad7-ff51-421f-845f-30d409d4c519" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\bm{X} = 
\begin{pmatrix}
1 &amp; X_{1,2} &amp; \dots &amp; X_{1,d} \\
1 &amp; X_{2,2} &amp; \dots &amp; X_{2,d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
1 &amp; X_{1,N} &amp; \dots &amp; X_{N,d}
\end{pmatrix}, 
\bm{X}^\top = 
\begin{pmatrix}
1 &amp; 1 &amp; \dots &amp; 1 \\
X_{1,2} &amp; X_{2,2} &amp; \dots &amp; X_{N,2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,d} &amp; X_{2,d} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\end{align}\]</div>
<p>これにより、<span class="math notranslate nohighlight">\(w_1\)</span>がバイアス項に対応するパラメータとなる。ここから、重回帰の様々な性質を導出してみよう。なお、バイアス項に対応させる列は先頭である必要はなく、その他の場所でも以降の議論の一般性は失われない。</p>
<section id="id13">
<h3><span class="section-number">2.7.1. </span>残差の和および平均は<span class="math notranslate nohighlight">\(0\)</span><a class="headerlink" href="#id13" title="この見出しへのパーマリンク">#</a></h3>
<p><span class="math notranslate nohighlight">\(j=1\)</span>として式<a class="reference internal" href="#equation-eq-epsilon-property">(2.40)</a>に式<a class="reference internal" href="#equation-eq-first-column-one">(2.41)</a>を代入すると、</p>
<div class="math notranslate nohighlight" id="equation-eq-sum-epsilon-zero-mra">
<span class="eqno">(2.43)<a class="headerlink" href="#equation-eq-sum-epsilon-zero-mra" title="この数式へのパーマリンク">#</a></span>\[
\sum_{i=1}^N X_{i,1} \epsilon_i = \sum_{i=1}^N \epsilon_i = 0
\]</div>
<p>ゆえに、残差の和および平均は<span class="math notranslate nohighlight">\(0\)</span>である。</p>
</section>
<section id="hat-y-y">
<h3><span class="section-number">2.7.2. </span>目的変数の推定値<span class="math notranslate nohighlight">\(\hat{y}\)</span>の平均値は観測値<span class="math notranslate nohighlight">\(y\)</span>の平均に等しい<a class="headerlink" href="#hat-y-y" title="この見出しへのパーマリンク">#</a></h3>
<p>残差の定義<span class="math notranslate nohighlight">\(\bm{\epsilon} = \bm{y} - \hat{\bm{y}}\)</span>を明示的に書くと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-d75b9264-8229-49be-a7e1-88fb4b27f178">
<span class="eqno">(2.44)<a class="headerlink" href="#equation-d75b9264-8229-49be-a7e1-88fb4b27f178" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\begin{pmatrix}
\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_N
\end{pmatrix} =
\begin{pmatrix}
y_1 \\ y_2 \\ \vdots \\ y_N
\end{pmatrix}
-
\begin{pmatrix}
\hat{y}_1 \\ \hat{y}_2 \\ \vdots \\ \hat{y}_N
\end{pmatrix}
\end{align}\]</div>
<p>両辺の各要素の和をとると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-3b087c15-7b8b-4ec4-bfd6-62663debe3b1">
<span class="eqno">(2.45)<a class="headerlink" href="#equation-3b087c15-7b8b-4ec4-bfd6-62663debe3b1" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\sum_{i=1}^N \epsilon_i = \sum_{i=1}^N y_i - \sum_{i=1}^N \hat{y}_i
\end{align}\]</div>
<p>ここで、式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.43)</a>より左辺は<span class="math notranslate nohighlight">\(0\)</span>であるから、</p>
<div class="amsmath math notranslate nohighlight" id="equation-e8244799-7152-45fd-9b94-99cb0afa49d7">
<span class="eqno">(2.46)<a class="headerlink" href="#equation-e8244799-7152-45fd-9b94-99cb0afa49d7" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\sum_{i=1}^N y_i &amp;= \sum_{i=1}^N \hat{y}_i \\
\frac{1}{N}\sum_{i=1}^N y_i &amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \\
\overline{y} &amp;= \overline{\hat{y}}
\end{align}\]</div>
<p>ゆえに、目的変数の推定値<span class="math notranslate nohighlight">\(\hat{y}\)</span>の平均値は観測値<span class="math notranslate nohighlight">\(y\)</span>の平均に等しい。</p>
</section>
<section id="id14">
<h3><span class="section-number">2.7.3. </span>観測データの重心は回帰平面上に存在する<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">#</a></h3>
<p>説明変数の平均ベクトル<span class="math notranslate nohighlight">\(\overline{\bm{x}}\)</span>、</p>
<div class="amsmath math notranslate nohighlight" id="equation-f3b068c6-4ea7-4e01-8374-08589e3c9111">
<span class="eqno">(2.47)<a class="headerlink" href="#equation-f3b068c6-4ea7-4e01-8374-08589e3c9111" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\overline{\bm{x}} = \frac{1}{N} \sum_{i=1}^N \bm{x}_i
\end{align}\]</div>
<p>に対して、目的変数の推定値を計算すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-0db85c5d-4ffe-452b-97d1-6e013f46f599">
<span class="eqno">(2.48)<a class="headerlink" href="#equation-0db85c5d-4ffe-452b-97d1-6e013f46f599" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\overline{\bm{x}}^\top \bm{w}
&amp;= \frac{1}{N} \sum_{i=1}^N \bm{x}_i^\top \bm{w} \\
&amp;= \frac{1}{N} \sum_{i=1}^N \hat{y}_i \\
&amp;= \overline{\hat{y}} = \overline{y}
\end{align}\]</div>
<p>目的変数の平均<span class="math notranslate nohighlight">\(\overline{y}\)</span>が得られる。ゆえに、観測データの重心は回帰平面上に存在する。</p>
</section>
<section id="id15">
<h3><span class="section-number">2.7.4. </span>各説明変数と残差には相関がない<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">#</a></h3>
<p><span class="math notranslate nohighlight">\(j\)</span>番目の説明変数<span class="math notranslate nohighlight">\(\bm{X}_{:,j}\)</span>を確率変数と見なし、<span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>と書くことにする。
任意の説明変数<span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>と残差<span class="math notranslate nohighlight">\(\mathcal{E}\)</span>の共分散を計算する。残差の平均は<span class="math notranslate nohighlight">\(\overline{\epsilon}=0\)</span>であること、式<a class="reference internal" href="#equation-eq-epsilon-property">(2.40)</a>と式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.43)</a>を利用すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-17ac3adf-a699-41af-9c46-9f6f4c907705">
<span class="eqno">(2.49)<a class="headerlink" href="#equation-17ac3adf-a699-41af-9c46-9f6f4c907705" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathrm{Cov}[\mathcal{X}_j, \mathcal{E}] &amp;= \frac{1}{N}\sum_{i=1}^N (X_{i,j} - \overline{\bm{X}_{:,j}}) (\epsilon_i - \overline{\epsilon}) \\
&amp;= \frac{1}{N}\sum_{i=1}^N (X_{i,j} - \overline{\bm{X}_{:,j}}) \epsilon_i \\
&amp;= \frac{1}{N}\sum_{i=1}^N X_{i,j}  \epsilon_i - \frac{1}{N}\sum_{i=1}^N  \overline{\bm{X}_{:,j}} \epsilon_i \\
&amp;= \frac{1}{N}\underbrace{\sum_{i=1}^N X_{i,j} \epsilon_i}_{0} - \frac{\overline{\bm{X}_{:,j}}}{N}\underbrace{\sum_{i=1}^N  \epsilon_i}_{0} \\
&amp;= 0
\end{align}\]</div>
</section>
<section id="id16">
<h3><span class="section-number">2.7.5. </span>目的変数の推定値と残差には相関がない<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">#</a></h3>
<p>目的変数の推定値<span class="math notranslate nohighlight">\(\hat{\mathcal{Y}}\)</span>と残差<span class="math notranslate nohighlight">\(\mathcal{E}\)</span>の共分散を計算する。残差の平均は<span class="math notranslate nohighlight">\(\overline{\epsilon}=0\)</span>であること、式<a class="reference internal" href="#equation-eq-x-top-epsilon">(2.38)</a>と式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.43)</a>を利用すると、</p>
<div class="math notranslate nohighlight" id="equation-eq-cov-hat-y-and-epsilon-mra">
<span class="eqno">(2.50)<a class="headerlink" href="#equation-eq-cov-hat-y-and-epsilon-mra" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\mathrm{Cov}[\hat{\mathcal{Y}},\mathcal{E}] &amp;= \frac{1}{N}\sum_{i=1}^N (\hat{y}_i - \overline{\hat{y}}) (\epsilon_i - \overline{\epsilon}) \\
&amp;= \frac{1}{N}\sum_{i=1}^N (\hat{y}_i - \overline{\hat{y}}) \epsilon_i \\
&amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \epsilon_i - \frac{1}{N}\sum_{i=1}^N \overline{\hat{y}} \epsilon_i \\
&amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \epsilon_i - \frac{\overline{\hat{y}}}{N}\underbrace{\sum_{i=1}^N \epsilon_i}_{0} \\
&amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \epsilon_i \\
&amp;= \frac{1}{N}\bm{\hat{y}}^\top \bm{\epsilon} \\
&amp;= \frac{1}{N}(\bm{X} \bm{w})^\top \bm{\epsilon} \\
&amp;= \frac{1}{N}\bm{w}^\top \underbrace{\bm{X}^\top \bm{\epsilon}}_{0} \\
&amp;= 0
\end{align}
\end{split}\]</div>
<p>であるから、<span class="math notranslate nohighlight">\(\mathrm{Cov}[\hat{\mathcal{Y}},\mathcal{E}] = 0\)</span>が言える。すなわち、目的変数の推定値と残差の共分散が0になることから、目的変数の推定値と残差は無相関（無関係）であることが分かる。</p>
</section>
</section>
<section id="id17">
<h2><span class="section-number">2.8. </span>決定係数<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">#</a></h2>
<p>目的変数の観測値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{Y}]\)</span>は目的変数の推定値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\hat{\mathcal{Y}}]\)</span>と残差の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{E}]\)</span>の和で表されることを示す。</p>
<div class="amsmath math notranslate nohighlight" id="equation-274fe39f-daf8-48b1-904c-66811346eda9">
<span class="eqno">(2.51)<a class="headerlink" href="#equation-274fe39f-daf8-48b1-904c-66811346eda9" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathrm{Var}[\mathcal{Y}] &amp;= \frac{1}{N} \sum_{i=1}^N (y_i - \overline{y})^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N \{(\hat{y}_i + \epsilon_i) - \overline{y}\}^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N \{(\hat{y}_i  - \overline{y}) + \epsilon_i\}^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N (\hat{y}_i  - \overline{y})^2 + \frac{1}{N} \sum_{i=1}^N 2 (\hat{y}_i  - \overline{y}) \epsilon_i + \frac{1}{N} \sum_{i=1}^N \epsilon_i^2 \\
&amp;= \mathrm{Var}[\hat{\mathcal{Y}}] + 2 \cdot \frac{1}{N} \underbrace{\sum_{i=1}^N \hat{y}_i \epsilon_i}_{0} - 2\overline{y} \cdot \frac{1}{N} \underbrace{\sum_{i=1}^N \epsilon_i}_{0} + \mathrm{Var}[\mathcal{E}] \\
&amp;= \mathrm{Var}[\hat{\mathcal{Y}}] + \mathrm{Var}[\mathcal{E}]
\end{align}\]</div>
<p>なお、以上の式変形における最後から2行目において、第２項は式<a class="reference internal" href="#equation-eq-cov-hat-y-and-epsilon-mra">(2.50)</a>の導出結果、第３項は式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.43)</a>より<span class="math notranslate nohighlight">\(0\)</span>であることを利用した。</p>
<p>したがって、単回帰のときと同様に、</p>
<ul class="simple">
<li><p><strong>全変動</strong>: 目的変数の観測値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{Y}]\)</span>（データの変動）</p></li>
<li><p><strong>回帰変動</strong>: 目的変数の推定値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\hat{\mathcal{Y}}]\)</span>（モデルの変動）</p></li>
<li><p><strong>残差変動</strong>: 残差の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{E}]\)</span>（モデルが説明しきれなかった変動）</p></li>
</ul>
<p>すると、先ほどの式は「<strong>全変動は回帰変動と残差変動の和で表される</strong>」という関係を表している。</p>
<p>データの全変動のうち、回帰によって表現できた回帰変動の割合を<strong>決定係数</strong>とよび、次式で定義する。</p>
<div class="important admonition">
<p class="admonition-title">決定係数</p>
<div class="amsmath math notranslate nohighlight" id="equation-c6bc8e0d-097b-493d-a7f2-2abe48cabf7d">
<span class="eqno">(2.52)<a class="headerlink" href="#equation-c6bc8e0d-097b-493d-a7f2-2abe48cabf7d" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
R^2 = \frac{\mathrm{Var}[\hat{\mathcal{Y}}]}{\mathrm{Var}[\mathcal{Y}]} = \frac{\mathrm{Var}[\mathcal{Y}] - \mathrm{Var}[\mathcal{E}]}{\mathrm{Var}[\mathcal{Y}]} = 1 - \frac{\mathrm{Var}[\mathcal{E}]}{\mathrm{Var}[\mathcal{Y}]}
\end{align}\]</div>
</div>
<p>決定係数は<span class="math notranslate nohighlight">\([0,1]\)</span>の範囲の値ととり、データがモデル（単回帰の場合は直線）によく当てはまるときは<span class="math notranslate nohighlight">\(1\)</span>に近くなる。</p>
</section>
<section id="id18">
<h2><span class="section-number">2.9. </span>重回帰の実施例<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">#</a></h2>
<p>冒頭の最高気温とアイスクリーム・シャーベットの支出額のデータに対して、単回帰を行う例を示す。まず、説明変数（最高気温）を<code class="docutils literal notranslate"><span class="pre">X</span></code>、目的変数（支出額）を<code class="docutils literal notranslate"><span class="pre">Y</span></code>に格納する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;最高気温とアイスクリーム・シャーベットの支出額&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;最高気温の月平均（℃）&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;支出額（円）&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
     <span class="mf">9.1</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">,</span> <span class="mf">12.3</span><span class="p">,</span> <span class="mf">18.9</span><span class="p">,</span> <span class="mf">22.2</span><span class="p">,</span> <span class="mf">26.</span> <span class="p">,</span> <span class="mf">30.9</span><span class="p">,</span> <span class="mf">31.2</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span> <span class="mf">18.3</span><span class="p">,</span>
    <span class="mf">11.1</span><span class="p">,</span>  <span class="mf">8.3</span><span class="p">,</span>  <span class="mf">9.1</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">,</span> <span class="mf">18.5</span><span class="p">,</span> <span class="mf">23.6</span><span class="p">,</span> <span class="mf">24.8</span><span class="p">,</span> <span class="mf">30.1</span><span class="p">,</span> <span class="mf">33.1</span><span class="p">,</span> <span class="mf">29.8</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span>
    <span class="mf">16.3</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">,</span>  <span class="mf">9.6</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">16.4</span><span class="p">,</span> <span class="mf">19.2</span><span class="p">,</span> <span class="mf">24.1</span><span class="p">,</span> <span class="mf">26.5</span><span class="p">,</span> <span class="mf">31.4</span><span class="p">,</span> <span class="mf">33.2</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span>
    <span class="mf">23.</span> <span class="p">,</span> <span class="mf">17.4</span><span class="p">,</span> <span class="mf">12.1</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span>  <span class="mf">9.8</span><span class="p">,</span> <span class="mf">14.5</span><span class="p">,</span> <span class="mf">19.6</span><span class="p">,</span> <span class="mf">24.7</span><span class="p">,</span> <span class="mf">26.9</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">,</span> <span class="mf">31.2</span><span class="p">,</span>
    <span class="mf">26.9</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span> <span class="mf">17.4</span><span class="p">,</span> <span class="mf">11.</span> <span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">,</span> <span class="mf">19.3</span><span class="p">,</span> <span class="mf">26.4</span><span class="p">,</span> <span class="mf">26.4</span><span class="p">,</span> <span class="mf">30.1</span><span class="p">,</span>
    <span class="mf">30.5</span><span class="p">,</span> <span class="mf">26.4</span><span class="p">,</span> <span class="mf">22.7</span><span class="p">,</span> <span class="mf">17.8</span><span class="p">,</span> <span class="mf">13.4</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">12.2</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">,</span> <span class="mf">20.3</span><span class="p">,</span> <span class="mf">25.2</span><span class="p">,</span> <span class="mf">26.3</span><span class="p">,</span>
    <span class="mf">29.7</span><span class="p">,</span> <span class="mf">31.6</span><span class="p">,</span> <span class="mf">27.7</span><span class="p">,</span> <span class="mf">22.6</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">,</span> <span class="mf">13.8</span><span class="p">,</span> <span class="mf">10.8</span><span class="p">,</span> <span class="mf">12.1</span><span class="p">,</span> <span class="mf">13.4</span><span class="p">,</span> <span class="mf">19.9</span><span class="p">,</span> <span class="mf">25.1</span><span class="p">,</span>
    <span class="mf">26.4</span><span class="p">,</span> <span class="mf">31.8</span><span class="p">,</span> <span class="mf">30.4</span><span class="p">,</span> <span class="mf">26.8</span><span class="p">,</span> <span class="mf">20.1</span><span class="p">,</span> <span class="mf">16.6</span><span class="p">,</span> <span class="mf">11.1</span><span class="p">,</span>  <span class="mf">9.4</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">,</span> <span class="mf">16.9</span><span class="p">,</span> <span class="mf">22.1</span><span class="p">,</span>
    <span class="mf">24.6</span><span class="p">,</span> <span class="mf">26.6</span><span class="p">,</span> <span class="mf">32.7</span><span class="p">,</span> <span class="mf">32.5</span><span class="p">,</span> <span class="mf">26.6</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span> <span class="mf">17.7</span><span class="p">,</span> <span class="mf">12.1</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">11.6</span><span class="p">,</span> <span class="mf">15.4</span><span class="p">,</span>
    <span class="mf">19.</span> <span class="p">,</span> <span class="mf">25.3</span><span class="p">,</span> <span class="mf">25.8</span><span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="mf">32.8</span><span class="p">,</span> <span class="mf">29.4</span><span class="p">,</span> <span class="mf">23.3</span><span class="p">,</span> <span class="mf">17.7</span><span class="p">,</span> <span class="mf">12.6</span><span class="p">,</span> <span class="mf">11.1</span><span class="p">,</span> <span class="mf">13.3</span><span class="p">,</span>
    <span class="mf">16.</span> <span class="p">,</span> <span class="mf">18.2</span><span class="p">,</span> <span class="mf">24.</span> <span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="mf">27.7</span><span class="p">,</span> <span class="mf">34.1</span><span class="p">,</span> <span class="mf">28.1</span><span class="p">,</span> <span class="mf">21.4</span><span class="p">,</span> <span class="mf">18.6</span><span class="p">,</span> <span class="mf">12.3</span><span class="p">])</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">463.</span><span class="p">,</span>  <span class="mf">360.</span><span class="p">,</span>  <span class="mf">380.</span><span class="p">,</span>  <span class="mf">584.</span><span class="p">,</span>  <span class="mf">763.</span><span class="p">,</span>  <span class="mf">886.</span><span class="p">,</span> <span class="mf">1168.</span><span class="p">,</span> <span class="mf">1325.</span><span class="p">,</span>  <span class="mf">847.</span><span class="p">,</span>
    <span class="mf">542.</span><span class="p">,</span>  <span class="mf">441.</span><span class="p">,</span>  <span class="mf">499.</span><span class="p">,</span>  <span class="mf">363.</span><span class="p">,</span>  <span class="mf">327.</span><span class="p">,</span>  <span class="mf">414.</span><span class="p">,</span>  <span class="mf">545.</span><span class="p">,</span>  <span class="mf">726.</span><span class="p">,</span>  <span class="mf">847.</span><span class="p">,</span>
   <span class="mf">1122.</span><span class="p">,</span> <span class="mf">1355.</span><span class="p">,</span>  <span class="mf">916.</span><span class="p">,</span>  <span class="mf">571.</span><span class="p">,</span>  <span class="mf">377.</span><span class="p">,</span>  <span class="mf">465.</span><span class="p">,</span>  <span class="mf">377.</span><span class="p">,</span>  <span class="mf">362.</span><span class="p">,</span>  <span class="mf">518.</span><span class="p">,</span>
    <span class="mf">683.</span><span class="p">,</span>  <span class="mf">838.</span><span class="p">,</span> <span class="mf">1012.</span><span class="p">,</span> <span class="mf">1267.</span><span class="p">,</span> <span class="mf">1464.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span>  <span class="mf">629.</span><span class="p">,</span>  <span class="mf">448.</span><span class="p">,</span>  <span class="mf">466.</span><span class="p">,</span>
    <span class="mf">404.</span><span class="p">,</span>  <span class="mf">343.</span><span class="p">,</span>  <span class="mf">493.</span><span class="p">,</span>  <span class="mf">575.</span><span class="p">,</span>  <span class="mf">921.</span><span class="p">,</span> <span class="mf">1019.</span><span class="p">,</span> <span class="mf">1149.</span><span class="p">,</span> <span class="mf">1303.</span><span class="p">,</span>  <span class="mf">805.</span><span class="p">,</span>
    <span class="mf">739.</span><span class="p">,</span>  <span class="mf">587.</span><span class="p">,</span>  <span class="mf">561.</span><span class="p">,</span>  <span class="mf">486.</span><span class="p">,</span>  <span class="mf">470.</span><span class="p">,</span>  <span class="mf">564.</span><span class="p">,</span>  <span class="mf">609.</span><span class="p">,</span>  <span class="mf">899.</span><span class="p">,</span>  <span class="mf">946.</span><span class="p">,</span>
   <span class="mf">1295.</span><span class="p">,</span> <span class="mf">1325.</span><span class="p">,</span>  <span class="mf">760.</span><span class="p">,</span>  <span class="mf">667.</span><span class="p">,</span>  <span class="mf">564.</span><span class="p">,</span>  <span class="mf">633.</span><span class="p">,</span>  <span class="mf">478.</span><span class="p">,</span>  <span class="mf">450.</span><span class="p">,</span>  <span class="mf">567.</span><span class="p">,</span>
    <span class="mf">611.</span><span class="p">,</span>  <span class="mf">947.</span><span class="p">,</span>  <span class="mf">962.</span><span class="p">,</span> <span class="mf">1309.</span><span class="p">,</span> <span class="mf">1307.</span><span class="p">,</span>  <span class="mf">930.</span><span class="p">,</span>  <span class="mf">668.</span><span class="p">,</span>  <span class="mf">496.</span><span class="p">,</span>  <span class="mf">650.</span><span class="p">,</span>
    <span class="mf">506.</span><span class="p">,</span>  <span class="mf">423.</span><span class="p">,</span>  <span class="mf">531.</span><span class="p">,</span>  <span class="mf">672.</span><span class="p">,</span>  <span class="mf">871.</span><span class="p">,</span>  <span class="mf">986.</span><span class="p">,</span> <span class="mf">1368.</span><span class="p">,</span> <span class="mf">1319.</span><span class="p">,</span>  <span class="mf">924.</span><span class="p">,</span>
    <span class="mf">716.</span><span class="p">,</span>  <span class="mf">651.</span><span class="p">,</span>  <span class="mf">708.</span><span class="p">,</span>  <span class="mf">609.</span><span class="p">,</span>  <span class="mf">535.</span><span class="p">,</span>  <span class="mf">717.</span><span class="p">,</span>  <span class="mf">890.</span><span class="p">,</span> <span class="mf">1054.</span><span class="p">,</span> <span class="mf">1077.</span><span class="p">,</span>
   <span class="mf">1425.</span><span class="p">,</span> <span class="mf">1378.</span><span class="p">,</span>  <span class="mf">900.</span><span class="p">,</span>  <span class="mf">725.</span><span class="p">,</span>  <span class="mf">554.</span><span class="p">,</span>  <span class="mf">542.</span><span class="p">,</span>  <span class="mf">561.</span><span class="p">,</span>  <span class="mf">459.</span><span class="p">,</span>  <span class="mf">604.</span><span class="p">,</span>
    <span class="mf">745.</span><span class="p">,</span> <span class="mf">1105.</span><span class="p">,</span>  <span class="mf">973.</span><span class="p">,</span> <span class="mf">1263.</span><span class="p">,</span> <span class="mf">1533.</span><span class="p">,</span> <span class="mf">1044.</span><span class="p">,</span>  <span class="mf">821.</span><span class="p">,</span>  <span class="mf">621.</span><span class="p">,</span>  <span class="mf">601.</span><span class="p">,</span>
    <span class="mf">549.</span><span class="p">,</span>  <span class="mf">572.</span><span class="p">,</span>  <span class="mf">711.</span><span class="p">,</span>  <span class="mf">819.</span><span class="p">,</span> <span class="mf">1141.</span><span class="p">,</span> <span class="mf">1350.</span><span class="p">,</span> <span class="mf">1285.</span><span class="p">,</span> <span class="mf">1643.</span><span class="p">,</span> <span class="mf">1133.</span><span class="p">,</span>
    <span class="mf">784.</span><span class="p">,</span>  <span class="mf">682.</span><span class="p">,</span>  <span class="mf">587.</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="numpy-polynomial">
<h3><span class="section-number">2.9.1. </span>numpy.polynomialを用いる例<a class="headerlink" href="#numpy-polynomial" title="この見出しへのパーマリンク">#</a></h3>
<p><a class="reference external" href="https://numpy.org/doc/stable/reference/routines.polynomials.html">numpy.polynomial</a>を用いると、線形回帰モデルのパラメータを求めることができる。多項式近似の次元数を３番目の引数に指定する。以下は2次関数にフィッティングする例である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[x \mapsto \text{635.7482577359643} - \text{33.143024247238735}\,x + \text{1.7316079619689542}\,x^{2}\]</div>
</div>
</div>
<p>多項式近似の係数を<span class="math notranslate nohighlight">\(0\)</span>次、<span class="math notranslate nohighlight">\(1\)</span>次、…の順で並べて表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="o">.</span><span class="n">coef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([635.74825774, -33.14302425,   1.73160796])
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(0\)</span>から<span class="math notranslate nohighlight">\(35\)</span>までに等間隔に配置した<span class="math notranslate nohighlight">\(100\)</span>個の数値<code class="docutils literal notranslate"><span class="pre">x</span></code>に対して、目的変数の推定値<code class="docutils literal notranslate"><span class="pre">y_hat</span></code>を求め、回帰曲線を描画する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_52_0.png" src="../_images/02mra_52_0.png" />
</div>
</div>
<p>続いて、3次関数にフィッティングしてみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="o">.</span><span class="n">coef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 2.64628814e+02,  2.92887138e+01, -1.44685888e+00,  5.01164586e-02])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_55_0.png" src="../_images/02mra_55_0.png" />
</div>
</div>
<p>さらに、4次関数にフィッティングした結果を示す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="o">.</span><span class="n">coef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-3.47044444e+02,  1.67566320e+02, -1.23937689e+01,  4.12591380e-01,
       -4.27358629e-03])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_58_0.png" src="../_images/02mra_58_0.png" />
</div>
</div>
</section>
<section id="sklearn-linear-model-linearregression">
<h3><span class="section-number">2.9.2. </span>sklearn.linear_model.LinearRegressionを用いる例<a class="headerlink" href="#sklearn-linear-model-linearregression" title="この見出しへのパーマリンク">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">sklearn.linear_model.LinearRegression</a>クラスを用いても、線形回帰を容易に実行できる。訓練データにフィッティングさせるには、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression.fit">fit</a>関数を呼び出せばよいが、説明変数のデータとして、事例数を行数、目的変数の数を列数とした行列形式で与えることになっているので、<code class="docutils literal notranslate"><span class="pre">X</span></code>の形状を変更する。以下に、3次関数にフィッティングする例を示す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">())</span>
<span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;polynomialfeatures&#x27;, PolynomialFeatures(degree=3)),
                (&#x27;linearregression&#x27;, LinearRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;polynomialfeatures&#x27;, PolynomialFeatures(degree=3)),
                (&#x27;linearregression&#x27;, LinearRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">PolynomialFeatures</label><div class="sk-toggleable__content"><pre>PolynomialFeatures(degree=3)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>回帰直線の係数（傾き）を表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.        , 29.28871381, -1.44685888,  0.05011646])
</pre></div>
</div>
</div>
</div>
<p>回帰直線の切片を表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">intercept_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>264.628814101544
</pre></div>
</div>
</div>
</div>
<p>決定係数を求めるため、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression.score">score</a>関数を呼び出す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8784609747360882
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(0\)</span>から<span class="math notranslate nohighlight">\(35\)</span>までに等間隔に配置した<span class="math notranslate nohighlight">\(100\)</span>個の数値<code class="docutils literal notranslate"><span class="pre">x</span></code>に対して、目的変数の推定値<code class="docutils literal notranslate"><span class="pre">y_hat</span></code>を求めるため、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression.predict">predict</a>関数を呼び出し、回帰曲線を描画する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_70_0.png" src="../_images/02mra_70_0.png" />
</div>
</div>
</section>
</section>
<section id="id19">
<h2><span class="section-number">2.10. </span>確認問題<a class="headerlink" href="#id19" title="この見出しへのパーマリンク">#</a></h2>
<p>データ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>に対して多項式のフィッティングを行いたい。以下の処理を行うプログラムを作成せよ。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>なお、NumPy, SciPy, scikit-learn, statsmodel等のライブラリには回帰分析を行う便利な関数として以下のようなものがあるが、ここでは使わずに講義中で説明した式をプログラムとして表現すること。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.polyfit.html">np.polyfit</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.polynomial.polynomial.Polynomial.fit.html#numpy.polynomial.polynomial.Polynomial.fit">np.polynomial.polynomial.Polynomial.fit</a></p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.lstsq.html">scipy.linalg.lstsq</a>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">scipy.optimize.curve_fit</a>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.linregress.html">scipy.stats.linregress</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">sklearn.linear_model.LinearRegression</a></p></li>
<li><p><a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.OLS.html#statsmodels.regression.linear_model.OLS">statsmodels.regression.linear_model.OLS</a></p></li>
</ul>
<p><strong>(1) 行列による1次関数のパラメータ推定</strong></p>
<p><span class="math notranslate nohighlight">\(y = w_0 + w_1 x\)</span>とおき、学習データ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>上の平均二乗残差を最小にする<span class="math notranslate nohighlight">\(\bm{w} = \begin{pmatrix}
w_0 \\
w_1
\end{pmatrix}\)</span>を行列演算により求めよ。</p>
<p><strong>(2) ２次関数による重回帰</strong></p>
<p><span class="math notranslate nohighlight">\(y = w_0 + w_1 x + w_2 x^2\)</span>とおき、重回帰により平均二乗残差を最小にする<span class="math notranslate nohighlight">\(\bm{w} = \begin{pmatrix}
w_0 \\
w_1 \\
w_2
\end{pmatrix}\)</span>を求めよ。</p>
<p><strong>(3) 回帰曲線の描画</strong></p>
<p>回帰で求めた2次関数をデータ点とともにグラフに描け。</p>
<p><strong>(4) 決定係数</strong></p>
<p>回帰で得られた2次関数の決定係数（<span class="math notranslate nohighlight">\(R^2\)</span>）を求めよ。</p>
<p><strong>(5) 3次関数による重回帰</strong></p>
<p><span class="math notranslate nohighlight">\(y = w_0 + w_1 x + w_2 x^2 + w_3 x^3\)</span>とおき、重回帰により平均二乗残差を最小にする<span class="math notranslate nohighlight">\(\bm{w} = \begin{pmatrix}
w_0 \\
w_1 \\
w_2 \\
w_3
\end{pmatrix}\)</span>を求めよ。</p>
<p><strong>(6) 回帰曲線の描画</strong></p>
<p>回帰で求めた3次関数をデータ点とともにグラフに描け</p>
<p><strong>(7) 決定係数</strong></p>
<p>回帰で求めた3次関数の決定係数（<span class="math notranslate nohighlight">\(R^2\)</span>）を求めよ</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "chokkan/mlnote",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./regression"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01sra.html" title="前へ ページ">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">前へ</p>
            <p class="prev-next-title"><span class="section-number">1. </span>単回帰</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03regularization.html" title="次へ ページ">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">次へ</p>
        <p class="prev-next-title"><span class="section-number">3. </span>モデル選択と正則化</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    <div class="extra_footer">
      © Copyright 2020-2022 by 岡崎 直観 (Naoaki Okazaki). この作品は<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">クリエイティブ・コモンズ 表示 - 非営利 - 改変禁止 4.0 国際 ライセンス</a>の下に提供されています。 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>　ただし、作品中のコードセル部分は<a rel="license" href="https://opensource.org/licenses/MIT">MITライセンス</a>の下に提供されています。

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>