
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. 重回帰 &#8212; 機械学習帳</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://chokkan.github.io/mlnote/regression/02mra.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="3. モデル選択と正則化" href="03regularization.html" />
    <link rel="prev" title="1. 単回帰" href="01sra.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="ja">
    

    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@chokkanorg">
    <meta name="twitter:title" content="機械学習帳">
    <meta name="twitter:description" content="機械学習帳は、機械学習を学ぶためのノート（帳）を、デジタル（機械）による新しいカタチの学習帳として実現することを目指しています。">
    <meta name="twitter:image" content="https://chokkan.github.io/mlnote/_static/mlnote.png">

    <!-- Google Analytics -->

    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5R9M0GR7MW"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-5R9M0GR7MW');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">機械学習帳</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  回帰
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01sra.html">
   1. 単回帰
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. 重回帰
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03regularization.html">
   3. モデル選択と正則化
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04sgd.html">
   4. 勾配法によるパラメータ推定
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  分類
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/01binary.html">
   5. 線形二値分類
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/02multi.html">
   6. 線形多クラス分類
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/03nn.html">
   7. ニューラルネットワーク (1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/04nntrain.html">
   8. ニューラルネットワーク (2)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../classification/05svm.html">
   9. サポートベクトルマシン
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  教師無し学習
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/01kmeans.html">
   10. 非階層的クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/02hac.html">
   11. 階層的クラスタリング
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/03pca.html">
   12. 主成分分析 (1)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../unsupervised/04pca2.html">
   13. 主成分分析 (2)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  付録
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notation.html">
   表記
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../reference.html">
   参考文献・謝辞
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/chokkan/mlnote/main?urlpath=lab/tree/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/chokkan/mlnote/blob/main/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>

<span class="headerbtn__text-container">Colab</span>
</a>

      </li>

      <li>
        <a href="https://studiolab.sagemaker.aws/import/github/chokkan/mlnote/blob/main/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on SageMaker Studio Lab"
>

<span class="headerbtn__icon-container">
  <i class="fab fa-aws"></i>
</span>
<span class="headerbtn__text-container">SageMaker</span>

</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/chokkan/mlnote"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/chokkan/mlnote/issues/new?title=Issue%20on%20page%20%2Fregression/02mra.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/regression/02mra.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   2.1. 重回帰
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   2.2. 表記法の定義
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     2.2.1. 単回帰を表現する
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   2.3. 目的関数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mra-minimization">
   2.4. 目的関数の最小化
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   2.5. 目的関数の微分（別の導出）
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   2.6. 目的関数は凸関数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id9">
   2.7. 重回帰の性質
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     2.7.1. 残差の和および平均は
     <span class="math notranslate nohighlight">
      \(0\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hat-y-y">
     2.7.2. 目的変数の推定値
     <span class="math notranslate nohighlight">
      \(\hat{y}\)
     </span>
     の平均値は観測値
     <span class="math notranslate nohighlight">
      \(y\)
     </span>
     の平均に等しい
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     2.7.3. 観測データの重心は回帰平面上に存在する
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     2.7.4. 各説明変数と残差には相関がない
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     2.7.5. 目的変数の推定値と残差には相関がない
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id15">
   2.8. 決定係数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id16">
   2.9. 重回帰の実施例
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy-polynomial">
     2.9.1. numpy.polynomialを用いる例
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
     2.9.2. sklearn.linear_model.LinearRegressionを用いる例
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   2.10. 確認問題
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>重回帰</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   2.1. 重回帰
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   2.2. 表記法の定義
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     2.2.1. 単回帰を表現する
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   2.3. 目的関数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mra-minimization">
   2.4. 目的関数の最小化
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   2.5. 目的関数の微分（別の導出）
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   2.6. 目的関数は凸関数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id9">
   2.7. 重回帰の性質
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id11">
     2.7.1. 残差の和および平均は
     <span class="math notranslate nohighlight">
      \(0\)
     </span>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hat-y-y">
     2.7.2. 目的変数の推定値
     <span class="math notranslate nohighlight">
      \(\hat{y}\)
     </span>
     の平均値は観測値
     <span class="math notranslate nohighlight">
      \(y\)
     </span>
     の平均に等しい
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     2.7.3. 観測データの重心は回帰平面上に存在する
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     2.7.4. 各説明変数と残差には相関がない
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     2.7.5. 目的変数の推定値と残差には相関がない
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id15">
   2.8. 決定係数
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id16">
   2.9. 重回帰の実施例
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numpy-polynomial">
     2.9.1. numpy.polynomialを用いる例
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-linear-model-linearregression">
     2.9.2. sklearn.linear_model.LinearRegressionを用いる例
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id17">
   2.10. 確認問題
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1><span class="section-number">2. </span>重回帰<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">#</a></h1>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install japanize-matplotlib
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: japanize-matplotlib in /home/okazaki/.local/lib/python3.8/site-packages (1.1.3)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (from japanize-matplotlib) (3.5.1)
Requirement already satisfied: numpy&gt;=1.17 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (1.22.2)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (4.29.1)
Requirement already satisfied: python-dateutil&gt;=2.7 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (2.8.2)
Requirement already satisfied: pyparsing&gt;=2.2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (3.0.7)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (1.3.2)
Requirement already satisfied: pillow&gt;=6.2.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (9.0.1)
Requirement already satisfied: packaging&gt;=20.0 in /usr/local/lib/python3.8/dist-packages (from matplotlib-&gt;japanize-matplotlib) (21.3)
Requirement already satisfied: six&gt;=1.5 in /usr/lib/python3/dist-packages (from python-dateutil&gt;=2.7-&gt;matplotlib-&gt;japanize-matplotlib) (1.14.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">japanize_matplotlib</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h2><span class="section-number">2.1. </span>重回帰<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>これまで、以下のデータ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>を例として単回帰を説明した。</p>
<div class="amsmath math notranslate nohighlight" id="equation-36fefe80-391c-4666-b34e-8021a5b6aa1d">
<span class="eqno">(2.1)<a class="headerlink" href="#equation-36fefe80-391c-4666-b34e-8021a5b6aa1d" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathcal{D}_s = \left\{(x_i, y_i)\right\}_{i=1}^{4} = \left\{(1, 3), (3, 6), (6, 5), (8, 7)\right\}
\end{align}\]</div>
<p>また、求めた回帰直線をデータ点とともにプロットしたものを以下に示す。</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.431</span><span class="p">,</span> <span class="mf">3.310</span> 
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">D</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">D</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;tab:red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">x + </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">row</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">),</span> <span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_4_0.png" src="../_images/02mra_4_0.png" />
</div>
</div>
<p>残差の平均二乗和が最小になるような直線を引いたはずであるが、残差を完全に無くすことはできなかった（決定係数を求めてみると<span class="math notranslate nohighlight">\(0.616\)</span>であり、あまり高くない）。プロットされている点を眺めると、３次関数を当てはめる方が向いているように思われる。そこで、１次関数よりも表現力が高いモデルとして、<span class="math notranslate nohighlight">\(d\)</span>次の多項式の一般形、</p>
<div class="amsmath math notranslate nohighlight" id="equation-5c9926dd-65fc-4b77-9ec1-3e3169bd2301">
<span class="eqno">(2.2)<a class="headerlink" href="#equation-5c9926dd-65fc-4b77-9ec1-3e3169bd2301" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = w_0 + w_1 x + w_2 x^2 + \dots + w_d x^d
\end{align}\]</div>
<p>にフィッティングすることを考えたい。ここで、<span class="math notranslate nohighlight">\(w_0, w_1, w_2, \dots, w_d \in \mathbb{R}\)</span>はモデルの<strong>パラメータ</strong>である。</p>
<p>なお、<span class="math notranslate nohighlight">\(\hat{y}\)</span>は重み<span class="math notranslate nohighlight">\(w_0, w_1, w_2, \dots, w_d\)</span>による説明変数<span class="math notranslate nohighlight">\(1, x, x^2, \dots x^d\)</span>の線形重み付き和と考えることができる。このモデルは多項式の一般形ではあるが、<span class="math notranslate nohighlight">\(\hat{y}\)</span>は<span class="math notranslate nohighlight">\(w_i\)</span>と<span class="math notranslate nohighlight">\(x^i\)</span>の線形結合で表されているため、<strong>線形モデル</strong>と見なすことができる。ただし、説明変数が２個以上であるので、単回帰を重回帰に拡張する必要がある。</p>
<p>一般的に、<span class="math notranslate nohighlight">\(d\)</span>個の説明変数<span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_d\)</span>に対して、線形モデル、すなわち<span class="math notranslate nohighlight">\(d\)</span>個の重み<span class="math notranslate nohighlight">\(w_1, w_2, \dots, w_d\)</span>の線形結合で目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}\)</span>を計算することを<strong>線形回帰</strong>と呼ぶ。</p>
<div class="amsmath math notranslate nohighlight" id="equation-ccab9160-451d-40c7-99f6-cbcd5b9353f3">
<span class="eqno">(2.3)<a class="headerlink" href="#equation-ccab9160-451d-40c7-99f6-cbcd5b9353f3" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = w_1 x_1 + w_2 x_2 + \dots + w_d x_d
\end{align}\]</div>
<p>ゆえに、<span class="math notranslate nohighlight">\((d-1)\)</span>次の多項式へのフィッティングは、<span class="math notranslate nohighlight">\(d\)</span>個の説明変数<span class="math notranslate nohighlight">\(x_1 = 1\)</span>, <span class="math notranslate nohighlight">\(x_2 = x\)</span>, <span class="math notranslate nohighlight">\(x_3 = x^2\)</span>, <span class="math notranslate nohighlight">\(\dots\)</span>, <span class="math notranslate nohighlight">\(x_d = x^{d-1}\)</span>による線形回帰と見なすことができる。下図は、重回帰でデータ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>に３次関数を当てはめた結果である。本章の内容をマスターすると、<span class="math notranslate nohighlight">\(4\)</span>個の説明変数<span class="math notranslate nohighlight">\(1, x, x^2, x^3\)</span>に対して、その重み（<span class="math notranslate nohighlight">\(-1.23, 5.41, -1.27, 0.09\)</span>）を求めることができる。</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">0.431</span><span class="p">,</span> <span class="mf">3.310</span> 
<span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">D</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">D</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.09</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">-</span> <span class="mf">1.27</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">5.41</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.23</span><span class="p">,</span> <span class="s1">&#39;tab:red&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$0.09 x^3 - 1.27 x^2 + 5.41 x - 1.23$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_6_0.png" src="../_images/02mra_6_0.png" />
</div>
</div>
<p>回帰分析において、説明変数を何個用意するか、それぞれの説明変数をどのように定義するかは任意である。たとえば、東京におけるアイスクリームへの支出額を予測するために、最高気温だけでなく、予測したい月の数字やアイスクリームの平均価格も有力な説明変数になり得るかもしれない。また、最高気温の平方根や、最高気温と月の積など、元の説明変数に非線形変換を適用した説明変数を導入してもよい。分析者が非線形変換の方法を明示的に設計する必要があるが、説明変数の組み合わせを考慮した非線形な回帰分析も、線形回帰の枠組みで行うことができる。</p>
<p><img alt="non-linear" src="../_images/non-linear.png" /></p>
</div>
<div class="section" id="id3">
<h2><span class="section-number">2.2. </span>表記法の定義<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">#</a></h2>
<div class="margin sidebar">
<p class="sidebar-title">ベクトル</p>
<p>この資料では、ベクトルを小文字の太字で表す。特に断りがない限り、ベクトルは要素を縦に並べた<strong>列ベクトル</strong>であるとする。例えば、<span class="math notranslate nohighlight">\(1, 0, -1\)</span>を要素とする<span class="math notranslate nohighlight">\(3\)</span>次元ベクトル<span class="math notranslate nohighlight">\(\pmb{v} \in \mathbb{R}^3\)</span>を、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\pmb{v} = \begin{pmatrix}1 \\ 0 \\ -1\end{pmatrix}
\end{split}\]</div>
<p>と書く。なお、横書きの文書で列ベクトルを書くとスペースを消費してしまうので、転置の演算子（<span class="math notranslate nohighlight">\(\top\)</span>）を用いて、</p>
<div class="math notranslate nohighlight">
\[
\pmb{v} = \begin{pmatrix}1 &amp; 0 &amp; -1\end{pmatrix}^\top
\]</div>
<p>と書くことがある。</p>
</div>
<p>重回帰の目的関数を一般的に記述するため、ベクトルによる表記を導入する。<span class="math notranslate nohighlight">\(d\)</span>個の説明変数<span class="math notranslate nohighlight">\(x_1, x_2, \dots, x_d\)</span>をベクトル<span class="math notranslate nohighlight">\(\pmb{x} \in \mathbb{R}^d\)</span>でまとめて表現する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-dd76d441-305e-4911-bdbf-7c1733d494b6">
<span class="eqno">(2.4)<a class="headerlink" href="#equation-dd76d441-305e-4911-bdbf-7c1733d494b6" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{x} = \begin{pmatrix}
x_1 \\ x_2 \\ \vdots \\ x_d
\end{pmatrix}
\end{align}\]</div>
<p>また、<span class="math notranslate nohighlight">\(d\)</span>個のパラメータ（重み）<span class="math notranslate nohighlight">\(w_1, w_2, \dots, w_d\)</span>をベクトル<span class="math notranslate nohighlight">\(\pmb{w} \in \mathbb{R}^d\)</span>でまとめて表現する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-14198529-c69d-4be6-930a-052d6085c844">
<span class="eqno">(2.5)<a class="headerlink" href="#equation-14198529-c69d-4be6-930a-052d6085c844" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{w} = \begin{pmatrix}
w_1 \\ w_2 \\ \vdots \\ w_d
\end{pmatrix}
\end{align}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">ベクトルの内積</p>
<p><span class="math notranslate nohighlight">\(d\)</span>次元ベクトル、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{u} &amp;= \begin{pmatrix}u_1 &amp; u_2 &amp; \dots &amp; u_d\end{pmatrix}^\top \\
\pmb{v} &amp;= \begin{pmatrix}v_1 &amp; v_2 &amp; \dots &amp; v_d\end{pmatrix}^\top
\end{align*}\]</div>
<p>があるとき、その内積は、</p>
<div class="math notranslate nohighlight">
\[
\pmb{u} \cdot \pmb{v} = u_1 v_1 + u_2 v_2 + \dots + u_d v_d
\]</div>
<p>である。これは、転置を使って、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{u} \cdot \pmb{v} &amp;= \pmb{u}^\top \pmb{v} \\
&amp;= \begin{pmatrix}u_1 &amp; u_2 &amp; \dots &amp; u_d\end{pmatrix} \begin{pmatrix}v_1 \\ v_2 \\ \dots \\ v_d\end{pmatrix}
\end{align*}\]</div>
<p>と書ける。</p>
</div>
<p>すると、重回帰モデルによる目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}\)</span>は、ベクトル<span class="math notranslate nohighlight">\(\pmb{x}\)</span>と<span class="math notranslate nohighlight">\(\pmb{w}\)</span>の内積として記述できる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-7f35f307-87c9-4508-a5c6-be686c08da70">
<span class="eqno">(2.6)<a class="headerlink" href="#equation-7f35f307-87c9-4508-a5c6-be686c08da70" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = \pmb{x}^\top\pmb{w} = w_1 x_1 + w_2 x_2 + \dots + w_d x_d
\end{align}\]</div>
<p>単回帰のときと同様に、説明変数と目的変数の組を<strong>事例</strong>として表現する。単回帰の場合と異なるのは、説明変数がスカラー<span class="math notranslate nohighlight">\(x\)</span>からベクトル<span class="math notranslate nohighlight">\(\pmb{x}\)</span>に拡張されたことである。
<span class="math notranslate nohighlight">\(1\)</span>番目の事例を<span class="math notranslate nohighlight">\((\pmb{x}_1, y_1)\)</span>、<span class="math notranslate nohighlight">\(2\)</span>番目の事例を<span class="math notranslate nohighlight">\((\pmb{x}_2, y_2)\)</span>、<span class="math notranslate nohighlight">\(i\)</span>番目の事例を<span class="math notranslate nohighlight">\((\pmb{x}_i, y_i)\)</span>と表すことにすると、<span class="math notranslate nohighlight">\(N\)</span>個の事例からなるデータ<span class="math notranslate nohighlight">\(\mathcal{D}\)</span>は次のように表される。</p>
<div class="amsmath math notranslate nohighlight" id="equation-35104f3c-195f-43f8-ba9b-489aa3d11919">
<span class="eqno">(2.7)<a class="headerlink" href="#equation-35104f3c-195f-43f8-ba9b-489aa3d11919" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathcal{D} = \left\{(\pmb{x}_1, y_1), (\pmb{x}_2, y_2), \dots, (\pmb{x}_N, y_N)\right\} = \left\{(\pmb{x}_i, y_i)\right\}_{i=1}^{N}
\end{align}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">行列</p>
<p>この資料では、行列を大文字の太字で表す。<span class="math notranslate nohighlight">\(\pmb{X}\)</span>が実数値を要素とする<span class="math notranslate nohighlight">\(N\)</span>行<span class="math notranslate nohighlight">\(M\)</span>列の行列（<span class="math notranslate nohighlight">\(N \times M\)</span>の行列とも呼ばれる）であることを、<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{N \times M}\)</span>と書く。行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の<span class="math notranslate nohighlight">\(i\)</span>行<span class="math notranslate nohighlight">\(j\)</span>列の要素を<span class="math notranslate nohighlight">\(X_{i,j}\)</span>と表現する。</p>
<p>例えば、<span class="math notranslate nohighlight">\(2 \times 3\)</span>の行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>に関して、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{X} = \begin{pmatrix}
1 &amp; 3 &amp; 5 \\
6 &amp; 4 &amp; 2 \\
\end{pmatrix}
\end{align*}\]</div>
<p><span class="math notranslate nohighlight">\(X_{1,2} = 3\)</span>、<span class="math notranslate nohighlight">\(X_{2,3} = 2\)</span>である。</p>
</div>
<p>さらに、<span class="math notranslate nohighlight">\(N\)</span>個の事例や目的変数を行列やベクトルで記述する表記法も導入しておく。説明変数のベクトル<span class="math notranslate nohighlight">\(\pmb{x}_i\)</span>を行ベクトルとして縦に<span class="math notranslate nohighlight">\(N\)</span>個並べた行列<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{N \times d}\)</span>を定義する。この行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>は<strong>計画行列</strong>（design matrix）と呼ばれ、それぞれの事例の<span class="math notranslate nohighlight">\(d\)</span>個の説明変数を水平方向に<span class="math notranslate nohighlight">\(d\)</span>個並べ、<span class="math notranslate nohighlight">\(N\)</span>個の事例を垂直方向に<span class="math notranslate nohighlight">\(N\)</span>個並べたものである。</p>
<div class="amsmath math notranslate nohighlight" id="equation-64c54bfb-4c01-45af-b7c2-e5038d45786f">
<span class="eqno">(2.8)<a class="headerlink" href="#equation-64c54bfb-4c01-45af-b7c2-e5038d45786f" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{X} = \begin{pmatrix}
\pmb{x}_1^\top \\
\pmb{x}_2^\top \\
\vdots \\
\pmb{x}_N^\top \\
\end{pmatrix}
= \begin{pmatrix}
X_{1,1} &amp; X_{1,2} &amp; \dots &amp; X_{1,d} \\
X_{2,1} &amp; X_{2,2} &amp; \dots &amp; X_{2,d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{N,1} &amp; X_{N,2} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\end{align}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(X_{i,j}\)</span>は行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の<span class="math notranslate nohighlight">\(i\)</span>行<span class="math notranslate nohighlight">\(j\)</span>列の要素を表す。</p>
<p>また、目的変数<span class="math notranslate nohighlight">\(y_i\)</span>を縦に<span class="math notranslate nohighlight">\(N\)</span>個並べたベクトル<span class="math notranslate nohighlight">\(\pmb{y} \in \mathbb{R}^N\)</span>を定義する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-f51a8465-65d3-41b2-9f09-d495c49d1955">
<span class="eqno">(2.9)<a class="headerlink" href="#equation-f51a8465-65d3-41b2-9f09-d495c49d1955" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{y} = \begin{pmatrix}
y_1 \\ y_2 \\ \vdots \\ y_N
\end{pmatrix}
\end{align}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">行列・ベクトル積</p>
<p><span class="math notranslate nohighlight">\(N \times d\)</span>の行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>と<span class="math notranslate nohighlight">\(d\)</span>行のベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>の積を計算した結果は、<span class="math notranslate nohighlight">\(N\)</span>行のベクトルとなる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp; \pmb{X}\pmb{w} \\
&amp;= \begin{pmatrix}
X_{1,1} &amp; \dots &amp; X_{1,d} \\
\dots &amp; \dots &amp; \dots \\
X_{N,1} &amp; \dots &amp; X_{N,d} \\
\end{pmatrix}
\begin{pmatrix}
w_1 \\ \dots \\ w_d
\end{pmatrix} \\
&amp;= \begin{pmatrix}
X_{1,1} w_1 + \dots + X_{1,d} w_d \\
\dots \\
X_{N,1} w_1 + \dots + X_{N,d} w_d \\
\end{pmatrix}
\end{align*}\]</div>
<p>例えば、<span class="math notranslate nohighlight">\(2 \times 3\)</span>の行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>と<span class="math notranslate nohighlight">\(3\)</span>行のベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>があるとき、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{X} = \begin{pmatrix}
1 &amp; 3 &amp; 5 \\
6 &amp; 4 &amp; 2 \\
\end{pmatrix}, 
\pmb{w} = \begin{pmatrix}
2 \\
-2 \\
3\\
\end{pmatrix}
\end{align*}\]</div>
<p>行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>とベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>の積は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{X}\pmb{w}
&amp;= \begin{pmatrix}
1 &amp; 3 &amp; 5 \\
6 &amp; 4 &amp; 2 \\
\end{pmatrix} \begin{pmatrix}
2 \\
-2 \\
3\\
\end{pmatrix} \\
&amp;= \begin{pmatrix}
1 \times 2 + 3 \times (-2) + 5 \times 3 \\
6 \times 2 + 4 \times (-2) + 2 \times 3 \\
\end{pmatrix} \\
&amp;= \begin{pmatrix}
11 \\
10 \\
\end{pmatrix}
\end{align*}\]</div>
</div>
<p>目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}_i\)</span>を縦に<span class="math notranslate nohighlight">\(N\)</span>個並べ、ベクトル<span class="math notranslate nohighlight">\(\hat{\pmb{y}} \in \mathbb{R}^N\)</span>と書くことにすると、その予測値は計画行列とパラメータベクトルの積で求めることができる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-64f7df0b-51f0-4fda-8e70-c6c5b1e32b4a">
<span class="eqno">(2.10)<a class="headerlink" href="#equation-64f7df0b-51f0-4fda-8e70-c6c5b1e32b4a" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{\pmb{y}} = \begin{pmatrix}
\hat{y}_1 \\ \hat{y}_2 \\ \vdots \\ \hat{y}_N
\end{pmatrix} = \begin{pmatrix}
\pmb{x}_1^\top \pmb{w} \\ \pmb{x}_2^\top \pmb{w} \\ \vdots \\ \pmb{x}_N^\top \pmb{w}
\end{pmatrix}
= \pmb{X} \pmb{w}
\end{align}\]</div>
<div class="section" id="id4">
<h3><span class="section-number">2.2.1. </span>単回帰を表現する<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">#</a></h3>
<p>これまでに定義した表記法で単回帰を記述できることを確認しておこう。<span class="math notranslate nohighlight">\(d=2\)</span>として説明変数とパラメータベクトルを以下のように定義する。</p>
<div class="math notranslate nohighlight" id="equation-eq-simple-linear-regression">
<span class="eqno">(2.11)<a class="headerlink" href="#equation-eq-simple-linear-regression" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\pmb{x} = \begin{pmatrix}
1 \\ x
\end{pmatrix},
\pmb{w} = \begin{pmatrix}
b \\ a
\end{pmatrix}
\end{align}
\end{split}\]</div>
<p>目的変数の予測値<span class="math notranslate nohighlight">\(\hat{y}\)</span>を計算する式を展開すると、単回帰モデルが得られる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-b8953691-e188-4a6d-a222-3671bed1d261">
<span class="eqno">(2.12)<a class="headerlink" href="#equation-b8953691-e188-4a6d-a222-3671bed1d261" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{y} = \pmb{x}^\top\pmb{w} = b + xa = ax + b
\end{align}\]</div>
<p>冒頭のグラフの例（<span class="math notranslate nohighlight">\(N=4\)</span>）の学習データは次のように表現される。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\mathcal{D}_s = \left\{(\pmb{x}_i, y_i)\right\}_{i=1}^{4} = \left\{\left(\begin{pmatrix}1 &amp; 1\end{pmatrix}^\top, 3\right), \left(\begin{pmatrix}1 &amp; 3\end{pmatrix}^\top, 6\right), \left(\begin{pmatrix}1 &amp; 6\end{pmatrix}^\top, 5\right), \left(\begin{pmatrix}1 &amp; 8\end{pmatrix}^\top, 7\right)\right\}
\end{align*}\]</div>
<p>計画行列<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{4 \times 2}\)</span>と目的変数ベクトル<span class="math notranslate nohighlight">\(\pmb{y} \in \mathbb{R}^4\)</span>は、それぞれ、</p>
<div class="amsmath math notranslate nohighlight" id="equation-fd06f33c-47f7-49c2-a413-00ac6d5c1be6">
<span class="eqno">(2.13)<a class="headerlink" href="#equation-fd06f33c-47f7-49c2-a413-00ac6d5c1be6" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{X} = \begin{pmatrix}
1 &amp; 1 \\
1 &amp; 3 \\
1 &amp; 6 \\
1 &amp; 8
\end{pmatrix},
\pmb{y} = \begin{pmatrix}
3 \\ 6 \\ 5 \\ 7
\end{pmatrix}
\end{align}\]</div>
<p>目的変数の予測ベクトル<span class="math notranslate nohighlight">\(\hat{\pmb{y}}\)</span>は行列<span class="math notranslate nohighlight">\(W\)</span>とベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>の積で求めることができる。</p>
<div class="amsmath math notranslate nohighlight" id="equation-8824a223-cf09-434a-9dc3-d7288096b6ad">
<span class="eqno">(2.14)<a class="headerlink" href="#equation-8824a223-cf09-434a-9dc3-d7288096b6ad" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{\pmb{y}}
= \pmb{X} \pmb{w}
= \begin{pmatrix}
1 &amp; 1 \\
1 &amp; 3 \\
1 &amp; 6 \\
1 &amp; 8
\end{pmatrix}
\begin{pmatrix}
b \\ a
\end{pmatrix}
= \begin{pmatrix}
a + b \\
3a + b \\
6a + b \\
8a + b 
\end{pmatrix}
\end{align}\]</div>
</div>
</div>
<div class="section" id="id5">
<h2><span class="section-number">2.3. </span>目的関数<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>単回帰のときと同様に、ある事例の目的変数の真の値<span class="math notranslate nohighlight">\(y_i\)</span>と推定値<span class="math notranslate nohighlight">\(\hat{y}_i\)</span>の差を残差<span class="math notranslate nohighlight">\(\epsilon_i\)</span>とする。</p>
<div class="amsmath math notranslate nohighlight" id="equation-5e50811f-f15c-42bc-8c82-53b987a9c19b">
<span class="eqno">(2.15)<a class="headerlink" href="#equation-5e50811f-f15c-42bc-8c82-53b987a9c19b" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\epsilon_i = y_i - \hat{y}_i = y_i - \pmb{x}_i^\top\pmb{w}
\end{align}\]</div>
<p>学習データにおける平均二乗残差は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-812c6816-08c3-4bb4-9f77-7a841082c59c">
<span class="eqno">(2.16)<a class="headerlink" href="#equation-812c6816-08c3-4bb4-9f77-7a841082c59c" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{L} = \frac{1}{N} \sum_{i=1}^{N} \epsilon_i^2 = \frac{1}{N} \sum_{i=1}^{N} (y_i - \hat{y}_i)^2 = \frac{1}{N} \sum_{i=1}^{N} (y_i - \pmb{x}_i^\top\pmb{w})^2
\end{align}\]</div>
<p>重回帰モデルの学習において平均二乗残差を最小化するときは、学習データ<span class="math notranslate nohighlight">\(\mathcal{D}\)</span>や学習事例数<span class="math notranslate nohighlight">\(N\)</span>は事前に与えられる定数であり、パラメータ<span class="math notranslate nohighlight">\(\pmb{w}\)</span>は変数である。したがって、<span class="math notranslate nohighlight">\(N\)</span>は最小化の解に影響を与えないので（二乗残差の平均を最小化することと二乗残差の和を最小化することは同じ）、今後は目的関数に含めないことにする。すると、重回帰で最小化したい目的関数は、</p>
<div class="math notranslate nohighlight">
\[
\begin{align}
\hat{L}_{\mathcal{D}}(\pmb{w}) = \sum_{i=1}^{N} (y_i - \pmb{x}_i^\top\pmb{w})^2
\end{align}
\]</div>
<p>なお、全事例に関する残差をベクトル、</p>
<div class="amsmath math notranslate nohighlight" id="equation-139c39e6-b9af-434a-bfcf-721146e0aa76">
<span class="eqno">(2.17)<a class="headerlink" href="#equation-139c39e6-b9af-434a-bfcf-721146e0aa76" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{\epsilon} = \begin{pmatrix}
\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_N
\end{pmatrix}
\end{align}\]</div>
<p>で表すことにすると、</p>
<div class="math notranslate nohighlight" id="equation-eq-mra-epsilon">
<span class="eqno">(2.18)<a class="headerlink" href="#equation-eq-mra-epsilon" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\pmb{\epsilon} = \pmb{y} - \hat{\pmb{y}} = \pmb{y} - \pmb{X}\pmb{w}
\end{align}
\]</div>
<p>である。</p>
<div class="margin sidebar">
<p class="sidebar-title">ベクトルの<span class="math notranslate nohighlight">\(L_2\)</span>ノルム</p>
<p><span class="math notranslate nohighlight">\(d\)</span>次元ベクトル、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{v} &amp;= \begin{pmatrix}v_1 &amp; v_2 &amp; \dots &amp; v_d\end{pmatrix}^\top
\end{align*}\]</div>
<p>があるとき、その<span class="math notranslate nohighlight">\(L_2\)</span>ノルム<span class="math notranslate nohighlight">\(\lVert \pmb{v} \rVert\)</span>は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lVert \pmb{v} \rVert &amp;= \sqrt{\pmb{v}^\top \pmb{v}} \\
&amp;= \sqrt{v_1^2 + v_2^2 + \dots + v_d^2}
\end{align*}\]</div>
<p>と計算される。</p>
</div>
<p>以上まとめると、重回帰で最小化したい目的関数は、</p>
<div class="important admonition">
<p class="admonition-title">重回帰の目的関数（二乗残差和）</p>
<div class="math notranslate nohighlight" id="equation-eq-objective-function">
<span class="eqno">(2.19)<a class="headerlink" href="#equation-eq-objective-function" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\hat{L}_{\mathcal{D}}(\pmb{w}) = \lVert \pmb{\epsilon} \rVert^2 = \lVert \pmb{y} - \pmb{X}\pmb{w} \rVert^2 = \sum_{i=1}^{N} (y_i - \pmb{x}_i^\top\pmb{w})^2
\end{align}
\]</div>
</div>
<p>と表現できる。</p>
</div>
<div class="section" id="mra-minimization">
<span id="id6"></span><h2><span class="section-number">2.4. </span>目的関数の最小化<a class="headerlink" href="#mra-minimization" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>目的関数<span class="math notranslate nohighlight">\(\hat{L}_{\mathcal{D}}(\pmb{w})\)</span>を最小にするパラメータのベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>を求めるため、式<a class="reference internal" href="#equation-eq-objective-function">(2.19)</a>をあるパラメータ<span class="math notranslate nohighlight">\(w_j\)</span>で偏微分する（<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>はパラメータのインデックスである）。</p>
<div class="margin sidebar">
<p class="sidebar-title">行列の行ベクトル</p>
<p>行列<span class="math notranslate nohighlight">\(\pmb{X} \in \mathbb{R}^{N \times d}\)</span>に対して、その<span class="math notranslate nohighlight">\(j\)</span>行目の要素を横に並べたベクトルを<strong>行ベクトル</strong>と呼び、<span class="math notranslate nohighlight">\(\pmb{X}_j\)</span>で表す。<span class="math notranslate nohighlight">\(\pmb{X}_j \in \mathbb{R}^{1 \times d}\)</span>である。</p>
</div>
<div class="math notranslate nohighlight" id="equation-eq-mra-grad-wj">
<span class="eqno">(2.20)<a class="headerlink" href="#equation-eq-mra-grad-wj" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\frac{\partial \hat{L}_{\mathcal{D}}(\pmb{w})}{\partial w_j}
&amp;= \sum_{i=1}^N 2 \cdot \underbrace{(y_i - \pmb{x}_i^\top\pmb{w})}_{=\epsilon_i} \cdot \{-\underbrace{(\pmb{x}_i)_j}_{=X_{i,j}}\} \\
&amp;= -2 \sum_{i=1}^N  X_{i,j} \epsilon_i \\
&amp;= -2 \begin{pmatrix}
X_{1,j} &amp;
X_{2,j} &amp;
\dots &amp;
X_{N,j} 
\end{pmatrix} \begin{pmatrix}
\epsilon_1 \\
\epsilon_2 \\
\vdots \\
\epsilon_N
\end{pmatrix} \\
&amp;= -2 (\pmb{X}^\top)_j \pmb{\epsilon} \\
&amp;= -2 (\pmb{X}^\top \pmb{\epsilon})_j
\end{align}
\end{split}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">ベクトルの微分</p>
<p>本資料ではベクトルの微分に分母レイアウト表記（<a class="reference external" href="https://en.wikipedia.org/wiki/Matrix_calculus#Denominator-layout_notation">Denominator-layout notation</a>）を採用する。二つのベクトル<span class="math notranslate nohighlight">\(\pmb{x} \in \mathbb{R}^m, \pmb{y} \in \mathbb{R}^n\)</span>があるとき、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{\partial \pmb{y}}{\partial \pmb{x}} = \begin{pmatrix}
\frac{\partial y_1}{\partial x_1} &amp; \frac{\partial y_2}{\partial x_1} &amp; \ldots &amp; \frac{\partial y_n}{\partial x_1} \\
\frac{\partial y_1}{\partial x_2} &amp; \frac{\partial y_2}{\partial x_2} &amp; \ldots &amp; \frac{\partial y_n}{\partial x_2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\frac{\partial y_1}{\partial x_m} &amp; \frac{\partial y_2}{\partial x_m} &amp; \ldots &amp; \frac{\partial y_n}{\partial x_m} \\
\end{pmatrix}
\end{split}\]</div>
<p>もし、<span class="math notranslate nohighlight">\(y\)</span>がスカラーであるならば、</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{\partial y}{\partial \pmb{x}} = \begin{pmatrix}
\frac{\partial y}{\partial x_1} \\
\frac{\partial y}{\partial x_2} \\
\vdots \\
\frac{\partial y}{\partial x_m} \\
\end{pmatrix}
\end{split}\]</div>
<p>もし、<span class="math notranslate nohighlight">\(x\)</span>がスカラーであるならば、</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \pmb{y}}{\partial x} = \begin{pmatrix}
\frac{\partial y_1}{\partial x} &amp; \frac{\partial y_2}{\partial x} &amp; \ldots &amp; \frac{\partial y_n}{\partial x}
\end{pmatrix}
\]</div>
<p>したがって、分母側のベクトルのレイアウトはそのまま、分子側のベクトルのレイアウトは転置が適用される。</p>
</div>
<p>なお、最後から２番目の式変形は、計画行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の転置<span class="math notranslate nohighlight">\(\pmb{X}^\top\)</span>、</p>
<div class="amsmath math notranslate nohighlight" id="equation-f47bffac-f37e-41fa-9a7c-97a2cab16362">
<span class="eqno">(2.21)<a class="headerlink" href="#equation-f47bffac-f37e-41fa-9a7c-97a2cab16362" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{X}^\top = \begin{pmatrix}
X_{1,1} &amp; X_{2,1} &amp; \dots &amp; X_{N,1} \\
X_{1,2} &amp; X_{2,2} &amp; \dots &amp; X_{N,2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,j} &amp; X_{2,j} &amp; \dots &amp; X_{N,j} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,d} &amp; X_{2,d} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\end{align}\]</div>
<p>の<span class="math notranslate nohighlight">\(j\)</span>行目の行ベクトルが<span class="math notranslate nohighlight">\(\begin{pmatrix} X_{1,j} &amp; X_{2,j} &amp; \dots &amp; X_{N,j}\end{pmatrix}\)</span>であることを利用した。最終行の式変形では、以下の行列ベクトル積の<span class="math notranslate nohighlight">\(j\)</span>行目の計算結果に基づく。</p>
<div class="amsmath math notranslate nohighlight" id="equation-25fbb812-f079-428d-9af6-a12ff76c0268">
<span class="eqno">(2.22)<a class="headerlink" href="#equation-25fbb812-f079-428d-9af6-a12ff76c0268" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{X}^\top \pmb{\epsilon} = \begin{pmatrix}
(\pmb{X}^\top)_{1} \pmb{\epsilon} \\
(\pmb{X}^\top)_{2} \pmb{\epsilon} \\
\vdots \\
(\pmb{X}^\top)_{j} \pmb{\epsilon} \\
\vdots \\
(\pmb{X}^\top)_{d} \pmb{\epsilon} \\
\end{pmatrix}
\end{align}\]</div>
<p>式<a class="reference internal" href="#equation-eq-mra-grad-wj">(2.20)</a>より、<span class="math notranslate nohighlight">\(\frac{\partial \hat{L}_{\mathcal{D}}(\pmb{w})}{\partial w_j}\)</span>は<span class="math notranslate nohighlight">\(-2 (\pmb{X}^\top \pmb{\epsilon})\)</span>の<span class="math notranslate nohighlight">\(j\)</span>行目の要素に対応する。全ての<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>について偏微分したものを<span class="math notranslate nohighlight">\(d\)</span>次元ベクトルとしてまとめ、<span class="math notranslate nohighlight">\(\nabla \hat{L}_{\mathcal{D}}(\pmb{w})\)</span>と書くことにすると、</p>
<div class="margin sidebar">
<p class="sidebar-title"><span class="math notranslate nohighlight">\(\nabla\)</span>（ナブラ）と勾配</p>
<p>多変数実関数の勾配を表すために<span class="math notranslate nohighlight">\(\nabla\)</span>を用いる。例えば、<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>から実数への関数<span class="math notranslate nohighlight">\(f: \mathbb{R}^3 \longmapsto \mathbb{R}\)</span>があるとき、その<span class="math notranslate nohighlight">\(x, y, z\)</span>に関する偏微分を<span class="math notranslate nohighlight">\(3\)</span>次元ベクトルとしてまとめたものを、<span class="math notranslate nohighlight">\(\nabla f(x, y, z)\)</span>と書く。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla f(x, y, z) &amp;= \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} f(x, y, z) \\
&amp;= \begin{pmatrix}
\frac{\partial f(x, y, z)}{\partial x} \\
\frac{\partial f(x, y, z)}{\partial y} \\
\frac{\partial f(x, y, z)}{\partial z} \\
\end{pmatrix}
\end{align*}\]</div>
<p><span class="math notranslate nohighlight">\(\nabla f(x, y, z)\)</span>は<span class="math notranslate nohighlight">\(f(x, y, z)\)</span>の増加が最大となる方向（<span class="math notranslate nohighlight">\(f\)</span>の<strong>勾配</strong>）を表す。</p>
<p>なお、<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>において、演算子<span class="math notranslate nohighlight">\(\nabla\)</span>の元々の定義は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla = \pmb{e}_x \frac{\partial}{\partial x} + \pmb{e}_y \frac{\partial}{\partial y} + \pmb{e}_z \frac{\partial}{\partial z}
\end{align*}\]</div>
<p>ここで、<span class="math notranslate nohighlight">\(\pmb{e}_x, \pmb{e}_y, \pmb{e}_z\)</span>はそれぞれ、<span class="math notranslate nohighlight">\(x, y, z\)</span>方向の単位ベクトルである。したがって、先ほどの説明の通り<span class="math notranslate nohighlight">\(\nabla f(x, y, z)\)</span>は<span class="math notranslate nohighlight">\(f(x, y, z)\)</span>を<span class="math notranslate nohighlight">\(x, y, z\)</span>に関して偏微分したベクトルとなる。</p>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}
\nabla \hat{L}_{\mathcal{D}}(\pmb{w}) = \begin{pmatrix}
\frac{\partial }{\partial w_1} \\
\frac{\partial }{\partial w_2} \\
\vdots \\
\frac{\partial }{\partial w_d} \\
\end{pmatrix} \hat{L}_{\mathcal{D}}(\pmb{w})
= -2 \pmb{X}^\top \pmb{\epsilon}
\end{split}\]</div>
<p>さらに、式<a class="reference internal" href="#equation-eq-mra-epsilon">(2.18)</a>より<span class="math notranslate nohighlight">\(\pmb{\epsilon} = \pmb{y} - \pmb{X}\pmb{w}\)</span>であるから、</p>
<div class="math notranslate nohighlight" id="equation-eq-gradient">
<span class="eqno">(2.23)<a class="headerlink" href="#equation-eq-gradient" title="この数式へのパーマリンク">#</a></span>\[
\nabla \hat{L}_{\mathcal{D}}(\pmb{w}) = -2 \pmb{X}^\top \pmb{\epsilon} = 2 \pmb{X}^\top (\hat{\pmb{y}} - \pmb{y}) = 2 \pmb{X}^\top (\pmb{X}\pmb{w} - \pmb{y})
\]</div>
<p>目的関数を最小化するパラメータベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>を求めるため、これを<span class="math notranslate nohighlight">\(\pmb{0}\)</span>とおき、<span class="math notranslate nohighlight">\(\pmb{w}\)</span>について解くと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-1dfb280e-ede5-41bb-bce2-4867d2b46e22">
<span class="eqno">(2.24)<a class="headerlink" href="#equation-1dfb280e-ede5-41bb-bce2-4867d2b46e22" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
2\pmb{X}^\top (\pmb{X}\pmb{w} - \pmb{y}) &amp;= \pmb{0} \\
\pmb{X}^\top \pmb{X}\pmb{w} - \pmb{X}^\top \pmb{y} &amp;= \pmb{0} \\
\pmb{X}^\top \pmb{X}\pmb{w} &amp;= \pmb{X}^\top \pmb{y} \\
\pmb{w} &amp;= (\pmb{X}^\top \pmb{X})^{-1}\pmb{X}^\top \pmb{y}
\end{align}\]</div>
<p>したがって、学習データに対応する計画行列<span class="math notranslate nohighlight">\(\pmb{X}\)</span>と目的変数ベクトル<span class="math notranslate nohighlight">\(\pmb{y}\)</span>が与えられると、平均二乗残差を最小にするパラメータベクトル<span class="math notranslate nohighlight">\(\pmb{w}\)</span>は行列演算で解析的に（閉じた式で）求めることができる。なお、<span class="math notranslate nohighlight">\((\pmb{X}^\top \pmb{X})^{-1}\pmb{X}^\top\)</span>を求める部分は、<a class="reference external" href="https://ja.wikipedia.org/wiki/%E6%93%AC%E4%BC%BC%E9%80%86%E8%A1%8C%E5%88%97">ムーア・ペンローズの擬似逆行列（一般化逆行列）</a>でも十分であるが、ここでは詳しく説明しない。</p>
<p>まとめとして、<span class="math notranslate nohighlight">\(\pmb{w}\)</span>を求める式を再掲する。</p>
<div class="important admonition">
<p class="admonition-title">重回帰のパラメータを求める式</p>
<div class="math notranslate nohighlight" id="equation-eq-closed-form-solution">
<span class="eqno">(2.25)<a class="headerlink" href="#equation-eq-closed-form-solution" title="この数式へのパーマリンク">#</a></span>\[
\begin{align}
\pmb{w} &amp;= (\pmb{X}^\top \pmb{X})^{-1}\pmb{X}^\top \pmb{y}
\end{align}
\]</div>
</div>
<p>なお、導出の途中で出てきた以下の等式は<strong>正規方程式</strong>（normal equation）と呼ばれる。</p>
<div class="important admonition">
<p class="admonition-title">正規方程式</p>
<div class="math notranslate nohighlight" id="equation-eq-normal-equation">
<span class="eqno">(2.26)<a class="headerlink" href="#equation-eq-normal-equation" title="この数式へのパーマリンク">#</a></span>\[
\pmb{X}^\top \pmb{X}\pmb{w} = \pmb{X}^\top \pmb{y}
\]</div>
</div>
</div>
<div class="section" id="id7">
<h2><span class="section-number">2.5. </span>目的関数の微分（別の導出）<a class="headerlink" href="#id7" title="このヘッドラインへのパーマリンク">#</a></h2>
<div class="margin sidebar">
<p class="sidebar-title">行列の転置</p>
<p><span class="math notranslate nohighlight">\((\pmb{A}^\top)^\top = \pmb{A}\)</span></p>
<p><span class="math notranslate nohighlight">\((\pmb{A}\pmb{B})^\top = \pmb{B}^\top \pmb{A}^\top\)</span></p>
</div>
<p>式<a class="reference internal" href="#equation-eq-objective-function">(2.19)</a>の目的関数をベクトルで記述したまま、<span class="math notranslate nohighlight">\(\pmb{w}\)</span>で微分する導出も紹介しておく。まず、目的関数を展開する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-c74c4533-b9ec-452e-b30f-df347f9b7094">
<span class="eqno">(2.27)<a class="headerlink" href="#equation-c74c4533-b9ec-452e-b30f-df347f9b7094" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\hat{L}_{\mathcal{D}}(\pmb{w}) &amp;= \lVert \pmb{y} - \pmb{X}\pmb{w} \rVert^2 \\
&amp;= (\pmb{y} - \pmb{X}\pmb{w})^\top(\pmb{y} - \pmb{X}\pmb{w}) \\
&amp;= (\pmb{y}^\top - \pmb{w}^\top \pmb{X}^\top)(\pmb{y} - \pmb{X}\pmb{w}) \\
&amp;= \pmb{y}^\top \pmb{y} - \pmb{y}^\top \pmb{X}\pmb{w} - \pmb{w}^\top \pmb{X}^\top \pmb{y} + \pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w} \\
&amp;= \pmb{y}^\top \pmb{y} - (\pmb{X}^\top\pmb{y})^\top \pmb{w} - \pmb{w}^\top (\pmb{X}^\top \pmb{y}) + \pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w} &amp;&amp; (\because (\pmb{X}^\top\pmb{y})^\top = \pmb{y}^\top (\pmb{X}^\top)^\top)\\
&amp;= \pmb{y}^\top \pmb{y} - 2(\pmb{X}^\top\pmb{y})^\top \pmb{w} + \pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w} &amp;&amp; (\because \pmb{u}^\top \pmb{v} = \pmb{v}^\top \pmb{u})
\end{align}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">ベクトルの内積の微分</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial}{\partial \pmb{x}} \pmb{x}^\top\pmb{a} = \frac{\partial}{\partial \pmb{x}} \pmb{a}^\top\pmb{x} = \pmb{a}
\end{align*}\]</div>
<p>（証明）ベクトル<span class="math notranslate nohighlight">\(\pmb{a}, \pmb{x} \in \mathbb{R}^d\)</span>に対して、<span class="math notranslate nohighlight">\(\pmb{x}^\top\pmb{a} = \pmb{a}^\top\pmb{x}\)</span>であるので、どちらか一方の偏微分を計算すればよい。ある整数<span class="math notranslate nohighlight">\(i \in \{1, \dots, d\}\)</span>に対して、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp;\left(\frac{\partial}{\partial \pmb{x}} \pmb{x}^\top\pmb{a}\right)_i 
= \frac{\partial}{\partial x_i}\left(\pmb{x}^\top\pmb{a}\right) \\
=&amp; \frac{\partial}{\partial x_i}\left(a_1 x_1 + \dots a_d x_d \right) 
= a_i
\end{align*}\]</div>
</div>
<div class="margin sidebar">
<p class="sidebar-title">二次形式の微分</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
&amp;\frac{\partial}{\partial \pmb{x}} \pmb{x}^\top \pmb{A}\pmb{x} = (\pmb{A} + \pmb{A}^\top)\pmb{x}
\end{align*}\]</div>
<p>（証明）行列<span class="math notranslate nohighlight">\(\pmb{A} \in \mathbb{R}^{d \times d}\)</span>とベクトル<span class="math notranslate nohighlight">\(\pmb{x} \in \mathbb{R}^d\)</span>に対して、<span class="math notranslate nohighlight">\(\pmb{x}\)</span>の二次形式は、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\pmb{x}^\top \pmb{A}\pmb{x} 
=&amp; \pmb{x}^\top \begin{pmatrix}
\sum_{j=1}^d A_{1,j} x_j \\
\vdots \\
\sum_{j=1}^d A_{d,j} x_j
\end{pmatrix} \\
=&amp; \sum_{i=1}^d \sum_{j=1}^d A_{i,j} x_i x_j
\end{align*}\]</div>
<p>ゆえに、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{\partial \pmb{x}^\top \pmb{A}\pmb{x}}{\partial x_k} &amp;= \sum_{i=1}^d A_{i,k} x_i + \sum_{j=1}^d A_{k,j} x_j \\
&amp;= (\pmb{A}^\top \pmb{x})_k + (\pmb{A} \pmb{x})_k \\
&amp;= \left((\pmb{A} + \pmb{A}^\top) \pmb{x}\right)_k
\end{align*}\]</div>
</div>
<p>続いて、目的関数<span class="math notranslate nohighlight">\(\hat{L}_{\mathcal{D}}(\pmb{w})\)</span>を最小化する<span class="math notranslate nohighlight">\(\pmb{w}\)</span>を求めるために、<span class="math notranslate nohighlight">\(\hat{L}_{\mathcal{D}}(\pmb{w})\)</span>を<span class="math notranslate nohighlight">\(\pmb{w}\)</span>で偏微分する。</p>
<div class="amsmath math notranslate nohighlight" id="equation-4a38b735-6302-46f4-8127-672871214edb">
<span class="eqno">(2.28)<a class="headerlink" href="#equation-4a38b735-6302-46f4-8127-672871214edb" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\pmb{w}) &amp;= \frac{\partial}{\partial \pmb{w}} \left(\pmb{y}^\top \pmb{y} - 2(\pmb{X}^\top\pmb{y})^\top \pmb{w} + \pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w}\right) \\
  &amp;= 0 - \frac{\partial}{\partial \pmb{w}}\left(2(\pmb{X}^\top\pmb{y})^\top \pmb{w}\right) + \frac{\partial}{\partial \pmb{w}}\left(\pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w}\right)
\end{align}\]</div>
<p>上式の第2項は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-999eb159-7f40-4798-a352-bb68d255a201">
<span class="eqno">(2.29)<a class="headerlink" href="#equation-999eb159-7f40-4798-a352-bb68d255a201" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\frac{\partial}{\partial \pmb{w}}\left(2(\pmb{X}^\top\pmb{y})^\top \pmb{w}\right)
= 2\pmb{X}^\top \pmb{y}
\end{align}\]</div>
<p>第3項は、<span class="math notranslate nohighlight">\(\pmb{X}^\top \pmb{X}\)</span>が正方行列（<span class="math notranslate nohighlight">\(d \times d\)</span>行列）であり、<span class="math notranslate nohighlight">\((\pmb{X}^\top \pmb{X})^\top=\pmb{X}^\top (\pmb{X}^\top)^\top = \pmb{X}^\top \pmb{X}\)</span>、すなわち<span class="math notranslate nohighlight">\(\pmb{X}^\top \pmb{X}\)</span>は対称行列であることに注意すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-288fe6df-997d-4492-8ede-0e132831f71b">
<span class="eqno">(2.30)<a class="headerlink" href="#equation-288fe6df-997d-4492-8ede-0e132831f71b" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\frac{\partial}{\partial \pmb{w}}\left(\pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w}\right)
= \frac{\partial}{\partial \pmb{w}}\left(\pmb{w}^\top (\pmb{X}^\top \pmb{X}) \pmb{w}\right)
= \left((\pmb{X}^\top \pmb{X}) + (\pmb{X}^\top \pmb{X})^\top \right) \pmb{w}
= 2\pmb{X}^\top \pmb{X}\pmb{w}
\end{align}\]</div>
<p>ゆえに、</p>
<div class="amsmath math notranslate nohighlight" id="equation-6dff2765-6823-4791-b3c8-fdf9e69a4bd4">
<span class="eqno">(2.31)<a class="headerlink" href="#equation-6dff2765-6823-4791-b3c8-fdf9e69a4bd4" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\pmb{w}) &amp;= - \frac{\partial}{\partial \pmb{w}}\left(2(\pmb{X}^\top\pmb{y})^\top \pmb{w}\right) + \frac{\partial}{\partial \pmb{w}}\left(\pmb{w}^\top \pmb{X}^\top \pmb{X}\pmb{w}\right) \\
  &amp;= - 2\pmb{X}^\top \pmb{y} + 2\pmb{X}^\top \pmb{X}\pmb{w} \\
  &amp;= 2\pmb{X}^\top (\pmb{X}\pmb{w} - \pmb{y})
\end{align}\]</div>
<p>したがって、式<a class="reference internal" href="#equation-eq-gradient">(2.23)</a>で求めた勾配と一致する。</p>
</div>
<div class="section" id="id8">
<h2><span class="section-number">2.6. </span>目的関数は凸関数<a class="headerlink" href="#id8" title="このヘッドラインへのパーマリンク">#</a></h2>
<div class="margin sidebar">
<p class="sidebar-title">ヘッセ行列</p>
<p>多変数実関数の二階微分を行列で表したものである。例えば、<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>から実数<span class="math notranslate nohighlight">\(\mathbb{R}\)</span>への関数<span class="math notranslate nohighlight">\(f(x,y,z)\)</span>に対し、</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\begin{pmatrix}
\frac{\partial^2 f}{\partial^2 x} &amp; \frac{\partial^2 f}{\partial x \partial y} &amp; \frac{\partial^2 f}{\partial x \partial z} \\
\frac{\partial^2 f}{\partial y \partial x} &amp; \frac{\partial^2 f}{\partial^2 y} &amp; \frac{\partial^2 f}{\partial y \partial z} \\
\frac{\partial^2 f}{\partial z \partial x} &amp; \frac{\partial^2 f}{\partial z \partial y} &amp; \frac{\partial^2 f}{\partial^2 z} \\
\end{pmatrix}
\end{align*}\]</div>
<p>を<span class="math notranslate nohighlight">\(f\)</span>のヘッセ行列と呼ぶ。</p>
</div>
<p>ここで、重回帰の目的関数は凸関数であることを示しておく。証明の方針は、目的関数の二階微分（ヘッセ行列）が半正定値行列であることを示すことである。</p>
<p>式<a class="reference internal" href="#equation-eq-gradient">(2.23)</a>より、目的関数の一階微分は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-94b9d1cd-1f4e-4d98-be50-cbe6287b0838">
<span class="eqno">(2.32)<a class="headerlink" href="#equation-94b9d1cd-1f4e-4d98-be50-cbe6287b0838" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\pmb{w})
= \begin{pmatrix}
\frac{\partial}{\partial w_1} \\
\frac{\partial}{\partial w_2} \\
\vdots \\
\frac{\partial}{\partial w_d} \\
\end{pmatrix} \hat{L}_{\mathcal{D}}(\pmb{w})
= \frac{\partial \hat{L}_{\mathcal{D}}(\pmb{w})}{\partial \pmb{w}}
= 2 \pmb{X}^\top (\pmb{X}\pmb{w} - \pmb{y})
= 2 \pmb{X}^\top\pmb{X}\pmb{w} - 2 \pmb{X}^\top\pmb{y}
\end{align}\]</div>
<div class="margin sidebar">
<p class="sidebar-title"><span class="math notranslate nohighlight">\(\nabla^2\)</span>と二階微分</p>
<p><span class="math notranslate nohighlight">\(\nabla^2\)</span>はラプラシアンかヘッセ行列を表す。<span class="math notranslate nohighlight">\(xyz\)</span>直交座標空間<span class="math notranslate nohighlight">\(\mathbb{R}^3\)</span>において、<span class="math notranslate nohighlight">\(\nabla^2\)</span>を内積<span class="math notranslate nohighlight">\(\nabla \cdot \nabla\)</span>とすると、ラプラシアンとなる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla \cdot \nabla &amp;= \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} \cdot \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} \\
&amp;=
\frac{\partial^2}{\partial^2 x} +
\frac{\partial^2}{\partial^2 y} +
\frac{\partial^2}{\partial^2 z}
\end{align*}\]</div>
<p>これに対し、<span class="math notranslate nohighlight">\(\nabla^2\)</span>を直積<span class="math notranslate nohighlight">\(\nabla \nabla^\top\)</span>と考えると、ヘッセ行列となる。</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\nabla \nabla^\top &amp;= \begin{pmatrix}
\frac{\partial}{\partial x} \\
\frac{\partial}{\partial y} \\
\frac{\partial}{\partial z} \\
\end{pmatrix} \begin{pmatrix}
\frac{\partial}{\partial x} &amp;
\frac{\partial}{\partial y} &amp;
\frac{\partial}{\partial z}
\end{pmatrix} \\
&amp;= \begin{pmatrix}
\frac{\partial^2}{\partial^2 x} &amp; \frac{\partial^2}{\partial x \partial y} &amp; \frac{\partial^2}{\partial x \partial z} \\
\frac{\partial^2}{\partial y \partial x} &amp; \frac{\partial^2}{\partial^2 y} &amp; \frac{\partial^2}{\partial y \partial z} \\
\frac{\partial^2}{\partial z \partial x} &amp; \frac{\partial^2}{\partial z \partial y} &amp; \frac{\partial^2}{\partial^2 z} \\
\end{pmatrix}
\end{align*}\]</div>
<p>本資料では、<span class="math notranslate nohighlight">\(\nabla^2\)</span>でヘッセ行列を表すこととする。</p>
</div>
<p>さらに、目的関数の二階微分（ヘッセ行列）は、</p>
<div class="amsmath math notranslate nohighlight" id="equation-aae379cb-c9b9-4245-9423-f1c369a24aef">
<span class="eqno">(2.33)<a class="headerlink" href="#equation-aae379cb-c9b9-4245-9423-f1c369a24aef" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\nabla^2 \hat{L}_{\mathcal{D}}(\pmb{w})
&amp;= \begin{pmatrix}
\frac{\partial^2}{\partial^2 w_1} &amp; \frac{\partial^2}{\partial w_1 \partial w_2} &amp; \dots &amp; \frac{\partial^2}{\partial w_1 \partial w_d} \\
\frac{\partial^2}{\partial w_2 \partial w_1} &amp; \frac{\partial^2}{\partial^2 w_2} &amp; \dots &amp; \frac{\partial^2}{\partial w_2 \partial w_d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\frac{\partial^2}{\partial w_d \partial w_1} &amp; \frac{\partial^2}{\partial w_d \partial w_2} &amp; \dots &amp; \frac{\partial^2}{\partial^2 w_d}
\end{pmatrix} \hat{L}_{\mathcal{D}}(\pmb{w}) \\
&amp;= \frac{\partial}{\partial \pmb{w}} (2 \pmb{X}^\top \pmb{X}\pmb{w} - 2 \pmb{X}^\top \pmb{y}) \\
&amp;= 2 (\pmb{X}^\top \pmb{X})^\top \\
&amp;= 2 \pmb{X}^\top \pmb{X} &amp;&amp; (\because \pmb{X}^\top \pmb{X} = \pmb{X}^\top (\pmb{X}^\top)^\top)
\end{align}\]</div>
<p>ここで、任意の非ゼロベクトル<span class="math notranslate nohighlight">\(\pmb{u}\)</span>に対して、</p>
<div class="amsmath math notranslate nohighlight" id="equation-9e63ca8a-3226-430f-b938-e28c4cfc66c8">
<span class="eqno">(2.34)<a class="headerlink" href="#equation-9e63ca8a-3226-430f-b938-e28c4cfc66c8" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{u}^\top (2 \pmb{X}^\top \pmb{X}) \pmb{u} = 2 \pmb{u}^\top \pmb{X}^\top \pmb{X} \pmb{u} = 2(\pmb{X}\pmb{u})^\top (\pmb{X} \pmb{u}) = 2 \|\pmb{X} \pmb{u}\|^2 \geq 0
\end{align}\]</div>
<p>であるから、目的関数の二階微分<span class="math notranslate nohighlight">\(2 \pmb{X}^\top \pmb{X}\)</span>は半正定値行列である。ゆえに、重回帰の目的関数は凸関数である。</p>
<div class="margin sidebar">
<p class="sidebar-title">二階微分が半正定値行列ならば凸関数</p>
<p>ある多変数実関数<span class="math notranslate nohighlight">\(f\)</span>の二階微分が半正定値行列ならば、<span class="math notranslate nohighlight">\(f\)</span>は凸関数である。本資料では、その証明を省略するので、凸最適化の教科書などを参照されたい。</p>
<p>１変数実関数<span class="math notranslate nohighlight">\(f(x)\)</span>に関して、<span class="math notranslate nohighlight">\(f''(x) \geq 0\)</span>ならば勾配<span class="math notranslate nohighlight">\(f'(x)\)</span>は単調増加であるため、<span class="math notranslate nohighlight">\(f(x)\)</span>は凸関数である。それを多変数関数に拡張したものが、半正定値性による凸関数の判定とイメージするとよい。</p>
</div>
</div>
<div class="section" id="id9">
<h2><span class="section-number">2.7. </span>重回帰の性質<a class="headerlink" href="#id9" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>重回帰に関する様々な性質を導出してみよう <span id="id10">[<a class="reference internal" href="../reference.html#id5" title="Nathaniel Beck. Ols in matrix form. 2009. URL: https://web.stanford.edu/~mrosenfe/soc_meth_proj3/matrix_OLS_NYU_notes.pdf.">Beck, 2009</a>]</span>。重回帰で推定されたパラメータ<span class="math notranslate nohighlight">\(\pmb{w}\)</span>は、式<a class="reference internal" href="#equation-eq-gradient">(2.23)</a>を<span class="math notranslate nohighlight">\(\pmb{0}\)</span>とおいたものであるので、</p>
<div class="math notranslate nohighlight" id="equation-eq-x-top-epsilon">
<span class="eqno">(2.35)<a class="headerlink" href="#equation-eq-x-top-epsilon" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\nabla \hat{L}_{\mathcal{D}}(\pmb{w}) = -2 \pmb{X}^\top \pmb{\epsilon} &amp;= \pmb{0} \\
\pmb{X}^\top \pmb{\epsilon} &amp;= \pmb{0}
\end{align}
\end{split}\]</div>
<p>この行列・ベクトルの成分を明示すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-e09c7091-f760-44d9-85b7-2805d208c236">
<span class="eqno">(2.36)<a class="headerlink" href="#equation-e09c7091-f760-44d9-85b7-2805d208c236" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\begin{pmatrix}
X_{1,1} &amp; X_{2,1} &amp; \dots &amp; X_{N,1} \\
X_{1,2} &amp; X_{2,2} &amp; \dots &amp; X_{N,2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,d} &amp; X_{2,d} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\begin{pmatrix}
\epsilon_1 \\
\epsilon_2 \\
\vdots \\
\epsilon_N
\end{pmatrix}
=
\begin{pmatrix}
\sum_{i=1}^N X_{i,1} \epsilon_i \\
\sum_{i=1}^N X_{i,2} \epsilon_i \\
\vdots \\
\sum_{i=1}^N X_{i,d} \epsilon_i
\end{pmatrix}
=
\begin{pmatrix}
0 \\ 0 \\ \vdots \\ 0
\end{pmatrix}
\end{align}\]</div>
<p>ゆえに、任意の整数<span class="math notranslate nohighlight">\(j \in \{1, 2, \dots, d\}\)</span>に関して、</p>
<div class="math notranslate nohighlight" id="equation-eq-epsilon-property">
<span class="eqno">(2.37)<a class="headerlink" href="#equation-eq-epsilon-property" title="この数式へのパーマリンク">#</a></span>\[
\sum_{i=1}^N X_{i,j} \epsilon_i = 0
\]</div>
<p>これは、<span class="math notranslate nohighlight">\(\pmb{w}\)</span>を求めるときに、式<a class="reference internal" href="#equation-eq-mra-grad-wj">(2.20)</a>の2行目を全ての<span class="math notranslate nohighlight">\(j\)</span>に対して<span class="math notranslate nohighlight">\(0\)</span>としたことからも、明らかである。</p>
<p>ここで、バイアス項（切片）に対応するパラメータを持たせるため、<span class="math notranslate nohighlight">\(\pmb{X}\)</span>の先頭列の要素はすべて<span class="math notranslate nohighlight">\(1\)</span>と仮定する。</p>
<div class="math notranslate nohighlight" id="equation-eq-first-column-one">
<span class="eqno">(2.38)<a class="headerlink" href="#equation-eq-first-column-one" title="この数式へのパーマリンク">#</a></span>\[
\begin{array}{cc}
X_{i,1} = 1 &amp; (i \in \{1, 2, \dots, N\})
\end{array}
\]</div>
<p>念のため、<span class="math notranslate nohighlight">\(\pmb{X}\)</span>と<span class="math notranslate nohighlight">\(\pmb{X}^\top\)</span>を明示的に書くと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-00b36220-524f-4d39-864e-2b7599a92b87">
<span class="eqno">(2.39)<a class="headerlink" href="#equation-00b36220-524f-4d39-864e-2b7599a92b87" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\pmb{X} = 
\begin{pmatrix}
1 &amp; X_{1,2} &amp; \dots &amp; X_{1,d} \\
1 &amp; X_{2,2} &amp; \dots &amp; X_{2,d} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
1 &amp; X_{1,N} &amp; \dots &amp; X_{N,d}
\end{pmatrix}, 
\pmb{X}^\top = 
\begin{pmatrix}
1 &amp; 1 &amp; \dots &amp; 1 \\
X_{1,2} &amp; X_{2,2} &amp; \dots &amp; X_{N,2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
X_{1,d} &amp; X_{2,d} &amp; \dots &amp; X_{N,d}
\end{pmatrix}
\end{align}\]</div>
<p>これにより、<span class="math notranslate nohighlight">\(w_1\)</span>がバイアス項に対応するパラメータとなる。ここから、重回帰の様々な性質を導出してみよう。なお、バイアス項に対応させる列は先頭である必要はなく、その他の場所でも以降の議論の一般性は失われない。</p>
<div class="section" id="id11">
<h3><span class="section-number">2.7.1. </span>残差の和および平均は<span class="math notranslate nohighlight">\(0\)</span><a class="headerlink" href="#id11" title="このヘッドラインへのパーマリンク">#</a></h3>
<p><span class="math notranslate nohighlight">\(j=1\)</span>として式<a class="reference internal" href="#equation-eq-epsilon-property">(2.37)</a>に式<a class="reference internal" href="#equation-eq-first-column-one">(2.38)</a>を代入すると、</p>
<div class="math notranslate nohighlight" id="equation-eq-sum-epsilon-zero-mra">
<span class="eqno">(2.40)<a class="headerlink" href="#equation-eq-sum-epsilon-zero-mra" title="この数式へのパーマリンク">#</a></span>\[
\sum_{i=1}^N X_{i,1} \epsilon_i = \sum_{i=1}^N \epsilon_i = 0
\]</div>
<p>ゆえに、残差の和および平均は<span class="math notranslate nohighlight">\(0\)</span>である。</p>
</div>
<div class="section" id="hat-y-y">
<h3><span class="section-number">2.7.2. </span>目的変数の推定値<span class="math notranslate nohighlight">\(\hat{y}\)</span>の平均値は観測値<span class="math notranslate nohighlight">\(y\)</span>の平均に等しい<a class="headerlink" href="#hat-y-y" title="このヘッドラインへのパーマリンク">#</a></h3>
<p>残差の定義<span class="math notranslate nohighlight">\(\pmb{\epsilon} = \pmb{y} - \hat{\pmb{y}}\)</span>を明示的に書くと、</p>
<div class="amsmath math notranslate nohighlight" id="equation-15caad24-2be9-449f-a184-c081352ae000">
<span class="eqno">(2.41)<a class="headerlink" href="#equation-15caad24-2be9-449f-a184-c081352ae000" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\begin{pmatrix}
\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_N
\end{pmatrix} =
\begin{pmatrix}
y_1 \\ y_2 \\ \vdots \\ y_N
\end{pmatrix}
-
\begin{pmatrix}
\hat{y}_1 \\ \hat{y}_2 \\ \vdots \\ \hat{y}_N
\end{pmatrix}
\end{align}\]</div>
<p>両辺の各要素の和をとると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-2aab2aa9-73e9-499f-bf91-ca4579300379">
<span class="eqno">(2.42)<a class="headerlink" href="#equation-2aab2aa9-73e9-499f-bf91-ca4579300379" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\sum_{i=1}^N \epsilon_i = \sum_{i=1}^N y_i - \sum_{i=1}^N \hat{y}_i
\end{align}\]</div>
<p>ここで、式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.40)</a>より左辺は<span class="math notranslate nohighlight">\(0\)</span>であるから、</p>
<div class="amsmath math notranslate nohighlight" id="equation-f1f48888-e45b-4b20-b6fd-d226339e1c45">
<span class="eqno">(2.43)<a class="headerlink" href="#equation-f1f48888-e45b-4b20-b6fd-d226339e1c45" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\sum_{i=1}^N y_i &amp;= \sum_{i=1}^N \hat{y}_i \\
\frac{1}{N}\sum_{i=1}^N y_i &amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \\
\overline{y} &amp;= \overline{\hat{y}}
\end{align}\]</div>
<p>ゆえに、目的変数の推定値<span class="math notranslate nohighlight">\(\hat{y}\)</span>の平均値は観測値<span class="math notranslate nohighlight">\(y\)</span>の平均に等しい。</p>
</div>
<div class="section" id="id12">
<h3><span class="section-number">2.7.3. </span>観測データの重心は回帰平面上に存在する<a class="headerlink" href="#id12" title="このヘッドラインへのパーマリンク">#</a></h3>
<p>説明変数の平均ベクトル<span class="math notranslate nohighlight">\(\overline{\pmb{x}}\)</span>、</p>
<div class="amsmath math notranslate nohighlight" id="equation-32cd87d0-3d21-4ecb-a52a-0c3dc7710572">
<span class="eqno">(2.44)<a class="headerlink" href="#equation-32cd87d0-3d21-4ecb-a52a-0c3dc7710572" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\overline{\pmb{x}} = \frac{1}{N} \sum_{i=1}^N \pmb{x}_i
\end{align}\]</div>
<p>に対して、目的変数の推定値を計算すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-0eb16232-a139-4b44-bfd1-3225f7763138">
<span class="eqno">(2.45)<a class="headerlink" href="#equation-0eb16232-a139-4b44-bfd1-3225f7763138" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\overline{\pmb{x}}^\top \pmb{w}
&amp;= \frac{1}{N} \sum_{i=1}^N \pmb{x}_i^\top \pmb{w} \\
&amp;= \frac{1}{N} \sum_{i=1}^N \hat{y}_i \\
&amp;= \overline{\hat{y}} = \overline{y}
\end{align}\]</div>
<p>目的変数の平均<span class="math notranslate nohighlight">\(\overline{y}\)</span>が得られる。ゆえに、観測データの重心は回帰平面上に存在する。</p>
</div>
<div class="section" id="id13">
<h3><span class="section-number">2.7.4. </span>各説明変数と残差には相関がない<a class="headerlink" href="#id13" title="このヘッドラインへのパーマリンク">#</a></h3>
<p><span class="math notranslate nohighlight">\(j\)</span>番目の説明変数<span class="math notranslate nohighlight">\(\pmb{X}_{:,j}\)</span>を確率変数と見なし、<span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>と書くことにする。
任意の説明変数<span class="math notranslate nohighlight">\(\mathcal{X}_j\)</span>と残差<span class="math notranslate nohighlight">\(\mathcal{E}\)</span>の共分散を計算する。残差の平均は<span class="math notranslate nohighlight">\(\overline{\epsilon}=0\)</span>であること、式<a class="reference internal" href="#equation-eq-epsilon-property">(2.37)</a>と式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.40)</a>を利用すると、</p>
<div class="amsmath math notranslate nohighlight" id="equation-674fa7ba-ee1c-4984-8680-5743021d8c19">
<span class="eqno">(2.46)<a class="headerlink" href="#equation-674fa7ba-ee1c-4984-8680-5743021d8c19" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathrm{Cov}[\mathcal{X}_j, \mathcal{E}] &amp;= \frac{1}{N}\sum_{i=1}^N (X_{i,j} - \overline{\pmb{X}_{:,j}}) (\epsilon_i - \overline{\epsilon}) \\
&amp;= \frac{1}{N}\sum_{i=1}^N (X_{i,j} - \overline{\pmb{X}_{:,j}}) \epsilon_i \\
&amp;= \frac{1}{N}\sum_{i=1}^N X_{i,j}  \epsilon_i - \frac{1}{N}\sum_{i=1}^N  \overline{\pmb{X}_{:,j}} \epsilon_i \\
&amp;= \frac{1}{N}\underbrace{\sum_{i=1}^N X_{i,j} \epsilon_i}_{0} - \frac{\overline{\pmb{X}_{:,j}}}{N}\underbrace{\sum_{i=1}^N  \epsilon_i}_{0} \\
&amp;= 0
\end{align}\]</div>
</div>
<div class="section" id="id14">
<h3><span class="section-number">2.7.5. </span>目的変数の推定値と残差には相関がない<a class="headerlink" href="#id14" title="このヘッドラインへのパーマリンク">#</a></h3>
<p>目的変数の推定値<span class="math notranslate nohighlight">\(\hat{\mathcal{Y}}\)</span>と残差<span class="math notranslate nohighlight">\(\mathcal{E}\)</span>の共分散を計算する。残差の平均は<span class="math notranslate nohighlight">\(\overline{\epsilon}=0\)</span>であること、式<a class="reference internal" href="#equation-eq-x-top-epsilon">(2.35)</a>と式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.40)</a>を利用すると、</p>
<div class="math notranslate nohighlight" id="equation-eq-cov-hat-y-and-epsilon-mra">
<span class="eqno">(2.47)<a class="headerlink" href="#equation-eq-cov-hat-y-and-epsilon-mra" title="この数式へのパーマリンク">#</a></span>\[\begin{split}
\begin{align}
\mathrm{Cov}[\hat{\mathcal{Y}},\mathcal{E}] &amp;= \frac{1}{N}\sum_{i=1}^N (\hat{y}_i - \overline{\hat{y}}) (\epsilon_i - \overline{\epsilon}) \\
&amp;= \frac{1}{N}\sum_{i=1}^N (\hat{y}_i - \overline{\hat{y}}) \epsilon_i \\
&amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \epsilon_i - \frac{1}{N}\sum_{i=1}^N \overline{\hat{y}} \epsilon_i \\
&amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \epsilon_i - \frac{\overline{\hat{y}}}{N}\underbrace{\sum_{i=1}^N \epsilon_i}_{0} \\
&amp;= \frac{1}{N}\sum_{i=1}^N \hat{y}_i \epsilon_i \\
&amp;= \frac{1}{N}\pmb{\hat{y}}^\top \pmb{\epsilon} \\
&amp;= \frac{1}{N}(\pmb{X} \pmb{w})^\top \pmb{\epsilon} \\
&amp;= \frac{1}{N}\pmb{w}^\top \underbrace{\pmb{X}^\top \pmb{\epsilon}}_{0} \\
&amp;= 0
\end{align}
\end{split}\]</div>
<p>であるから、<span class="math notranslate nohighlight">\(\mathrm{Cov}[\hat{\mathcal{Y}},\mathcal{E}] = 0\)</span>が言える。すなわち、目的変数の推定値と残差の共分散が0になることから、目的変数の推定値と残差は無相関（無関係）であることが分かる。</p>
</div>
</div>
<div class="section" id="id15">
<h2><span class="section-number">2.8. </span>決定係数<a class="headerlink" href="#id15" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>目的変数の観測値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{Y}]\)</span>は目的変数の推定値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\hat{\mathcal{Y}}]\)</span>と残差の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{E}]\)</span>の和で表されることを示す。</p>
<div class="amsmath math notranslate nohighlight" id="equation-39d4f532-5b43-4b34-9a95-7e4b39745059">
<span class="eqno">(2.48)<a class="headerlink" href="#equation-39d4f532-5b43-4b34-9a95-7e4b39745059" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
\mathrm{Var}[\mathcal{Y}] &amp;= \frac{1}{N} \sum_{i=1}^N (y_i - \overline{y})^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N \{(\hat{y}_i + \epsilon_i) - \overline{y}\}^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N \{(\hat{y}_i  - \overline{y}) + \epsilon_i\}^2 \\
&amp;= \frac{1}{N} \sum_{i=1}^N (\hat{y}_i  - \overline{y})^2 + \frac{1}{N} \sum_{i=1}^N 2 (\hat{y}_i  - \overline{y}) \epsilon_i + \frac{1}{N} \sum_{i=1}^N \epsilon_i^2 \\
&amp;= \mathrm{Var}[\hat{\mathcal{Y}}] + 2 \cdot \frac{1}{N} \underbrace{\sum_{i=1}^N \hat{y}_i \epsilon_i}_{0} - 2\overline{y} \cdot \frac{1}{N} \underbrace{\sum_{i=1}^N \epsilon_i}_{0} + \mathrm{Var}[\mathcal{E}] \\
&amp;= \mathrm{Var}[\hat{\mathcal{Y}}] + \mathrm{Var}[\mathcal{E}]
\end{align}\]</div>
<p>なお、以上の式変形における最後から2行目において、第２項は式<a class="reference internal" href="#equation-eq-cov-hat-y-and-epsilon-mra">(2.47)</a>の導出結果、第３項は式<a class="reference internal" href="#equation-eq-sum-epsilon-zero-mra">(2.40)</a>より<span class="math notranslate nohighlight">\(0\)</span>であることを利用した。</p>
<p>したがって、単回帰のときと同様に、</p>
<ul class="simple">
<li><p><strong>全変動</strong>: 目的変数の観測値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{Y}]\)</span>（データの変動）</p></li>
<li><p><strong>回帰変動</strong>: 目的変数の推定値の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\hat{\mathcal{Y}}]\)</span>（モデルの変動）</p></li>
<li><p><strong>残差変動</strong>: 残差の分散<span class="math notranslate nohighlight">\(\mathrm{Var}[\mathcal{E}]\)</span>（モデルが説明しきれなかった変動）</p></li>
</ul>
<p>すると、先ほどの式は「<strong>全変動は回帰変動と残差変動の和で表される</strong>」という関係を表している。</p>
<p>データの全変動のうち、回帰によって表現できた回帰変動の割合を<strong>決定係数</strong>とよび、次式で定義する。</p>
<div class="important admonition">
<p class="admonition-title">決定係数</p>
<div class="amsmath math notranslate nohighlight" id="equation-5328cf45-adbf-4cb1-8a3a-11bde7462b96">
<span class="eqno">(2.49)<a class="headerlink" href="#equation-5328cf45-adbf-4cb1-8a3a-11bde7462b96" title="この数式へのパーマリンク">#</a></span>\[\begin{align}
R^2 = \frac{\mathrm{Var}[\hat{\mathcal{Y}}]}{\mathrm{Var}[\mathcal{Y}]} = \frac{\mathrm{Var}[\mathcal{Y}] - \mathrm{Var}[\mathcal{E}]}{\mathrm{Var}[\mathcal{Y}]} = 1 - \frac{\mathrm{Var}[\mathcal{E}]}{\mathrm{Var}[\mathcal{Y}]}
\end{align}\]</div>
</div>
<p>決定係数は<span class="math notranslate nohighlight">\([0,1]\)</span>の範囲の値ととり、データがモデル（単回帰の場合は直線）によく当てはまるときは<span class="math notranslate nohighlight">\(1\)</span>に近くなる。</p>
</div>
<div class="section" id="id16">
<h2><span class="section-number">2.9. </span>重回帰の実施例<a class="headerlink" href="#id16" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>冒頭の最高気温とアイスクリーム・シャーベットの支出額のデータに対して、単回帰を行う例を示す。まず、説明変数（最高気温）を<code class="docutils literal notranslate"><span class="pre">X</span></code>、目的変数（支出額）を<code class="docutils literal notranslate"><span class="pre">Y</span></code>に格納する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;最高気温とアイスクリーム・シャーベットの支出額&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;最高気温の月平均（℃）&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;支出額（円）&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
     <span class="mf">9.1</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">,</span> <span class="mf">12.3</span><span class="p">,</span> <span class="mf">18.9</span><span class="p">,</span> <span class="mf">22.2</span><span class="p">,</span> <span class="mf">26.</span> <span class="p">,</span> <span class="mf">30.9</span><span class="p">,</span> <span class="mf">31.2</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span> <span class="mf">18.3</span><span class="p">,</span>
    <span class="mf">11.1</span><span class="p">,</span>  <span class="mf">8.3</span><span class="p">,</span>  <span class="mf">9.1</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">,</span> <span class="mf">18.5</span><span class="p">,</span> <span class="mf">23.6</span><span class="p">,</span> <span class="mf">24.8</span><span class="p">,</span> <span class="mf">30.1</span><span class="p">,</span> <span class="mf">33.1</span><span class="p">,</span> <span class="mf">29.8</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span>
    <span class="mf">16.3</span><span class="p">,</span> <span class="mf">11.2</span><span class="p">,</span>  <span class="mf">9.6</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">16.4</span><span class="p">,</span> <span class="mf">19.2</span><span class="p">,</span> <span class="mf">24.1</span><span class="p">,</span> <span class="mf">26.5</span><span class="p">,</span> <span class="mf">31.4</span><span class="p">,</span> <span class="mf">33.2</span><span class="p">,</span> <span class="mf">28.8</span><span class="p">,</span>
    <span class="mf">23.</span> <span class="p">,</span> <span class="mf">17.4</span><span class="p">,</span> <span class="mf">12.1</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span>  <span class="mf">9.8</span><span class="p">,</span> <span class="mf">14.5</span><span class="p">,</span> <span class="mf">19.6</span><span class="p">,</span> <span class="mf">24.7</span><span class="p">,</span> <span class="mf">26.9</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">,</span> <span class="mf">31.2</span><span class="p">,</span>
    <span class="mf">26.9</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span> <span class="mf">17.4</span><span class="p">,</span> <span class="mf">11.</span> <span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">,</span> <span class="mf">19.3</span><span class="p">,</span> <span class="mf">26.4</span><span class="p">,</span> <span class="mf">26.4</span><span class="p">,</span> <span class="mf">30.1</span><span class="p">,</span>
    <span class="mf">30.5</span><span class="p">,</span> <span class="mf">26.4</span><span class="p">,</span> <span class="mf">22.7</span><span class="p">,</span> <span class="mf">17.8</span><span class="p">,</span> <span class="mf">13.4</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">12.2</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">,</span> <span class="mf">20.3</span><span class="p">,</span> <span class="mf">25.2</span><span class="p">,</span> <span class="mf">26.3</span><span class="p">,</span>
    <span class="mf">29.7</span><span class="p">,</span> <span class="mf">31.6</span><span class="p">,</span> <span class="mf">27.7</span><span class="p">,</span> <span class="mf">22.6</span><span class="p">,</span> <span class="mf">15.5</span><span class="p">,</span> <span class="mf">13.8</span><span class="p">,</span> <span class="mf">10.8</span><span class="p">,</span> <span class="mf">12.1</span><span class="p">,</span> <span class="mf">13.4</span><span class="p">,</span> <span class="mf">19.9</span><span class="p">,</span> <span class="mf">25.1</span><span class="p">,</span>
    <span class="mf">26.4</span><span class="p">,</span> <span class="mf">31.8</span><span class="p">,</span> <span class="mf">30.4</span><span class="p">,</span> <span class="mf">26.8</span><span class="p">,</span> <span class="mf">20.1</span><span class="p">,</span> <span class="mf">16.6</span><span class="p">,</span> <span class="mf">11.1</span><span class="p">,</span>  <span class="mf">9.4</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">,</span> <span class="mf">16.9</span><span class="p">,</span> <span class="mf">22.1</span><span class="p">,</span>
    <span class="mf">24.6</span><span class="p">,</span> <span class="mf">26.6</span><span class="p">,</span> <span class="mf">32.7</span><span class="p">,</span> <span class="mf">32.5</span><span class="p">,</span> <span class="mf">26.6</span><span class="p">,</span> <span class="mf">23.</span> <span class="p">,</span> <span class="mf">17.7</span><span class="p">,</span> <span class="mf">12.1</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">11.6</span><span class="p">,</span> <span class="mf">15.4</span><span class="p">,</span>
    <span class="mf">19.</span> <span class="p">,</span> <span class="mf">25.3</span><span class="p">,</span> <span class="mf">25.8</span><span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="mf">32.8</span><span class="p">,</span> <span class="mf">29.4</span><span class="p">,</span> <span class="mf">23.3</span><span class="p">,</span> <span class="mf">17.7</span><span class="p">,</span> <span class="mf">12.6</span><span class="p">,</span> <span class="mf">11.1</span><span class="p">,</span> <span class="mf">13.3</span><span class="p">,</span>
    <span class="mf">16.</span> <span class="p">,</span> <span class="mf">18.2</span><span class="p">,</span> <span class="mf">24.</span> <span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="mf">27.7</span><span class="p">,</span> <span class="mf">34.1</span><span class="p">,</span> <span class="mf">28.1</span><span class="p">,</span> <span class="mf">21.4</span><span class="p">,</span> <span class="mf">18.6</span><span class="p">,</span> <span class="mf">12.3</span><span class="p">])</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="mf">463.</span><span class="p">,</span>  <span class="mf">360.</span><span class="p">,</span>  <span class="mf">380.</span><span class="p">,</span>  <span class="mf">584.</span><span class="p">,</span>  <span class="mf">763.</span><span class="p">,</span>  <span class="mf">886.</span><span class="p">,</span> <span class="mf">1168.</span><span class="p">,</span> <span class="mf">1325.</span><span class="p">,</span>  <span class="mf">847.</span><span class="p">,</span>
    <span class="mf">542.</span><span class="p">,</span>  <span class="mf">441.</span><span class="p">,</span>  <span class="mf">499.</span><span class="p">,</span>  <span class="mf">363.</span><span class="p">,</span>  <span class="mf">327.</span><span class="p">,</span>  <span class="mf">414.</span><span class="p">,</span>  <span class="mf">545.</span><span class="p">,</span>  <span class="mf">726.</span><span class="p">,</span>  <span class="mf">847.</span><span class="p">,</span>
   <span class="mf">1122.</span><span class="p">,</span> <span class="mf">1355.</span><span class="p">,</span>  <span class="mf">916.</span><span class="p">,</span>  <span class="mf">571.</span><span class="p">,</span>  <span class="mf">377.</span><span class="p">,</span>  <span class="mf">465.</span><span class="p">,</span>  <span class="mf">377.</span><span class="p">,</span>  <span class="mf">362.</span><span class="p">,</span>  <span class="mf">518.</span><span class="p">,</span>
    <span class="mf">683.</span><span class="p">,</span>  <span class="mf">838.</span><span class="p">,</span> <span class="mf">1012.</span><span class="p">,</span> <span class="mf">1267.</span><span class="p">,</span> <span class="mf">1464.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span>  <span class="mf">629.</span><span class="p">,</span>  <span class="mf">448.</span><span class="p">,</span>  <span class="mf">466.</span><span class="p">,</span>
    <span class="mf">404.</span><span class="p">,</span>  <span class="mf">343.</span><span class="p">,</span>  <span class="mf">493.</span><span class="p">,</span>  <span class="mf">575.</span><span class="p">,</span>  <span class="mf">921.</span><span class="p">,</span> <span class="mf">1019.</span><span class="p">,</span> <span class="mf">1149.</span><span class="p">,</span> <span class="mf">1303.</span><span class="p">,</span>  <span class="mf">805.</span><span class="p">,</span>
    <span class="mf">739.</span><span class="p">,</span>  <span class="mf">587.</span><span class="p">,</span>  <span class="mf">561.</span><span class="p">,</span>  <span class="mf">486.</span><span class="p">,</span>  <span class="mf">470.</span><span class="p">,</span>  <span class="mf">564.</span><span class="p">,</span>  <span class="mf">609.</span><span class="p">,</span>  <span class="mf">899.</span><span class="p">,</span>  <span class="mf">946.</span><span class="p">,</span>
   <span class="mf">1295.</span><span class="p">,</span> <span class="mf">1325.</span><span class="p">,</span>  <span class="mf">760.</span><span class="p">,</span>  <span class="mf">667.</span><span class="p">,</span>  <span class="mf">564.</span><span class="p">,</span>  <span class="mf">633.</span><span class="p">,</span>  <span class="mf">478.</span><span class="p">,</span>  <span class="mf">450.</span><span class="p">,</span>  <span class="mf">567.</span><span class="p">,</span>
    <span class="mf">611.</span><span class="p">,</span>  <span class="mf">947.</span><span class="p">,</span>  <span class="mf">962.</span><span class="p">,</span> <span class="mf">1309.</span><span class="p">,</span> <span class="mf">1307.</span><span class="p">,</span>  <span class="mf">930.</span><span class="p">,</span>  <span class="mf">668.</span><span class="p">,</span>  <span class="mf">496.</span><span class="p">,</span>  <span class="mf">650.</span><span class="p">,</span>
    <span class="mf">506.</span><span class="p">,</span>  <span class="mf">423.</span><span class="p">,</span>  <span class="mf">531.</span><span class="p">,</span>  <span class="mf">672.</span><span class="p">,</span>  <span class="mf">871.</span><span class="p">,</span>  <span class="mf">986.</span><span class="p">,</span> <span class="mf">1368.</span><span class="p">,</span> <span class="mf">1319.</span><span class="p">,</span>  <span class="mf">924.</span><span class="p">,</span>
    <span class="mf">716.</span><span class="p">,</span>  <span class="mf">651.</span><span class="p">,</span>  <span class="mf">708.</span><span class="p">,</span>  <span class="mf">609.</span><span class="p">,</span>  <span class="mf">535.</span><span class="p">,</span>  <span class="mf">717.</span><span class="p">,</span>  <span class="mf">890.</span><span class="p">,</span> <span class="mf">1054.</span><span class="p">,</span> <span class="mf">1077.</span><span class="p">,</span>
   <span class="mf">1425.</span><span class="p">,</span> <span class="mf">1378.</span><span class="p">,</span>  <span class="mf">900.</span><span class="p">,</span>  <span class="mf">725.</span><span class="p">,</span>  <span class="mf">554.</span><span class="p">,</span>  <span class="mf">542.</span><span class="p">,</span>  <span class="mf">561.</span><span class="p">,</span>  <span class="mf">459.</span><span class="p">,</span>  <span class="mf">604.</span><span class="p">,</span>
    <span class="mf">745.</span><span class="p">,</span> <span class="mf">1105.</span><span class="p">,</span>  <span class="mf">973.</span><span class="p">,</span> <span class="mf">1263.</span><span class="p">,</span> <span class="mf">1533.</span><span class="p">,</span> <span class="mf">1044.</span><span class="p">,</span>  <span class="mf">821.</span><span class="p">,</span>  <span class="mf">621.</span><span class="p">,</span>  <span class="mf">601.</span><span class="p">,</span>
    <span class="mf">549.</span><span class="p">,</span>  <span class="mf">572.</span><span class="p">,</span>  <span class="mf">711.</span><span class="p">,</span>  <span class="mf">819.</span><span class="p">,</span> <span class="mf">1141.</span><span class="p">,</span> <span class="mf">1350.</span><span class="p">,</span> <span class="mf">1285.</span><span class="p">,</span> <span class="mf">1643.</span><span class="p">,</span> <span class="mf">1133.</span><span class="p">,</span>
    <span class="mf">784.</span><span class="p">,</span>  <span class="mf">682.</span><span class="p">,</span>  <span class="mf">587.</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="numpy-polynomial">
<h3><span class="section-number">2.9.1. </span>numpy.polynomialを用いる例<a class="headerlink" href="#numpy-polynomial" title="このヘッドラインへのパーマリンク">#</a></h3>
<p><a class="reference external" href="https://numpy.org/doc/stable/reference/routines.polynomials.html">numpy.polynomial</a>を用いると、線形回帰モデルのパラメータを求めることができる。多項式近似の次元数を３番目の引数に指定する。以下は2次関数にフィッティングする例である。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numpy.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

<span class="n">W</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[x \mapsto \text{635.7482577359643} - \text{33.143024247238735}\,x + \text{1.7316079619689542}\,x^{2}\]</div>
</div>
</div>
<p>多項式近似の係数を<span class="math notranslate nohighlight">\(0\)</span>次、<span class="math notranslate nohighlight">\(1\)</span>次、…の順で並べて表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="o">.</span><span class="n">coef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([635.74825774, -33.14302425,   1.73160796])
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(0\)</span>から<span class="math notranslate nohighlight">\(35\)</span>までに等間隔に配置した<span class="math notranslate nohighlight">\(100\)</span>個の数値<code class="docutils literal notranslate"><span class="pre">x</span></code>に対して、目的変数の推定値<code class="docutils literal notranslate"><span class="pre">y_hat</span></code>を求め、回帰曲線を描画する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_50_0.png" src="../_images/02mra_50_0.png" />
</div>
</div>
<p>続いて、3次関数にフィッティングしてみる。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="o">.</span><span class="n">coef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 2.64628814e+02,  2.92887138e+01, -1.44685888e+00,  5.01164586e-02])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_53_0.png" src="../_images/02mra_53_0.png" />
</div>
</div>
<p>さらに、4次関数にフィッティングした結果を示す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">W</span><span class="o">.</span><span class="n">convert</span><span class="p">()</span><span class="o">.</span><span class="n">coef</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-3.47044444e+02,  1.67566320e+02, -1.23937689e+01,  4.12591380e-01,
       -4.27358629e-03])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">W</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_56_0.png" src="../_images/02mra_56_0.png" />
</div>
</div>
</div>
<div class="section" id="sklearn-linear-model-linearregression">
<h3><span class="section-number">2.9.2. </span>sklearn.linear_model.LinearRegressionを用いる例<a class="headerlink" href="#sklearn-linear-model-linearregression" title="このヘッドラインへのパーマリンク">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">sklearn.linear_model.LinearRegression</a>クラスを用いても、線形回帰を容易に実行できる。訓練データにフィッティングさせるには、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression.fit">fit</a>関数を呼び出せばよいが、説明変数のデータとして、事例数を行数、目的変数の数を列数とした行列形式で与えることになっているので、<code class="docutils literal notranslate"><span class="pre">X</span></code>の形状を変更する。以下に、3次関数にフィッティングする例を示す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">LinearRegression</span><span class="p">())</span>
<span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;polynomialfeatures&#x27;, PolynomialFeatures(degree=3)),
                (&#x27;linearregression&#x27;, LinearRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;polynomialfeatures&#x27;, PolynomialFeatures(degree=3)),
                (&#x27;linearregression&#x27;, LinearRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">PolynomialFeatures</label><div class="sk-toggleable__content"><pre>PolynomialFeatures(degree=3)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>回帰直線の係数（傾き）を表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0.        , 29.28871381, -1.44685888,  0.05011646])
</pre></div>
</div>
</div>
</div>
<p>回帰直線の切片を表示する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">intercept_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>264.628814101544
</pre></div>
</div>
</div>
</div>
<p>決定係数を求めるため、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression.score">score</a>関数を呼び出す。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8784609747360882
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(0\)</span>から<span class="math notranslate nohighlight">\(35\)</span>までに等間隔に配置した<span class="math notranslate nohighlight">\(100\)</span>個の数値<code class="docutils literal notranslate"><span class="pre">x</span></code>に対して、目的変数の推定値<code class="docutils literal notranslate"><span class="pre">y_hat</span></code>を求めるため、<a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression.predict">predict</a>関数を呼び出し、回帰曲線を描画する。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plot_graph</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/02mra_68_0.png" src="../_images/02mra_68_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="id17">
<h2><span class="section-number">2.10. </span>確認問題<a class="headerlink" href="#id17" title="このヘッドラインへのパーマリンク">#</a></h2>
<p>データ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>に対して多項式のフィッティングを行いたい。以下の処理を行うプログラムを作成せよ。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>なお、NumPy, SciPy, scikit-learn, statsmodel等のライブラリには回帰分析を行う便利な関数として以下のようなものがあるが、ここでは使わずに講義中で説明した式をプログラムとして表現すること。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.polyfit.html">np.polyfit</a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.polynomial.polynomial.Polynomial.fit.html#numpy.polynomial.polynomial.Polynomial.fit">np.polynomial.polynomial.Polynomial.fit</a></p></li>
<li><p><a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.lstsq.html">scipy.linalg.lstsq</a>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">scipy.optimize.curve_fit</a>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.linregress.html">scipy.stats.linregress</a></p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">sklearn.linear_model.LinearRegression</a></p></li>
<li><p><a class="reference external" href="https://www.statsmodels.org/stable/generated/statsmodels.regression.linear_model.OLS.html#statsmodels.regression.linear_model.OLS">statsmodels.regression.linear_model.OLS</a></p></li>
</ul>
<p><strong>(1) 行列による1次関数のパラメータ推定</strong></p>
<p><span class="math notranslate nohighlight">\(y = w_0 + w_1 x\)</span>とおき、学習データ<span class="math notranslate nohighlight">\(\mathcal{D}_s\)</span>上の平均二乗残差を最小にする<span class="math notranslate nohighlight">\(\pmb{w} = \begin{pmatrix}
w_0 \\
w_1
\end{pmatrix}\)</span>を行列演算により求めよ。</p>
<p><strong>(2) ２次関数による重回帰</strong></p>
<p><span class="math notranslate nohighlight">\(y = w_0 + w_1 x + w_2 x^2\)</span>とおき、重回帰により平均二乗残差を最小にする<span class="math notranslate nohighlight">\(\pmb{w} = \begin{pmatrix}
w_0 \\
w_1 \\
w_2
\end{pmatrix}\)</span>を求めよ。</p>
<p><strong>(3) 回帰曲線の描画</strong></p>
<p>回帰で求めた2次関数をデータ点とともにグラフに描け。</p>
<p><strong>(4) 決定係数</strong></p>
<p>回帰で得られた2次関数の決定係数（<span class="math notranslate nohighlight">\(R^2\)</span>）を求めよ。</p>
<p><strong>(5) 3次関数による重回帰</strong></p>
<p><span class="math notranslate nohighlight">\(y = w_0 + w_1 x + w_2 x^2 + w_3 x^3\)</span>とおき、重回帰により平均二乗残差を最小にする<span class="math notranslate nohighlight">\(\pmb{w} = \begin{pmatrix}
w_0 \\
w_1 \\
w_2 \\
w_3
\end{pmatrix}\)</span>を求めよ。</p>
<p><strong>(6) 回帰曲線の描画</strong></p>
<p>回帰で求めた3次関数をデータ点とともにグラフに描け</p>
<p><strong>(7) 決定係数</strong></p>
<p>回帰で求めた3次関数の決定係数（<span class="math notranslate nohighlight">\(R^2\)</span>）を求めよ</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "chokkan/mlnote",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./regression"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01sra.html" title="前へ ページ">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">前へ</p>
            <p class="prev-next-title"><span class="section-number">1. </span>単回帰</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03regularization.html" title="次へ ページ">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">次へ</p>
        <p class="prev-next-title"><span class="section-number">3. </span>モデル選択と正則化</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    <div class="extra_footer">
      © Copyright 2020-2022 by 岡崎 直観 (Naoaki Okazaki). この作品は<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">クリエイティブ・コモンズ 表示 - 非営利 - 改変禁止 4.0 国際 ライセンス</a>の下に提供されています。 <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>　ただし、作品中のコードセル部分は<a rel="license" href="https://opensource.org/licenses/MIT">MITライセンス</a>の下に提供されています。

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>